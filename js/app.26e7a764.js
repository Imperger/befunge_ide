(function(){"use strict";var t={572:function(t,e,i){var o={};i.r(o);var n={};i.r(n);var r={};i.r(r);var s={};i.r(s);var l={};i.r(l);var h={};i.r(h);var c={};i.r(c),i.d(c,{h:function(){return El}});i(4147);var a=i(9242),d=i(3396);function u(t,e){const i=(0,d.up)("router-view");return(0,d.wg)(),(0,d.j4)(i)}var f=i(89);const p={},g=(0,f.Z)(p,[["render",u]]);var y=g,b=i(5431);(0,b.z)("/befunge_ide/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(t){console.error("Error during service worker registration:",t)}});var v,m=i(2483),x=(i(1703),i(7327)),C=(i(7658),i(9058)),R=i(4376),w=i(4888),S=i(2939),P=i(8627);(function(t){t[t["Nope"]=0]="Nope",t[t["Left"]=1]="Left",t[t["Right"]=2]="Right",t[t["Wheel"]=4]="Wheel",t[t["BrowserBack"]=8]="BrowserBack",t[t["BrowserForward"]=16]="BrowserForward"})(v||(v={}));class D{static Clamp(t,e,i){return Math.max(Math.min(t,i),e)}static Between(t,e,i){return t>=e&&t<=i}static Equal(t,e,i=Number.EPSILON){return Math.abs(t-e)<i}static Extremum(t){if(0===t.length)throw new Error("Empty points array");const e={...t[0]},i={...t[0]};for(let o=1;o<t.length;++o){const n=t[o];n.x<e.x&&(e.x=n.x),n.x>i.x&&(i.x=n.x),n.y<e.y&&(e.y=n.y),n.y>i.y&&(i.y=n.y)}return{min:e,max:i}}static Distance(t,e){return Math.sqrt(D.SqrDistance(t,e))}static SqrDistance(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}}var A=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},O=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};class T{constructor(t,e){(0,x.Z)(this,"releaseTimeout",void 0),(0,x.Z)(this,"maxDistance",void 0),(0,x.Z)(this,"mouseDownStart",0),(0,x.Z)(this,"lastMouseDownPosition",{x:0,y:0}),(0,x.Z)(this,"isSelect",!1),this.releaseTimeout=t,this.maxDistance=e}OnMouseDown(t){this.mouseDownStart=Date.now(),this.lastMouseDownPosition.x=t.offsetX,this.lastMouseDownPosition.y=t.offsetY}OnMouseUp(t){const e=R.TK([this.lastMouseDownPosition.x,this.lastMouseDownPosition.y],[t.offsetX,t.offsetY]),i=Date.now()-this.mouseDownStart;this.isSelect=e<=this.maxDistance&&i<=this.releaseTimeout}get IsSelect(){return this.isSelect}}class E{constructor(t){(0,x.Z)(this,"pan",void 0),(0,x.Z)(this,"touchPrev",void 0),this.pan=t}OnTouchStart(t){const e=t.targetTouches[0];this.touchPrev={id:e.identifier,x:e.pageX,y:e.pageY}}OnTouchMove(t){if(t.targetTouches.item(0)?.identifier!==this.touchPrev.id)return;const e=t.targetTouches[0];this.pan({startX:this.touchPrev.x*window.devicePixelRatio,startY:this.touchPrev.y*window.devicePixelRatio,movementX:(e.pageX-this.touchPrev.x)*window.devicePixelRatio,movementY:(e.pageY-this.touchPrev.y)*window.devicePixelRatio}),this.touchPrev.x=e.pageX,this.touchPrev.y=e.pageY}}class I{constructor(t,e){(0,x.Z)(this,"zoomStart",void 0),(0,x.Z)(this,"zoomProgress",void 0),(0,x.Z)(this,"prev",[{id:-1,x:0,y:0},{id:-1,x:0,y:0}]),this.zoomStart=t,this.zoomProgress=e}OnTouchStart(t){2===t.targetTouches.length&&(this.zoomStart(),this.UpdateTrace(t))}OnTouchEnd(t){[...t.targetTouches].forEach((t=>{const e=this.prev.find((e=>e.id===t.identifier));e&&(e.id=-1)}))}OnTouchMove(t){if(2!==t.targetTouches.length||!this.prev.every((t=>-1!==t.id)))return;t.preventDefault();const[e,i]=(t.targetTouches[0].identifier===this.prev[0].id?[t.targetTouches[0],t.targetTouches[1]]:[t.targetTouches[1],t.targetTouches[0]]).map((t=>({x:t.pageX,y:t.pageY}))),o=D.Distance(this.prev[0],this.prev[1]),n=D.Distance(e,i);this.zoomProgress(o/n)}UpdateTrace(t){for(let e=0;e<t.targetTouches.length;++e)this.prev[e].id=t.targetTouches[e].identifier,this.prev[e].x=t.targetTouches[e].pageX,this.prev[e].y=t.targetTouches[e].pageY}}let B=class{constructor(){(0,x.Z)(this,"selectStrategy",new T(250,3)),(0,x.Z)(this,"touchPan",void 0),(0,x.Z)(this,"touchZoom",void 0),this.touchPan=new E((t=>this.OnPan(t))),this.touchZoom=new I((()=>this.OnTouchZoomStart()),(t=>this.OnTouchZoom(t)))}OnMouseMove(t){t.buttons&v.Left&&this.OnPan({startX:t.offsetX*window.devicePixelRatio,startY:t.offsetY*window.devicePixelRatio,movementX:t.movementX*window.devicePixelRatio,movementY:t.movementY*window.devicePixelRatio})}OnMouseDown(t){this.selectStrategy.OnMouseDown(t)}OnMouseUp(t){this.selectStrategy.OnMouseUp(t),this.selectStrategy.IsSelect&&this.OnSelect({offsetX:t.offsetX*window.devicePixelRatio,offsetY:t.offsetY*window.devicePixelRatio})}OnTouchStart(t){this.touchPan.OnTouchStart(t),this.touchZoom.OnTouchStart(t)}OnTouchMove(t){this.touchPan.OnTouchMove(t),this.touchZoom.OnTouchMove(t)}OnTouchEnd(t){this.touchZoom.OnTouchEnd(t)}};B=A([(0,w.b)(),O("design:paramtypes",[])],B);const L={WebGLRenderingContext:Symbol("webgl2 rendering context"),FontAtlas:Symbol("Font atlas"),IconAtlas:Symbol("Icon atlas"),FontAtlasTexture:Symbol("Font texture"),IconAtlasTexture:Symbol("Icon texture"),FontGlyphCollectionFactory:Symbol("Font glyph collection factory"),HeatmapGridRendererFactory:Symbol("Heatmap grid renderer factory"),HeatmapExtensionFactory:Symbol("Heatmap extension factory"),UITextListRendererFactory:Symbol("UITetList renderer factory"),CodeEditorServiceInputReceiverFactory:Symbol("CodeEditorServiceInputReceiver factory"),UIEditableTextListRendererFactory:Symbol("UIEditableTextListRenderer factory"),FileStorage:Symbol("File storage")},Z={Perspective:Symbol("UILabel perspective renderer"),Unique:Symbol("UILabel unique")},_={EditCellCommandFactory:Symbol("EditCellCommand factory"),EditCellsRegionFactory:Symbol("EditCellsRegion factory")},j={MoveNext:Symbol("MoveNext post action")},F={MoveNext:Symbol("MoveNext post action"),StayLeftTop:Symbol("StayLeftTop post action")};var k=i(963);const U=new k.W;var M,N=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},z=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},G=function(t,e){return function(i,o){e(i,o,t)}};let V=class{constructor(t){(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"ZNear",1),(0,x.Z)(this,"ZFar",500),(0,x.Z)(this,"Fovy",60/180*Math.PI),(0,x.Z)(this,"ZCameraBoundary",{min:50,max:250}),(0,x.Z)(this,"AspectRatio",1),(0,x.Z)(this,"ViewDimension",{Width:800,Height:600}),(0,x.Z)(this,"ExecutionTimeout",1e3),(0,x.Z)(this,"MaxOutputLength",1e3),(0,x.Z)(this,"MemoryLimit",{Width:80,Height:25}),this.gl=t,this.AspectRatio=this.gl.canvas.width/this.gl.canvas.height}get DevicePixelRatio(){return window.devicePixelRatio}};V=N([(0,w.b)(),G(0,(0,S.f)(L.WebGLRenderingContext)),z("design:paramtypes",["function"===typeof(M="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?M:Object])],V),U.bind(V).toSelf().inSingletonScope();var H=i(9358),W="#version 300 es\nprecision mediump float;\n\nin vec3 v_color;\n\nout vec4 out_color;\n\n\nvoid main() \n{\n      out_color = vec4(v_color, 1);\n}\n",Y="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\nin vec3 a_color;\n\nout vec3 v_color;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position = u_viewProject * vec4(a_vertex, 0.01, 1.0);\n\n  v_color = a_color;\n}\n",X="#version 300 es\nprecision mediump float;\n\nin vec2 v_glyph;\nin vec3 v_color;\n\nout vec4 out_color;\n\nuniform sampler2D u_glyph;\n\nvoid main() \n{\n      vec4 text_color = texture(u_glyph, v_glyph);\n \n      out_color = vec4(v_color - text_color.xyz, text_color.w);\n}\n",K="#version 300 es\nprecision mediump float;\n\nin vec4 a_vertex;\nin vec3 a_color;\nin vec2 a_glyph;\n\nout vec2 v_glyph;\nout vec3 v_color;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position = u_viewProject * a_vertex;\n\n  v_glyph = a_glyph;\n  v_color = a_color;\n}\n";function q(t){return Object.keys(t).length>>1}function $(t){throw new Error(t)}class Q{constructor(t,e,i,o,n){(0,x.Z)(this,"startSymbolCode",void 0),(0,x.Z)(this,"Columns",void 0),(0,x.Z)(this,"Rows",void 0),(0,x.Z)(this,"GlyphCount",void 0),(0,x.Z)(this,"Image",void 0),this.startSymbolCode=t,this.Columns=e,this.Rows=i,this.GlyphCount=o,this.Image=n}LookupUV(t){if(0===t.length)throw new Error("Symbol can't be empty string");const e=t.charCodeAt(0),i=e-this.startSymbolCode;if(i<0||i>=this.GlyphCount)throw new Error("The font atlas doesn't contain glyph for given symbol");const o=i%this.Columns,n=Math.floor(i/this.Columns),r=1/this.Columns,s=1/this.Rows,l={x:r*o,y:s*n};return{A:l,B:{x:l.x+r,y:l.y+s}}}}class J{constructor(){(0,x.Z)(this,"options",void 0),(0,x.Z)(this,"context",void 0)}Build(t){this.options=t;const e=t.ASCIIRange.Start.charCodeAt(0),i=t.ASCIIRange.End.charCodeAt(0);if(e>i)throw new Error("options.ASCIIRange.Start symbol must precede options.ASCIIRange.End");const o=i-e+1,n=Math.ceil(Math.sqrt(o)),r=Math.ceil(o/n),s=this.GlyphCellSize(),l=this.SetupCanvas(n*s,r*s);return this.FillCanvasWithGlyphs(o,n),new Q(e,n,r,o,this.context.getImageData(0,0,l.width,l.height))}SetupCanvas(t,e){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d")??$("Failed to get context");return o.font=`${this.options.Font.Size}px ${this.options.Font.Name}`,o.fillStyle="#000",this.context=o,i}FillCanvasWithGlyphs(t,e){for(let i=0;i<t;++i){const t=i%e,o=Math.floor(i/e),n=this.GlyphCellSize(),r=n/2,s={x:t*n+r,y:o*n+r},l=String.fromCharCode(this.options.ASCIIRange.Start.charCodeAt(0)+i),h=this.CenteredToBaseLine(s,l);this.context.fillText(l,h.x,h.y)}}GlyphCellSize(){return 10*Math.ceil(this.options.Font.Size/10)}CenteredToBaseLine(t,e){const i=this.context.measureText(e),o=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;return{x:t.x-i.width/2,y:t.y-i.actualBoundingBoxDescent+o/2}}}class tt{static Build(t){return(new J).Build(t)}}class et{static AABBRectangle(t,e,i){const o=[t.x,t.y],n=[t.x,t.y+e.height],r=[t.x+e.width,t.y+e.height],s=[t.x+e.width,t.y];for(const l of i)Array.isArray(l)?(o.push(...l),n.push(...l),r.push(...l),s.push(...l)):(o.push(...l.LeftBottom),n.push(...l.LeftTop),r.push(...l.RightTop),s.push(...l.RightBottom));return[...o,...r,...n,...o,...s,...r]}static AABBFrame(t,e,i,o){const n=et.AABBRectangle({x:t.x,y:t.y+e.height-i},{width:e.width,height:i},o),r=et.AABBRectangle({x:t.x+e.width-i,y:t.y},{width:i,height:e.height-i},o),s=et.AABBRectangle({x:t.x,y:t.y},{width:e.width-i,height:i},o),l=et.AABBRectangle({x:t.x,y:t.y+i},{width:i,height:e.height-2*i},o);return[...n,...r,...s,...l]}}i(8675),i(3408),i(4590),i(3462),i(1439),i(7585),i(5315);var it=i(6812);class ot{static Max(t,e){if(1===t.length)return t[0];let i=t[0];for(let o=1;o<t.length;++o)e(i,t[o])&&(i=t[o]);return i}static Min(t,e){if(1===t.length)return t[0];let i=t[0];for(let o=1;o<t.length;++o)e(t[o],i)&&(i=t[o]);return i}static Copy(t,e,i,o,n){for(let r=0;r<n;++r)t[e+r]=i[o+r]}}class nt{constructor(t){if((0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"uniformCache",new Map),(0,x.Z)(this,"instance",void 0),this.gl=t,!t)throw new Error("Invalid webgl2 context");this.instance=t.createProgram()??$("Can't create shader program")}Attach(t,e){const i=this.gl.createShader(t);if(null===i)throw new Error("Failed to create shader");if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const t=new Error(this.gl.getShaderInfoLog(i)??"Failed to compile shader");throw this.gl.deleteShader(i),t}this.gl.attachShader(this.instance,i)}async AttachFromUrl(t,e){this.Attach(t,await(await fetch(e)).text())}Link(){if(this.gl.linkProgram(this.instance),!this.gl.getProgramParameter(this.instance,this.gl.LINK_STATUS)){const t=new Error(this.gl.getProgramParameter(this.instance,this.gl.LINK_STATUS)??"Failed to link shader");throw this.gl.deleteProgram(this.instance),t}}Use(){this.gl.useProgram(this.instance)}SetUniform3fv(t,e){this.gl.uniform3fv(this.GetUniformLocation(t),e)}SetUniform2fv(t,e){this.gl.uniform2fv(this.GetUniformLocation(t),e)}SetUniform4fv(t,e){this.gl.uniform4fv(this.GetUniformLocation(t),e)}SetUniform1f(t,e){this.gl.uniform1f(this.GetUniformLocation(t),e)}SetUniform1i(t,e){this.gl.uniform1i(this.GetUniformLocation(t),e)}SetUniform2iv(t,e){this.gl.uniform2iv(this.GetUniformLocation(t),e)}SetUniformMatrix4fv(t,e){this.gl.uniformMatrix4fv(this.GetUniformLocation(t),!1,e)}GetAttributeLocation(t){this.Use();const e=this.gl.getAttribLocation(this.instance,t);if(-1===e)throw new Error(`Failed to locate attribute '${t}'`);return e}Dispose(){this.gl.deleteProgram(this.instance)}GetUniformLocation(t){this.Use();let e=this.uniformCache.get(t)??null;if(null===e){if(e=this.gl.getUniformLocation(this.instance,t),null===e)throw new Error(`Failed to locate uniform '${t}'`);this.uniformCache.set(t,e)}return e}}class rt{static Resolve(t){return rt.Sizes.find((e=>e[0]===t))[1]}}(0,x.Z)(rt,"Sizes",[[window.WebGL2RenderingContext.BYTE,Int8Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.SHORT,Int16Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_BYTE,Uint8Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_SHORT,Uint16Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.FLOAT,Float32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.HALF_FLOAT,2],[window.WebGL2RenderingContext.INT,Int32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.INT_2_10_10_10_REV,Int32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_INT_2_10_10_10_REV,Int32Array.BYTES_PER_ELEMENT]]);var st,lt=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ht=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},ct=function(t,e){return function(i,o){e(i,o,t)}};let at=class{constructor(t,e,i,o){(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"attributes",void 0),(0,x.Z)(this,"primitiveDescription",void 0),(0,x.Z)(this,"vbo",void 0),(0,x.Z)(this,"vao",void 0),(0,x.Z)(this,"shader",void 0),(0,x.Z)(this,"vertexData",new ArrayBuffer(0)),(0,x.Z)(this,"stride",0),(0,x.Z)(this,"componentsPerVertex",0),(0,x.Z)(this,"vertexCount",0),this.gl=t,this.attributes=i,this.primitiveDescription=o,this.Setup(e),this.SetupAttributes(i)}UploadAttributes(t){this.vertexCount=t.length/this.componentsPerVertex,this.vertexData=new ArrayBuffer(this.stride*this.vertexCount);for(let e=0;e<t.length;e+=this.componentsPerVertex)for(let i=0,o=0,n=0;i<this.attributes.length;o+=this.attributes[i].size,n+=rt.Resolve(this.attributes[i].type)*this.attributes[i].size,++i){const r=this.attributes[i];switch(r.type){case this.gl.FLOAT:{const i=new Float32Array(this.vertexData,e/this.componentsPerVertex*this.stride+n,r.size);i.set(t.slice(e+o,e+o+r.size))}break;case this.gl.UNSIGNED_INT:{const i=new Uint32Array(this.vertexData,e/this.componentsPerVertex*this.stride+n,r.size);i.set(t.slice(e+o,e+o+r.size))}break;default:throw new Error("Unsupported attribute type")}}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexData,this.gl.DYNAMIC_DRAW)}UpdatePrimitiveComponents(t,e){const i=e/this.componentsPerVertex*this.stride;for(let n=0;n<t.length;n+=this.componentsPerVertex)for(let e=0,o=i,r=0;e<this.attributes.length;r+=this.attributes[e].size,o+=rt.Resolve(this.attributes[e].type)*this.attributes[e].size,++e){const i=this.attributes[e];switch(i.type){case this.gl.FLOAT:{const e=new Float32Array(this.vertexData,n/this.componentsPerVertex*this.stride+o,i.size);e.set(t.slice(n+r,n+r+i.size))}break;case this.gl.UNSIGNED_INT:{const e=new Uint32Array(this.vertexData,n/this.componentsPerVertex*this.stride+o,i.size);e.set(t.slice(n+r,n+r+i.size))}break;default:throw new Error("Unsupported attribute type")}}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo);const o=new Uint8Array(this.vertexData,i,t.length/this.componentsPerVertex*this.stride);this.gl.bufferSubData(this.gl.ARRAY_BUFFER,i,o,0,o.length)}PrimitiveComponents(t){return this.PrimitiveComponentsRange(t,1)}PrimitiveComponentsRange(t,e){const i=new Array(this.ComponentsPerPrimitive*e).fill(0);for(let o=0,n=0;o<this.primitiveDescription.indicesPerPrimitive*e;++o){let e=(t*this.primitiveDescription.indicesPerPrimitive+o)*this.stride;for(const t of this.attributes){switch(t.type){case this.gl.FLOAT:{const o=new Float32Array(this.vertexData,e,t.size);ot.Copy(i,n,o,0,o.length)}break;case this.gl.UNSIGNED_INT:{const o=new Uint32Array(this.vertexData,e,t.size);ot.Copy(i,n,o,0,o.length)}break;default:throw new Error("Unsupported attribute type")}e+=rt.Resolve(t.type)*t.size,n+=t.size}}return i}get TotalPrimitives(){return this.vertexCount/this.primitiveDescription.indicesPerPrimitive}get ComponentsPerPrimitive(){return this.componentsPerVertex*this.primitiveDescription.indicesPerPrimitive}Draw(){this.shader.Use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.primitiveDescription.basePrimitiveType,0,this.vertexCount)}Dispose(){this.gl.deleteBuffer(this.vbo),this.gl.deleteVertexArray(this.vao),this.shader.Dispose()}Setup(t){this.vbo=this.gl.createBuffer()??$("Failed to create vbo"),this.vao=this.gl.createVertexArray()??$("Failed to create vao"),this.shader=new nt(this.gl),this.shader.Attach(this.gl.FRAGMENT_SHADER,t.fragment),this.shader.Attach(this.gl.VERTEX_SHADER,t.vertex),this.shader.Link(),this.shader.Use()}SetupAttributes(t){if(0===t.length)throw new Error("Attributes description can't be empty");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bindVertexArray(this.vao),[this.componentsPerVertex,this.stride]=t.reduce(((t,e)=>[t[0]+e.size,t[1]+e.size*rt.Resolve(e.type)]),[0,0]);for(let e=0,i=0;e<t.length;i+=t[e].size*rt.Resolve(t[e].type),++e){const o=t[e],n=this.shader.GetAttributeLocation(o.name);this.gl.enableVertexAttribArray(n),this.IsIntegerAttributesType(o)?this.gl.vertexAttribIPointer(n,o.size,o.type,this.stride,i):this.gl.vertexAttribPointer(n,o.size,o.type,o.normalized,this.stride,i)}this.gl.bindVertexArray(null)}IsIntegerAttributesType(t){return this.IntegerTypes.includes(t.type)}get IntegerTypes(){return[this.gl.BYTE,this.gl.UNSIGNED_BYTE,this.gl.SHORT,this.gl.UNSIGNED_SHORT,this.gl.INT,this.gl.UNSIGNED_INT]}};at=lt([(0,w.b)(),ct(0,(0,it.N)()),ct(1,(0,it.N)()),ct(2,(0,it.N)()),ct(3,(0,it.N)()),ht("design:paramtypes",["function"===typeof(st="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?st:Object,Object,Array,Object])],at);var dt,ut,ft,pt,gt,yt=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},bt=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},vt=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["R"]=2]="R",t[t["G"]=3]="G",t[t["B"]=4]="B",t[t["Ux"]=5]="Ux",t[t["Uy"]=6]="Uy"})(gt||(gt={}));let mt=class extends at{constructor(t,e,i,o){const n=rt.Resolve(e.FLOAT),r=n*q(gt);super(e,{fragment:X,vertex:K},[{name:"a_vertex",size:2,type:e.FLOAT,normalized:!1,stride:r,offset:0},{name:"a_color",size:3,type:e.FLOAT,normalized:!1,stride:r,offset:2*n},{name:"a_glyph",size:2,type:e.FLOAT,normalized:!1,stride:r,offset:2*n+3*n}],{indicesPerPrimitive:6,basePrimitiveType:e.TRIANGLES}),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"fontAtlas",void 0),(0,x.Z)(this,"fontAtlasTexture",void 0),(0,x.Z)(this,"CellSize",10),this.settings=t,this.fontAtlas=i,this.fontAtlasTexture=o,this.SetupRenderer()}ResizeGrid(){const t=[];for(let e=0;e<this.settings.MemoryLimit.Height;++e)for(let i=0;i<this.settings.MemoryLimit.Width;++i){const o=this.BuildCell({x:i*this.CellSize,y:e*this.CellSize},[0,.592156862745098,.6549019607843137]," ");t.push(...o)}this.UploadAttributes(t)}Symbol(t,e,i){i=this.settings.MemoryLimit.Height-i-1;const o=i*this.settings.MemoryLimit.Width+e,n=this.PrimitiveComponents(o),r=this.fontAtlas.LookupUV(t),s=5;n[s]=r.A.x,n[s+1]=r.B.y;const l=q(gt);n[s+l]=r.B.x,n[s+l+1]=r.A.y,n[s+2*l]=r.A.x,n[s+2*l+1]=r.A.y,n[s+3*l]=r.A.x,n[s+3*l+1]=r.B.y,n[s+4*l]=r.B.x,n[s+4*l+1]=r.B.y,n[s+5*l]=r.B.x,n[s+5*l+1]=r.A.y,this.UpdatePrimitiveComponents(n,o*this.ComponentsPerPrimitive)}Draw(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.fontAtlasTexture),super.Draw()}BuildCell(t,e,i){const o=this.fontAtlas.LookupUV(i);return et.AABBRectangle(t,{width:this.CellSize,height:this.CellSize},[e,{LeftBottom:[o.A.x,o.B.y],LeftTop:[o.A.x,o.A.y],RightTop:[o.B.x,o.A.y],RightBottom:[o.B.x,o.B.y]}])}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}get Dimension(){return{Columns:this.settings.MemoryLimit.Width,Rows:this.settings.MemoryLimit.Height}}SetupRenderer(){this.ResizeGrid()}};mt=yt([(0,w.b)(),vt(0,(0,S.f)(V)),vt(1,(0,S.f)(L.WebGLRenderingContext)),vt(2,(0,S.f)(L.FontAtlas)),vt(3,(0,S.f)(L.FontAtlasTexture)),bt("design:paramtypes",["function"===typeof(dt="undefined"!==typeof V&&V)?dt:Object,"function"===typeof(ut="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?ut:Object,"function"===typeof(ft="undefined"!==typeof Q&&Q)?ft:Object,"function"===typeof(pt="undefined"!==typeof WebGLTexture&&WebGLTexture)?pt:Object])],mt),U.bind(mt).toSelf().inSingletonScope();var xt,Ct,Rt,wt=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},St=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Pt=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["R"]=2]="R",t[t["G"]=3]="G",t[t["B"]=4]="B"})(Rt||(Rt={}));let Dt=class extends at{constructor(t,e){const i=rt.Resolve(t.FLOAT),o=i*q(Rt);super(t,{fragment:W,vertex:Y},[{name:"a_vertex",size:2,type:t.FLOAT,normalized:!1,stride:o,offset:0},{name:"a_color",size:3,type:t.FLOAT,normalized:!1,stride:o,offset:2*i}],{indicesPerPrimitive:6,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"gridRenderer",void 0),(0,x.Z)(this,"outlineWidth",.2),(0,x.Z)(this,"cellOutlineColor",[.5647058823529412,.6431372549019608,.6823529411764706]),(0,x.Z)(this,"gridOutlineWidth",.5),(0,x.Z)(this,"gridOutlineColor",[.20392156862745098,.596078431372549,.8588235294117647]),this.gl=t,this.gridRenderer=e,this.SetupRenderer()}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}SetupRenderer(){const t=[],e=et.AABBFrame({x:0,y:0},{width:this.gridRenderer.Dimension.Columns*this.gridRenderer.CellSize,height:this.gridRenderer.Dimension.Rows*this.gridRenderer.CellSize},this.gridOutlineWidth,[this.gridOutlineColor]);t.push(...e);for(let i=1;i<this.gridRenderer.Dimension.Rows;++i){const e=et.AABBRectangle({x:0,y:i*this.gridRenderer.CellSize},{width:this.gridRenderer.Dimension.Columns*this.gridRenderer.CellSize,height:this.outlineWidth},[this.cellOutlineColor]);t.push(...e)}for(let i=1;i<this.gridRenderer.Dimension.Columns;++i){const e=et.AABBRectangle({x:i*this.gridRenderer.CellSize,y:0},{width:this.outlineWidth,height:this.gridRenderer.Dimension.Rows*this.gridRenderer.CellSize},[this.cellOutlineColor]);t.push(...e)}this.UploadAttributes(t)}};Dt=wt([(0,w.b)(),Pt(0,(0,S.f)(L.WebGLRenderingContext)),Pt(1,(0,S.f)(mt)),St("design:paramtypes",["function"===typeof(xt="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?xt:Object,"function"===typeof(Ct="undefined"!==typeof mt&&mt)?Ct:Object])],Dt),U.bind(Dt).toSelf().inSingletonScope();var At,Ot,Tt,Et,It,Bt="#version 300 es\nprecision mediump float;\n\nin vec2 v_glyph;\nin vec3 v_color;\n\nout vec4 out_color;\n\nvoid main() \n{ \n      out_color = vec4(v_color, 1);\n}\n",Lt="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\nin vec3 a_color;\n\nout vec3 v_color;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position = u_viewProject * vec4(a_vertex, 0.02, 1.0);\n  v_color = a_color;\n}\n",Zt=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},_t=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},jt=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["R"]=2]="R",t[t["G"]=3]="G",t[t["B"]=4]="B"})(It||(It={}));let Ft=(At=class extends at{constructor(t,e){const i=rt.Resolve(t.FLOAT),o=i*q(It);super(t,{fragment:Bt,vertex:Lt},[{name:"a_vertex",size:2,type:t.FLOAT,normalized:!1,stride:o,offset:0},{name:"a_color",size:3,type:t.FLOAT,normalized:!1,stride:o,offset:2*i}],{indicesPerPrimitive:Ot.IndicesPerPrimitive,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"editorGridRenderer",void 0),(0,x.Z)(this,"selected",[]),this.editorGridRenderer=e}Select(t,e,i){this.SelectRegion({x:t,y:e},{x:t,y:e},i)}SelectRegion(t,e,i){const o=D.Extremum([this.FlipY(t),this.FlipY(e)]);if(this.OutOfGrid(o.min)||this.OutOfGrid(o.max))return;const n=this.selected.findIndex((t=>t.a.x===o.min.x&&t.a.y===o.min.y&&t.b.x===o.max.x&&t.b.y===o.max.y));if(-1!==n){const t=2,e=this.PrimitiveComponents(n),o=q(It);for(let n=0;n<Ot.IndicesPerPrimitive;++n){const r=t+n*o;e[r]=i[0],e[r+1]=i[1],e[r+2]=i[2]}this.UpdatePrimitiveComponents(e,n*o*Ot.IndicesPerPrimitive)}else{this.selected.push({a:o.min,b:o.max});const t=et.AABBFrame({x:o.min.x*this.editorGridRenderer.CellSize,y:o.min.y*this.editorGridRenderer.CellSize},{width:(o.max.x-o.min.x+1)*this.editorGridRenderer.CellSize,height:(o.max.y-o.min.y+1)*this.editorGridRenderer.CellSize},.5,[i]);this.UploadAttributes([...this.PrimitiveComponentsRange(0,this.TotalPrimitives),...t])}}OutOfGrid(t){return t.x<0||t.x>=this.editorGridRenderer.Dimension.Columns||t.y<0||t.y>=this.editorGridRenderer.Dimension.Rows}FlipY(t){return{x:t.x,y:this.editorGridRenderer.Dimension.Rows-t.y-1}}Unselect(t,e){this.UnselectRegion({x:t,y:e},{x:t,y:e})}UnselectRegion(t,e){const i=D.Extremum([this.FlipY(t),this.FlipY(e)]),o=this.selected.findIndex((t=>t.a.x===i.min.x&&t.a.y===i.min.y&&t.b.x===i.max.x&&t.b.y===i.max.y));if(-1===o)return;const n=this.PrimitiveComponentsRange(0,this.TotalPrimitives);n.splice(o*this.ComponentsPerPrimitive,this.ComponentsPerPrimitive),this.UploadAttributes(n),this.selected.splice(o,1)}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}},Ot=At,(0,x.Z)(At,"IndicesPerPrimitive",24),At);Ft=Ot=Zt([(0,w.b)(),jt(0,(0,S.f)(L.WebGLRenderingContext)),jt(1,(0,S.f)(mt)),_t("design:paramtypes",["function"===typeof(Tt="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Tt:Object,"function"===typeof(Et="undefined"!==typeof mt&&mt)?Et:Object])],Ft),U.bind(Ft).toSelf().inSingletonScope();var kt,Ut,Mt,Nt=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},zt=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Gt=function(t,e){return function(i,o){e(i,o,t)}};let Vt=class{constructor(t,e,i){(0,x.Z)(this,"editorGridRenderer",void 0),(0,x.Z)(this,"editorGridCellsOutlineRenderer",void 0),(0,x.Z)(this,"selectionRenderer",void 0),(0,x.Z)(this,"viewProjection",void 0),this.editorGridRenderer=t,this.editorGridCellsOutlineRenderer=e,this.selectionRenderer=i}set ViewProjection(t){this.viewProjection=t,this.editorGridRenderer.ViewProjection=t,this.editorGridCellsOutlineRenderer.ViewProjection=t,this.selectionRenderer.ViewProjection=t}get ViewProjection(){return this.viewProjection}Symbol(t,e,i){this.editorGridRenderer.Symbol(t,e,i)}Select(t,e,i){this.selectionRenderer.Select(t,e,i)}SelectRegion(t,e,i){this.selectionRenderer.SelectRegion(t,e,i)}Unselect(t,e){this.selectionRenderer.Unselect(t,e)}UnselectRegion(t,e){this.selectionRenderer.UnselectRegion(t,e)}Draw(){this.editorGridRenderer.Draw(),this.editorGridCellsOutlineRenderer.Draw(),this.selectionRenderer.Draw()}Clear(){for(let t=0;t<this.Dimension.Rows;++t)for(let e=0;e<this.Dimension.Columns;++e)this.Symbol(" ",e,t)}get Dimension(){return this.editorGridRenderer.Dimension}get CellSize(){return this.editorGridRenderer.CellSize}};Vt=Nt([(0,w.b)(),Gt(0,(0,S.f)(mt)),Gt(1,(0,S.f)(Dt)),Gt(2,(0,S.f)(Ft)),zt("design:paramtypes",["function"===typeof(kt="undefined"!==typeof mt&&mt)?kt:Object,"function"===typeof(Ut="undefined"!==typeof Dt&&Dt)?Ut:Object,"function"===typeof(Mt="undefined"!==typeof Ft&&Ft)?Mt:Object])],Vt),U.bind(Vt).toSelf().inSingletonScope();class Ht{static MoveRectangleToPlaceInsideRectangle(t,e){const i=D.Between(t.lb.x,e.lb.x,e.rt.x)&&D.Between(t.rt.x,e.lb.x,e.rt.x),o=D.Between(t.lb.y,e.lb.y,e.rt.y)&&D.Between(t.rt.y,e.lb.y,e.rt.y);if(i&&o)return{x:0,y:0};if(i){const i=Math.abs(t.rt.y-e.rt.y),o=Math.abs(t.lb.y-e.lb.y);return{x:0,y:i<o?-i:o}}if(o){const i=Math.abs(t.lb.x-e.lb.x),o=Math.abs(t.rt.x-e.rt.x);return{x:i<o?i:-o,y:0}}const n=[Ht.DistanceDiff(R.al(t.lb.x,t.lb.y),R.al(e.lb.x,e.lb.y)),Ht.DistanceDiff(R.al(t.lb.x,t.rt.y),R.al(e.lb.x,e.rt.y)),Ht.DistanceDiff(R.al(t.rt.x,t.rt.y),R.al(e.rt.x,e.rt.y)),Ht.DistanceDiff(R.al(t.rt.x,t.lb.y),R.al(e.rt.x,e.lb.y))],r=ot.Min(n,((t,e)=>t.distance<e.distance));return{x:r.diff[0],y:r.diff[1]}}static ShortestMoveForIntersection(t,e){const i=e.rt.x-t.lb.x,o=e.lb.x-t.rt.x,n=e.rt.y-t.lb.y,r=e.lb.y-t.rt.y,s=!(i<0||o>0),l=!(n<0||r>0);if(s&&l)return{x:0,y:0};const h=i<0?i:o>0?o:0,c=n<0?n:r>0?r:0;return{x:h,y:c}}static DistanceDiff(t,e){return{distance:R.TE(t,e),diff:R.lu(R.Ue(),e,t)}}}var Wt=i(5171);class Yt{static PlaneLine(t,e){const i=C.AK([t.a,t.b,t.c],e.a)+t.d,o=C.AK([t.a,t.b,t.c],e.b)+t.d,n=-i/(o-i),r=C.IH(C.Ue(),e.a,C.bA(C.Ue(),C.lu(C.Ue(),e.b,e.a),n));return[r[0],r[1],r[2]]}static AABBRectanglePoint(t,e){return e.x<=t.x+t.width&&e.x>=t.x&&e.y<=t.y+t.height&&e.y>=t.y}static RectangleRectangle(t,e){const i={x:t.x+t.width,y:t.y+t.height},o={x:e.x+e.width,y:e.y+e.height};return t.x<o.x&&i.x>e.x&&t.y<o.y&&i.y>e.y}static RangeRange(t,e){return t.min<e.max&&t.max>e.min}}class Xt{static Unproject(t,e,i){const o=C.al(t.x,t.y,t.z),n=Wt.al(2*o[0]/i.width-1,1-2*o[1]/i.height,2*o[2]-1,1),r=H.U_(H.Ue(),e),s=Wt.fF(Wt.Ue(),n,r);return s[3]=1/s[3],s[0]*=s[3],s[1]*=s[3],s[2]*=s[3],s}static UnprojectMovement(t,e,i,o){const n=Xt.Unproject({x:0,y:0,z:0},i,o),r=Xt.Unproject({x:0,y:0,z:1},i,o),s=Yt.PlaneLine(e,{a:[n[0],n[1],n[2]],b:[r[0],r[1],r[2]]}),l=Xt.Unproject({x:t.x,y:t.y,z:0},i,o),h=Xt.Unproject({x:t.x,y:t.y,z:1},i,o),c=Yt.PlaneLine(e,{a:[l[0],l[1],l[2]],b:[h[0],h[1],h[2]]}),a=R.lu(R.Ue(),R.al(s[0],s[1]),R.al(c[0],c[1]));return{x:a[0],y:a[1]}}}var Kt,qt,$t=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Qt=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Jt=function(t,e){return function(i,o){e(i,o,t)}};let te=class{constructor(t,e){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"codeEditorRenderer",void 0),(0,x.Z)(this,"camera",H.Ue()),(0,x.Z)(this,"projection",H.Ue()),(0,x.Z)(this,"viewProjection",H.Ue()),this.settings=t,this.codeEditorRenderer=e,this.UpdateProjection(),this.UpdateViewProjection()}MoveTo(t){void 0!==t.x&&(this.camera[12]=t.x),void 0!==t.y&&(this.camera[13]=t.y),void 0!==t.z&&(this.camera[14]=t.z),this.UpdateViewProjection(),this.MaintainCodeEditorVisible()}Translate(t){H.Iu(this.camera,this.camera,[t.x??0,t.y??0,t.z??0]),this.UpdateViewProjection(),this.MaintainCodeEditorVisible()}get Position(){return{x:this.camera[12],y:this.camera[13],z:this.camera[14]}}get ViewProjection(){return this.viewProjection}Resize(){this.UpdateProjection(),this.UpdateViewProjection()}UpdateProjection(){H.G3(this.projection,this.settings.Fovy,this.settings.AspectRatio,this.settings.ZNear,this.settings.ZFar)}UpdateViewProjection(){const t=H.U_(H.Ue(),this.camera);H.dC(this.viewProjection,this.projection,t)}MaintainCodeEditorVisible(){const t=this.codeEditorRenderer.CellSize,e=C.fF(C.Ue(),[t,t,0],this.viewProjection),i=C.fF(C.Ue(),[(this.settings.MemoryLimit.Width-1)*t,(this.settings.MemoryLimit.Height-1)*t,0],this.viewProjection),o=Ht.ShortestMoveForIntersection({lb:{x:e[0],y:e[1]},rt:{x:i[0],y:i[1]}},{lb:{x:-1,y:-1},rt:{x:1,y:1}});if(0===o.x&&0===o.y)return;const n={x:o.x*this.settings.ViewDimension.Width/2,y:o.y*this.settings.ViewDimension.Height/2},r=Xt.UnprojectMovement({x:n.x,y:-n.y},{a:0,b:0,c:1,d:0},this.ViewProjection,{width:this.settings.ViewDimension.Width,height:this.settings.ViewDimension.Height});H.Iu(this.camera,this.camera,[r.x,r.y,0]),this.UpdateViewProjection()}};te=$t([(0,w.b)(),Jt(0,(0,S.f)(V)),Jt(1,(0,S.f)(Vt)),Qt("design:paramtypes",["function"===typeof(Kt="undefined"!==typeof V&&V)?Kt:Object,"function"===typeof(qt="undefined"!==typeof Vt&&Vt)?qt:Object])],te),U.bind(te).toSelf().inSingletonScope();var ee,ie=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},oe=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},ne=function(t,e){return function(i,o){e(i,o,t)}};let re=class{constructor(t){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"skipUpdates",!1),(0,x.Z)(this,"components",[]),(0,x.Z)(this,"position",{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY}),(0,x.Z)(this,"absolutePosition",{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY}),(0,x.Z)(this,"dimension",{width:0,height:0}),this.settings=t}Watch(t){t.Observable.Attach((t=>this.ComponentUpdated(t))),this.components.push(t),this.ComponentUpdated(t)}get Position(){return this.position}get AbsolutePosition(){return this.absolutePosition}get Dimension(){return this.dimension}get Scale(){return this.settings.DevicePixelRatio}ComponentUpdated(t){if(!this.skipUpdates&&(t.Scale/this.settings.DevicePixelRatio<1||t.AbsolutePosition.x+t.Dimension.width>this.settings.ViewDimension.Width)){const e=10,i=this.settings.ViewDimension.Width/(t.Position.x+t.Dimension.width/t.Scale+e),o=Math.min(i/this.settings.DevicePixelRatio-Number.EPSILON,1);this.skipUpdates=!0,this.components.forEach((t=>t.Scale=o)),this.skipUpdates=!1}this.MaintainPositionDimension()}MaintainPositionDimension(){const t=D.Extremum(this.components.map((t=>({...t.Position}))));this.position.x=t.min.x,this.position.y=t.min.y;const e=D.Extremum(this.components.flatMap((t=>this.MapComponent(t))));this.absolutePosition.x=e.min.x,this.absolutePosition.y=e.min.y,this.dimension.width=e.max.x-e.min.x,this.dimension.height=e.max.y-e.min.y}MapComponent(t){const e=t.Dimension;return[t.AbsolutePosition,{x:t.AbsolutePosition.x+e.width,y:t.AbsolutePosition.y+e.height}]}};re=ie([(0,w.b)(),ne(0,(0,S.f)(V)),oe("design:paramtypes",["function"===typeof(ee="undefined"!==typeof V&&V)?ee:Object])],re),U.bind(re).toSelf().inSingletonScope();var se,le,he=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ce=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},ae=function(t,e){return function(i,o){e(i,o,t)}};let de=class{constructor(t,e){(0,x.Z)(this,"headlineLayout",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"skipUpdates",!1),(0,x.Z)(this,"debugGroup",void 0),(0,x.Z)(this,"verticalPosition",60),this.headlineLayout=t,this.settings=e}set DebugGroup(t){this.debugGroup=t,t.Observable.Attach((()=>this.DebugGroupUpdated()))}DebugGroupUpdated(){this.skipUpdates||queueMicrotask((()=>this.RecalculatePosition()))}RecalculatePosition(){const t=this.debugGroup.Dimension;if(Yt.RangeRange({min:this.debugGroup.AbsolutePosition.x,max:this.debugGroup.AbsolutePosition.x+t.width},{min:this.headlineLayout.AbsolutePosition.x,max:this.headlineLayout.AbsolutePosition.x+this.headlineLayout.Dimension.width})){const e=10;this.skipUpdates=!0,this.debugGroup.Position={x:this.debugGroup.Position.x,y:(this.settings.ViewDimension.Height-this.headlineLayout.AbsolutePosition.y)/this.headlineLayout.Scale+t.height/this.debugGroup.Scale+e},this.skipUpdates=!1}else this.skipUpdates=!0,this.debugGroup.Position={x:this.debugGroup.Position.x,y:this.verticalPosition},this.skipUpdates=!1}};de=he([(0,w.b)(),ae(0,(0,S.f)(re)),ae(1,(0,S.f)(V)),ce("design:paramtypes",["function"===typeof(se="undefined"!==typeof re&&re)?se:Object,"function"===typeof(le="undefined"!==typeof V&&V)?le:Object])],de),U.bind(de).toSelf().inSingletonScope();class ue extends Error{constructor(t,e,i){super(`An illegal instruction was executed.\nWith opcode ${e}(${i}) at location ${t.x}:${t.y}`),(0,x.Z)(this,"Where",void 0),(0,x.Z)(this,"Opcode",void 0),(0,x.Z)(this,"Symbol",void 0),this.Where=t,this.Opcode=e,this.Symbol=i}}var fe;(function(t){t[t["Right"]=0]="Right",t[t["Down"]=1]="Down",t[t["Left"]=2]="Left",t[t["Up"]=3]="Up"})(fe||(fe={}));const pe={Low:Number.NEGATIVE_INFINITY,Normal:0,High:Number.POSITIVE_INFINITY};class ge{constructor(){(0,x.Z)(this,"observers",[])}Attach(t,e={priority:pe.Normal}){const i={id:Symbol(),priority:e.priority,observer:t};return this.observers.push(i),this.MaintainSorted(),()=>this.observers.splice(this.observers.findIndex((t=>t.id===i.id)),1)}DetachAll(){this.observers=[]}Notify(t){this.observers.forEach((e=>e.observer(t)))}MaintainSorted(){for(let t=this.observers.length-1;t>0&&this.observers[t].priority>this.observers[t-1].priority;--t){const e=this.observers[t-1];this.observers[t-1]=this.observers[t],this.observers[t]=e}}}async function ye(t,e){return await e.AsyncConstructor(),e}class be{constructor(){(0,x.Z)(this,"rectangles",[])}Add(t){this.rectangles.push(t)}Pack(){let t=0,e=0;for(const l of this.rectangles)t+=l.width*l.height,e=Math.max(e,l.width);const i=Math.max(Math.ceil(Math.sqrt(t)),e);this.rectangles.sort(((t,e)=>e.height-t.height));const o=[];let n=0,r=0,s=0;for(const l of this.rectangles)r+l.width>i&&(r=0,s+=n,n=0),o.push({target:l,position:{x:r,y:s}}),n=Math.max(n,l.height),r+=l.width;return{items:o,dimension:{width:i,height:s+n}}}}class ve{constructor(t,e){(0,x.Z)(this,"Image",void 0),(0,x.Z)(this,"pack",void 0),this.Image=t,this.ClonePackage(e),this.NormalizePackage()}LookupUV(t){const e=this.pack.items.find((e=>e.target.id===t));return void 0===e?ve.UndefinedUV:{A:{x:e.position.x,y:e.position.y},B:{x:e.position.x+e.target.width,y:e.position.y+e.target.height}}}static IsUndefinedUV(t){return t===ve.UndefinedUV}ClonePackage(t){this.pack={dimension:{...t.dimension},items:t.items.map((t=>({position:{...t.position},target:{...t.target}})))}}NormalizePackage(){this.pack.items.forEach((t=>{t.position.x/=this.pack.dimension.width,t.position.y/=this.pack.dimension.height,t.target.width/=this.pack.dimension.width,t.target.height/=this.pack.dimension.height}))}}(0,x.Z)(ve,"UndefinedUV",{A:{x:-1,y:-1},B:{x:-1,y:-1}});class me{constructor(){(0,x.Z)(this,"images",[]),(0,x.Z)(this,"context",void 0)}Add(t,e,i){this.images.push({id:t,filename:e,...i})}async Build(){const t=new be;this.images.forEach((e=>t.Add(e)));const e=t.Pack();this.SetupCanvas(e.dimension.width,e.dimension.height);for(const i of e.items){const t=await me.CreateImage(i.target.filename);this.context.drawImage(t,i.position.x,i.position.y,i.target.width,i.target.height)}return new ve(this.context.getImageData(0,0,e.dimension.width,e.dimension.height),e)}SetupCanvas(t,e){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d")??$("Failed to get context");this.context=o}static async CreateImage(t){const e=new Image;return new Promise(((i,o)=>{e.onload=()=>i(e),e.onerror=()=>o(new Error("Failed to create an image")),e.src=`/befunge_ide/${t}`}))}}var xe,Ce=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};(function(t){t[t["Empty"]=0]="Empty",t[t["Open"]=1]="Open",t[t["Save"]=2]="Save",t[t["ArrowRight"]=3]="ArrowRight",t[t["ArrowDown"]=4]="ArrowDown",t[t["ArrowLeft"]=5]="ArrowLeft",t[t["ArrowUp"]=6]="ArrowUp",t[t["Debugger"]=7]="Debugger",t[t["Play"]=8]="Play",t[t["PlayDebug"]=9]="PlayDebug",t[t["DebugStepInto"]=10]="DebugStepInto",t[t["ExclamationCircle"]=11]="ExclamationCircle",t[t["ExclamationTriangle"]=12]="ExclamationTriangle",t[t["QuestionMark"]=13]="QuestionMark",t[t["CheckCircle"]=14]="CheckCircle",t[t["Breakpoint"]=15]="Breakpoint",t[t["ArrowThinAll"]=16]="ArrowThinAll",t[t["ArrowThinRight"]=17]="ArrowThinRight",t[t["ArrowThinDown"]=18]="ArrowThinDown",t[t["ArrowThinLeft"]=19]="ArrowThinLeft",t[t["ArrowThinUp"]=20]="ArrowThinUp",t[t["Delete"]=21]="Delete",t[t["Stop"]=22]="Stop",t[t["Heatmap"]=23]="Heatmap",t[t["Undo"]=24]="Undo",t[t["Redo"]=25]="Redo",t[t["Settings"]=26]="Settings",t[t["Select"]=27]="Select",t[t["Copy"]=28]="Copy",t[t["Cut"]=29]="Cut",t[t["Paste"]=30]="Paste",t[t["EditDelete"]=31]="EditDelete",t[t["Share"]=32]="Share",t[t["Input"]=33]="Input",t[t["Output"]=34]="Output",t[t["Keyboard"]=35]="Keyboard",t[t["Shift"]=36]="Shift",t[t["Backspace"]=37]="Backspace"})(xe||(xe={}));let Re=class{constructor(){(0,x.Z)(this,"atlas",void 0),(0,x.Z)(this,"iconExtras",[])}async AsyncConstructor(){await this.BuildAtlas()}LookupUV(t){switch(t){case xe.ArrowLeft:{const t=this.atlas.LookupUV(xe.ArrowRight);return{A:{x:t.B.x,y:t.B.y},B:{x:t.A.x,y:t.A.y},aspectRatio:this.ExtractAspectRatio(xe.ArrowRight)}}case xe.ArrowUp:{const t=this.atlas.LookupUV(xe.ArrowDown);return{A:{x:t.B.x,y:t.B.y},B:{x:t.A.x,y:t.A.y},aspectRatio:this.ExtractAspectRatio(xe.ArrowDown)}}case xe.ArrowThinLeft:{const t=this.atlas.LookupUV(xe.ArrowThinRight);return{A:{x:t.B.x,y:t.B.y},B:{x:t.A.x,y:t.A.y},aspectRatio:this.ExtractAspectRatio(xe.ArrowThinRight)}}case xe.ArrowThinDown:{const t=this.atlas.LookupUV(xe.ArrowThinUp);return{A:{x:t.B.x,y:t.B.y},B:{x:t.A.x,y:t.A.y},aspectRatio:this.ExtractAspectRatio(xe.ArrowThinUp)}}case xe.Undo:{const t=this.atlas.LookupUV(xe.Redo);return{A:{x:t.B.x,y:t.A.y},B:{x:t.A.x,y:t.B.y},aspectRatio:this.ExtractAspectRatio(xe.Redo)}}default:return{...this.atlas.LookupUV(t),aspectRatio:this.ExtractAspectRatio(t)}}}get Image(){return this.atlas.Image}ExtractAspectRatio(t){return this.iconExtras.find((e=>e.id===t)).aspectRatio}async BuildAtlas(){const t=new me,e=[{id:xe.Empty,filename:"ui_icons/empty.svg",dimension:{width:128,height:128}},{id:xe.ArrowRight,filename:"ui_icons/arrow_right.svg",dimension:{width:128,height:128}},{id:xe.ArrowDown,filename:"ui_icons/arrow_down.svg",dimension:{width:128,height:128}},{id:xe.Debugger,filename:"ui_icons/bug.svg",dimension:{width:128,height:128}},{id:xe.Open,filename:"ui_icons/open.svg",dimension:{width:128,height:128}},{id:xe.Save,filename:"ui_icons/save.svg",dimension:{width:128,height:128}},{id:xe.Play,filename:"ui_icons/play.svg",dimension:{width:128,height:128}},{id:xe.PlayDebug,filename:"ui_icons/play_debug.svg",dimension:{width:128,height:128}},{id:xe.DebugStepInto,filename:"ui_icons/debug_step_into.svg",dimension:{width:128,height:128}},{id:xe.ExclamationCircle,filename:"ui_icons/exclamation_circle.svg",dimension:{width:128,height:128}},{id:xe.ExclamationTriangle,filename:"ui_icons/exclamation_triangle.svg",dimension:{width:128,height:128}},{id:xe.QuestionMark,filename:"ui_icons/question_mark.svg",dimension:{width:128,height:128}},{id:xe.CheckCircle,filename:"ui_icons/check_circle.svg",dimension:{width:128,height:128}},{id:xe.Breakpoint,filename:"ui_icons/breakpoint.svg",dimension:{width:128,height:128}},{id:xe.ArrowThinAll,filename:"ui_icons/arrow_thin_all.svg",dimension:{width:128,height:128}},{id:xe.ArrowThinUp,filename:"ui_icons/arrow_thin_up.svg",dimension:{width:128,height:128}},{id:xe.ArrowThinRight,filename:"ui_icons/arrow_thin_right.svg",dimension:{width:128,height:128}},{id:xe.Delete,filename:"ui_icons/trash_can.svg",dimension:{width:128,height:128}},{id:xe.Stop,filename:"ui_icons/stop.svg",dimension:{width:128,height:128}},{id:xe.Heatmap,filename:"ui_icons/heatmap.svg",dimension:{width:128,height:128}},{id:xe.Redo,filename:"ui_icons/redo.svg",dimension:{width:128,height:128}},{id:xe.Settings,filename:"ui_icons/settings.svg",dimension:{width:128,height:128}},{id:xe.Select,filename:"ui_icons/select.svg",dimension:{width:128,height:128}},{id:xe.Copy,filename:"ui_icons/copy.svg",dimension:{width:128,height:128}},{id:xe.Cut,filename:"ui_icons/cut.svg",dimension:{width:128,height:128}},{id:xe.Paste,filename:"ui_icons/paste.svg",dimension:{width:128,height:128}},{id:xe.EditDelete,filename:"ui_icons/edit_delete.svg",dimension:{width:128,height:128}},{id:xe.Share,filename:"ui_icons/share.svg",dimension:{width:128,height:128}},{id:xe.Input,filename:"ui_icons/input.svg",dimension:{width:128,height:128}},{id:xe.Output,filename:"ui_icons/output.svg",dimension:{width:128,height:128}},{id:xe.Keyboard,filename:"ui_icons/keyboard.svg",dimension:{width:128,height:128}},{id:xe.Shift,filename:"ui_icons/shift.svg",dimension:{width:128,height:128}},{id:xe.Backspace,filename:"ui_icons/backspace.svg",dimension:{width:128,height:128}}];for(const i of e)t.Add(i.id,i.filename,i.dimension),this.iconExtras.push({id:i.id,aspectRatio:i.dimension.width/i.dimension.height});this.atlas=await t.Build()}};var we,Se;Re=Ce([(0,w.b)()],Re),U.bind(Re).toSelf().inSingletonScope().onActivation(ye),function(t){t[t["Left"]=0]="Left",t[t["Right"]=1]="Right",t[t["Middle"]=2]="Middle"}(we||(we={})),function(t){t[t["Bottom"]=0]="Bottom",t[t["Top"]=1]="Top"}(Se||(Se={}));class Pe{constructor(t,e={vertical:Se.Bottom,horizontal:we.Left}){(0,x.Z)(this,"position",void 0),(0,x.Z)(this,"anchor",void 0),(0,x.Z)(this,"observable",new ge),(0,x.Z)(this,"scale",1),(0,x.Z)(this,"childs",[]),(0,x.Z)(this,"updateNeeded",!1),(0,x.Z)(this,"dimension",{width:0,height:0}),this.position=t,this.anchor=e}Resize(){this.observable.Notify(this)}AppendChild(t){this.childs.push(t),this.updateNeeded||queueMicrotask((()=>this.UpdateChilds())),this.updateNeeded=!0}UpdateChilds(){this.CalculateDimension(),this.observable.Notify(this),this.updateNeeded=!1}RemoveChild(t){const e=this.childs.indexOf(t);-1!==e&&this.childs.splice(e,1),this.updateNeeded||queueMicrotask((()=>this.UpdateChilds())),this.updateNeeded=!0}get Observable(){return this.observable}get Position(){return this.position}set Position(t){this.position=t,this.observable.Notify(this)}get AbsolutePosition(){const t=U.get(V).ViewDimension;return{x:this.HorizontalPositionRespectAnchor(t.Width),y:this.VerticalPositionRespectAnchor(t.Height)}}get Scale(){return this.scale*U.get(V).DevicePixelRatio}set Scale(t){this.scale=t,this.observable.Notify(this)}get Dimension(){return this.dimension}CalculateDimension(){if(0===this.childs.length)return this.dimension.width=0,void(this.dimension.height=0);const t={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},e={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};for(const i of this.childs){Pe.MaintainExtremum(i.Position,{min:t,max:e});const o={x:i.Position.x*i.Scale+i.Dimension.width,y:i.Position.y*i.Scale+i.Dimension.height};Pe.MaintainExtremum(o,{min:t,max:e})}this.dimension.width=e.x-t.x,this.dimension.height=e.y-t.y}Destroy(){[...this.childs].forEach((t=>t.Destroy()))}static MaintainExtremum(t,e){t.x<e.min.x&&(e.min.x=t.x),t.x>e.max.x&&(e.max.x=t.x),t.y<e.min.y&&(e.min.y=t.y),t.y>e.max.y&&(e.max.y=t.y)}HorizontalPositionRespectAnchor(t){switch(this.anchor.horizontal){default:case we.Left:return this.position.x*this.Scale;case we.Right:return t-this.position.x*this.Scale;case we.Middle:return(t-this.Dimension.width)/2+this.Position.x}}VerticalPositionRespectAnchor(t){switch(this.anchor.vertical){default:case Se.Bottom:return this.position.y*this.Scale;case Se.Top:return t-this.position.y*this.Scale}}}var De="#version 300 es\nprecision mediump float;\n\nin vec2 v_icon;\nin vec3 v_fillColor;\nin vec3 v_iconColor;\n\nout vec4 out_color;\n\nuniform sampler2D u_icon;\n\nvoid main() \n{\n    vec4 text_color = texture(u_icon, v_icon);\n    out_color = mix(vec4(v_fillColor, 1.0), vec4(v_iconColor - text_color.xzy, 1.0), text_color.w);\n}\n",Ae="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\nin vec3 a_fillColor;\nin vec3 a_iconColor;\nin vec2 a_icon;\n\nout vec2 v_icon;\nout vec3 v_fillColor;\nout vec3 v_iconColor;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0) ;\n\n  v_icon = a_icon;\n  v_fillColor = a_fillColor;\n  v_iconColor = a_iconColor;\n}\n",Oe="#version 300 es\nprecision mediump float;\n\nin vec3 v_color;\n\nout vec4 out_color;\n\n\nvoid main() \n{\n      out_color = vec4(v_color, 1);\n}\n",Te="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\nin vec3 a_color;\n\nout vec3 v_color;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0) ;\n\n  v_color = a_color;\n}\n";class Ee{constructor(t,e,i,o,n,r,s,l,h=null){(0,x.Z)(this,"position",void 0),(0,x.Z)(this,"dimension",void 0),(0,x.Z)(this,"zIndex",void 0),(0,x.Z)(this,"icon",void 0),(0,x.Z)(this,"text",void 0),(0,x.Z)(this,"style",void 0),(0,x.Z)(this,"Offset",void 0),(0,x.Z)(this,"deleter",void 0),(0,x.Z)(this,"parent",void 0),(0,x.Z)(this,"observable",new ge),(0,x.Z)(this,"scale",1),(0,x.Z)(this,"isDestroyed",!1),(0,x.Z)(this,"parentDetacher",null),this.position=t,this.dimension=e,this.zIndex=i,this.icon=o,this.text=n,this.style=r,this.Offset=s,this.deleter=l,this.parent=h,this.parentDetacher=h?.Observable.Attach((()=>this.observable.Notify(this)))??null}Destroy(){this.isDestroyed=!0,this.Uninitialize(),this.parent?.RemoveChild(this),this.deleter(this),null!==this.parentDetacher&&this.parentDetacher()}get Observable(){return this.observable}get Position(){return this.position}set Position(t){this.position=t,this.observable.Notify(this)}get Dimension(){return{width:this.dimension.width*this.Scale,height:this.dimension.height*this.Scale}}set Dimension(t){this.dimension=t,this.observable.Notify(this)}get AbsolutePosition(){if(this.parent){const t=[this.parent.AbsolutePosition.x,this.parent.AbsolutePosition.y],e=R.IH(R.Ue(),t,[this.Position.x*this.Scale,this.Position.y*this.Scale]);return{x:e[0],y:e[1]}}return this.Position}get ZIndex(){return this.zIndex}set ZIndex(t){this.zIndex=t,this.observable.Notify(this)}get Scale(){return null===this.parent?this.scale:this.scale*this.parent.Scale}set Scale(t){this.scale=t,this.observable.Notify(this)}get Icon(){return this.icon}set Icon(t){this.icon={...t},this.observable.Notify(this)}get Text(){return this.text}set Text(t){this.text={...t},this.observable.Notify(this)}get Style(){return this.style}set Style(t){this.style={...t},this.observable.Notify(this)}get IsDestroyed(){return this.isDestroyed}Uninitialize(){this.position={x:0,y:0},this.dimension={width:0,height:0}}}class Ie{constructor(t){(0,x.Z)(this,"pool",void 0),(0,x.Z)(this,"nextFree",Ie.NoFree),(0,x.Z)(this,"size",0),this.pool=Array.from({length:t},((t,e)=>e+1)),t>0&&(this.pool[this.pool.length-1]=Ie.NoFree,this.nextFree=0)}Allocate(){if(++this.size,this.HasFreeSlot){const t=this.nextFree;return this.nextFree=this.pool[this.nextFree],this.pool[t]=Ie.InUse,t}{const t=this.pool.length;return this.nextFree=this.pool.length+1,this.pool=[...this.pool,...Array.from({length:this.pool.length*Ie.growthFactor-this.pool.length},((t,e)=>this.pool.length+e+1))],this.pool[this.pool.length-1]=Ie.NoFree,this.pool[t]=Ie.InUse,this.OnExtend(this.Capacity),t}}Free(t){t>=this.pool.length||this.pool[t]!==Ie.InUse||(this.pool[t]=this.nextFree,this.nextFree=t,--this.size,this.size/this.Capacity<=Ie.shrinkFactor&&(this.OnShrink(this.GatherInUseIndices()),this.Shrink()))}get Capacity(){return this.pool.length}get HasFreeSlot(){return this.nextFree<this.pool.length&&this.nextFree!==Ie.NoFree}GatherInUseIndices(){const t=[];for(let e=0;e<this.pool.length;++e)this.pool[e]===Ie.InUse&&t.push(e);return t}Shrink(){this.pool.splice(this.size,this.pool.length-this.size);for(let t=0;t<this.pool.length;++t)this.pool[t]=Ie.InUse;this.nextFree=Ie.NoFree}}(0,x.Z)(Ie,"NoFree",-1),(0,x.Z)(Ie,"InUse",-2),(0,x.Z)(Ie,"growthFactor",2),(0,x.Z)(Ie,"shrinkFactor",.25);var Be,Le,Ze,_e,je,Fe,ke=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ue=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Me=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z",t[t["R"]=3]="R",t[t["G"]=4]="G",t[t["B"]=5]="B"})(Fe||(Fe={}));let Ne=class extends at{constructor(t){const e=rt.Resolve(t.FLOAT),i=e*q(Fe);super(t,{fragment:De,vertex:Ae},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:0},{name:"a_fillColor",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:3*e},{name:"a_iconColor",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:6*e},{name:"a_icon",size:2,type:t.FLOAT,normalized:!1,stride:i,offset:9*e}],{indicesPerPrimitive:6,basePrimitiveType:t.TRIANGLES})}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}};Ne=ke([(0,w.b)(),Me(0,(0,S.f)(L.WebGLRenderingContext)),Ue("design:paramtypes",["function"===typeof(Be="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Be:Object])],Ne),U.bind(Ne).toSelf().inSingletonScope();let ze=class extends at{constructor(t,e,i,o,n){const r=rt.Resolve(t.FLOAT),s=r*q(Fe);super(t,{fragment:Oe,vertex:Te},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:s,offset:0},{name:"a_color",size:3,type:t.FLOAT,normalized:!1,stride:s,offset:3*r}],{indicesPerPrimitive:6,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"alertIcon",void 0),(0,x.Z)(this,"iconAtlas",void 0),(0,x.Z)(this,"iconAtlasTexture",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"zFarIncluded",.1),(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"alerts",[]),(0,x.Z)(this,"vertexAttributesTracker",void 0),(0,x.Z)(this,"panelContentZOffset",.001),(0,x.Z)(this,"iconMargin",10),this.alertIcon=e,this.iconAtlas=i,this.iconAtlasTexture=o,this.settings=n,this.vertexAttributesTracker=new class extends Ie{constructor(t){const e=1;super(e),(0,x.Z)(this,"renderer",void 0),this.renderer=t,t.UploadAttributes(Array.from({length:t.ComponentsPerPrimitive*e},(()=>0))),t.alertIcon.UploadAttributes(Array.from({length:this.renderer.alertIcon.ComponentsPerPrimitive*e},(()=>0)))}OnShrink(t){const e=new Array(this.renderer.ComponentsPerPrimitive*t.length).fill(0),i=new Array(this.renderer.alertIcon.ComponentsPerPrimitive*t.length).fill(0);for(let o=0;o<t.length;++o){const i=t[o],n=this.renderer.PrimitiveComponents(i);ot.Copy(e,o*this.renderer.ComponentsPerPrimitive,n,0,n.length);const r=this.renderer.alertIcon.PrimitiveComponents(i);ot.Copy(r,o*this.renderer.alertIcon.ComponentsPerPrimitive,r,0,r.length)}this.renderer.UploadAttributes(e),this.renderer.alertIcon.UploadAttributes(i),this.renderer.alerts.forEach((e=>{const i=t.indexOf(e.Offset);if(-1===i)throw new Error(`Can't find position for offset ${e.Offset}`);e.Offset=i}))}OnExtend(t){const e=this.renderer.PrimitiveComponentsRange(0,this.renderer.TotalPrimitives),i=Array.from({length:t*this.renderer.ComponentsPerPrimitive},((t,i)=>i<e.length?e[i]:0));this.renderer.UploadAttributes(i);const o=this.renderer.PrimitiveComponentsRange(0,this.renderer.TotalPrimitives),n=Array.from({length:t*this.renderer.alertIcon.ComponentsPerPrimitive},((t,e)=>e<o.length?o[e]:0));this.renderer.alertIcon.UploadAttributes(n)}}(this)}Create(t,e,i,o,n,r=null){const s=this.uiRenderer.CreateLabel(t,e+this.panelContentZOffset,o.text,o.lineHeight,r);s.StyleRange(0,s.Text.length,{color:o.color});const l=s.Dimension.height/s.Scale,h=new Ee(t,{width:l+3*this.iconMargin+s.Dimension.width/s.Scale,height:l+2*this.iconMargin},e,i,o,n,this.vertexAttributesTracker.Allocate(),(t=>this.Destroy(t,s)),r);return null!==r&&r.AppendChild(h),h.Observable.Attach((t=>this.UpdateComponent(t,s))),this.alerts.push(h),this.UpdateComponent(h,s),h}Draw(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.iconAtlasTexture),super.Draw(),this.alertIcon.Draw()}get UIRenderer(){return this.uiRenderer}set UIRenderer(t){this.uiRenderer=t}get Alerts(){return this.alerts}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t),this.alertIcon.ViewProjection=t}UpdateComponent(t,e){e.Position=this.LabelPosition(t,e),e.Text=t.Text.text,e.LineHeight=t.Text.lineHeight,this.UpdateAttributes(t)}LabelPosition(t,e){return{x:t.Position.x+2*this.iconMargin+(t.Dimension.height/t.Scale-2*this.iconMargin),y:t.Position.y+(t.Dimension.height/t.Scale-e.Dimension.height/e.Scale)/2}}UpdateAttributes(t){if(this.UpdatePrimitiveComponents(this.ExtractPanelAttributes(t),t.Offset*this.ComponentsPerPrimitive),t.IsDestroyed){const e=new Array(this.alertIcon.ComponentsPerPrimitive).fill(0);this.alertIcon.UpdatePrimitiveComponents(e,t.Offset*this.alertIcon.ComponentsPerPrimitive)}else this.alertIcon.UpdatePrimitiveComponents(this.ExtractIconAttributes(t),t.Offset*this.alertIcon.ComponentsPerPrimitive)}ExtractPanelAttributes(t){return et.AABBRectangle(t.AbsolutePosition,t.Dimension,[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor])}ExtractIconAttributes(t){const e=this.AlertIconSideLength(t),i=this.iconAtlas.LookupUV(t.Icon.icon);return et.AABBRectangle({x:t.AbsolutePosition.x+this.iconMargin,y:t.AbsolutePosition.y+this.iconMargin},{width:e,height:e},[[this.settings.ZFar-t.ZIndex-this.panelContentZOffset-this.zFarIncluded],t.Style.fillColor,t.Icon.color,{LeftBottom:[i.A.x,i.B.y],LeftTop:[i.A.x,i.A.y],RightTop:[i.B.x,i.A.y],RightBottom:[i.B.x,i.B.y]}])}AlertIconSideLength(t){return t.Dimension.height-2*this.iconMargin}Destroy(t,e){const i=this.alerts.indexOf(t);-1!==i&&(this.alerts.splice(i,1),this.UpdateAttributes(t),this.vertexAttributesTracker.Free(t.Offset),e.Destroy())}};ze=ke([(0,w.b)(),Me(0,(0,S.f)(L.WebGLRenderingContext)),Me(1,(0,S.f)(Ne)),Me(2,(0,S.f)(L.IconAtlas)),Me(3,(0,S.f)(L.IconAtlasTexture)),Me(4,(0,S.f)(V)),Ue("design:paramtypes",["function"===typeof(Le="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Le:Object,Ne,"function"===typeof(Ze="undefined"!==typeof Re&&Re)?Ze:Object,"function"===typeof(_e="undefined"!==typeof WebGLTexture&&WebGLTexture)?_e:Object,"function"===typeof(je="undefined"!==typeof V&&V)?je:Object])],ze),U.bind(ze).toSelf().inSingletonScope();var Ge="#version 300 es\nprecision mediump float;\n\nout vec4 out_color;\n\nvoid main() \n{\n      out_color = vec4(0.17254901960784313, 0.24313725490196078, 0.3137254901960784, 1);\n}",Ve="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0) ;\n}\n";class He{constructor(t,e,i,o,n,r,s,l,h){(0,x.Z)(this,"deleter",void 0),(0,x.Z)(this,"visible",!0),(0,x.Z)(this,"onVanish",new ge),(0,x.Z)(this,"textList",void 0),(0,x.Z)(this,"hasFocus",!1),(0,x.Z)(this,"onUpdate",new ge),this.deleter=l,this.textList=s.CreateTextList(t,e,i,o,n,r,h)}StyleRange(t,e,i){this.textList.StyleRange(t,e,i)}get OnVanish(){return this.onVanish}OnInput(t){const e=t.key.charCodeAt(0);if("Backspace"===t.key&&this.Text.length>0){const t=+("\n"===this.Text[this.Text.length-1]&&this.Text.length>1)+1;this.Text=this.Text.slice(0,this.Text.length-t)}else 1===t.key.length&&e>=" ".charCodeAt(0)&&e<="~".charCodeAt(0)?this.Text=this.Text+t.key:"Enter"===t.key&&(this.Text=this.Text+"\n")}get Position(){return this.textList.Position}set Position(t){this.textList.Position=t}get Dimension(){return this.textList.Dimension}set Dimension(t){this.textList.Dimension=t}get AbsolutePosition(){return this.textList.AbsolutePosition}get Text(){return this.textList.Text}set Text(t){this.textList.Text=t}get ZIndex(){return this.textList.ZIndex}set ZIndex(t){this.textList.ZIndex=t}get LineHeight(){return this.textList.LineHeight}set LineHeight(t){this.textList.LineHeight=t}get ContainerStyle(){return this.textList.ContainerStyle}set ContainerStyle(t){this.textList.ContainerStyle=t}get Scale(){return this.textList.Scale}set Scale(t){this.textList.Scale=t}get Visible(){return this.visible}set Visible(t){this.visible=t,t||this.onVanish.Notify(),this.textList.Visible=t}get Observable(){return this.onUpdate}get HasFocus(){return this.hasFocus}Focus(){this.hasFocus=!0}Blur(){this.hasFocus=!1}ScrollToTop(){this.textList.ScrollToTop()}ScrollAligned(t){this.textList.ScrollAligned(t)}Destroy(){this.onVanish.Notify(),this.onVanish.DetachAll(),this.onUpdate.DetachAll(),this.deleter(),this.textList.Destroy()}}var We,Ye,Xe=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ke=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},qe=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z"})(Ye||(Ye={}));let $e=class extends at{constructor(t){const e=rt.Resolve(t.FLOAT),i=e*q(Ye),o=6;super(t,{fragment:Ge,vertex:Ve},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:0}],{indicesPerPrimitive:o,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"uiRenderer",void 0)}Create(t,e,i,o,n,r,s,l=null){return new He(t,e,i,o,n,r,this.uiRenderer,s,l)}get UIRenderer(){return this.uiRenderer}set UIRenderer(t){this.uiRenderer=t}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}};$e=Xe([(0,w.b)(),qe(0,(0,S.f)(L.WebGLRenderingContext)),Ke("design:paramtypes",["function"===typeof(We="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?We:Object])],$e),U.bind($e).toSelf().inTransientScope(),U.bind(L.UIEditableTextListRendererFactory).toFactory((t=>e=>{const i=t.container.get($e);return i.UIRenderer=e,i}));var Qe="#version 300 es\nprecision mediump float;\n\nvec2 UndefinedUV = vec2(-1.0, -1.0);\n\nin vec2 v_icon;\nin vec3 v_fillColor;\nin vec3 v_iconColor;\n\nout vec4 out_color;\n\nuniform sampler2D u_icon;\n\nvoid main() \n{\n      if (v_icon.xy == UndefinedUV) {\n            out_color = vec4(v_fillColor, 1.0);\n      } else {\n            vec4 text_color = texture(u_icon, v_icon);\n            out_color = mix(vec4(v_fillColor, 1.0), vec4(v_iconColor - text_color.xzy, 1.0), text_color.w);\n      }\n}\n",Je="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\nin vec3 a_fillColor;\nin vec3 a_iconColor;\nin vec2 a_icon;\n\nout vec2 v_icon;\nout vec3 v_fillColor;\nout vec3 v_iconColor;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0) ;\n\n  v_icon = a_icon;\n  v_fillColor = a_fillColor;\n  v_iconColor = a_iconColor;\n}\n",ti="#version 300 es\nprecision mediump float;\n\nin vec3 v_color;\n\nout vec4 out_color;\n\n\nvoid main() \n{\n      out_color = vec4(v_color, 1);\n}\n",ei="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\nin vec3 a_color;\n\nout vec3 v_color;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0) ;\n\n  v_color = a_color;\n}\n";class ii{constructor(t,e,i,o,n,r,s,l,h=null){(0,x.Z)(this,"position",void 0),(0,x.Z)(this,"dimension",void 0),(0,x.Z)(this,"zIndex",void 0),(0,x.Z)(this,"style",void 0),(0,x.Z)(this,"iconStyle",void 0),(0,x.Z)(this,"touchCallback",void 0),(0,x.Z)(this,"Offset",void 0),(0,x.Z)(this,"deleter",void 0),(0,x.Z)(this,"parent",void 0),(0,x.Z)(this,"observable",new ge),(0,x.Z)(this,"scale",1),(0,x.Z)(this,"destroyed",!1),(0,x.Z)(this,"disabled",!1),(0,x.Z)(this,"originIconStyle",void 0),(0,x.Z)(this,"parentDetacher",null),this.position=t,this.dimension=e,this.zIndex=i,this.style=o,this.iconStyle=n,this.touchCallback=r,this.Offset=s,this.deleter=l,this.parent=h,this.parentDetacher=h?.Observable.Attach((()=>this.observable.Notify(this)))??null}get Observable(){return this.observable}get Position(){return this.position}set Position(t){this.position=t,this.observable.Notify(this)}get AbsolutePosition(){if(this.parent){const t=[this.parent.AbsolutePosition.x,this.parent.AbsolutePosition.y],e=R.IH(R.Ue(),t,[this.Position.x*this.Scale,this.Position.y*this.Scale]);return{x:e[0],y:e[1]}}return this.Position}get Dimension(){return{width:this.dimension.width*this.Scale,height:this.dimension.height*this.Scale}}set Dimension(t){this.dimension=t,this.observable.Notify(this)}get ZIndex(){return this.zIndex}set ZIndex(t){this.zIndex=t,this.observable.Notify(this)}get Icon(){return this.iconStyle}set Icon(t){this.iconStyle=t,this.observable.Notify(this)}get Style(){return this.style}set Style(t){this.style={...t},this.observable.Notify(this)}get Scale(){return null===this.parent?this.scale:this.scale*this.parent.Scale}set Scale(t){this.scale=t,this.observable.Notify(this)}get Destroyed(){return this.destroyed}get Disable(){return this.disabled}set Disable(t){t!==this.disabled&&(this.disabled=t,t?(this.originIconStyle={...this.iconStyle},this.iconStyle.color=ii.DisabledIconColor):this.iconStyle.color=this.originIconStyle.color,this.observable.Notify(this))}Touch(){this.disabled||this.touchCallback(this)}Destroy(){this.Uninitialize(),this.parent?.RemoveChild(this),this.deleter(this),this.Offset=ii.UninitializedTag,null!==this.parentDetacher&&this.parentDetacher()}Uninitialize(){this.position={x:0,y:0},this.dimension={width:0,height:0},this.destroyed=!0}}(0,x.Z)(ii,"DisabledIconColor",[.47058823529411764,.5647058823529412,.611764705882353]),(0,x.Z)(ii,"UninitializedTag",-1);var oi,ni,ri,si,li,hi=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ci=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},ai=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z",t[t["fillR"]=3]="fillR",t[t["fillG"]=4]="fillG",t[t["fillB"]=5]="fillB",t[t["iconR"]=6]="iconR",t[t["iconG"]=7]="iconG",t[t["iconB"]=8]="iconB",t[t["Ux"]=9]="Ux",t[t["Uy"]=10]="Uy"})(si||(si={})),function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z",t[t["R"]=3]="R",t[t["G"]=4]="G",t[t["B"]=5]="B"}(li||(li={}));class di extends at{constructor(t){const e=rt.Resolve(t.FLOAT),i=e*q(li);super(t,{fragment:ti,vertex:ei},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:0},{name:"a_color",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:3*e}],{indicesPerPrimitive:24,basePrimitiveType:t.TRIANGLES})}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}}let ui=class extends at{constructor(t,e,i){const o=rt.Resolve(t.FLOAT),n=o*q(si),r=18;super(t,{fragment:Qe,vertex:Je},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:n,offset:0},{name:"a_fillColor",size:3,type:t.FLOAT,normalized:!1,stride:n,offset:3*o},{name:"a_iconColor",size:3,type:t.FLOAT,normalized:!1,stride:n,offset:6*o},{name:"a_icon",size:2,type:t.FLOAT,normalized:!1,stride:n,offset:9*o}],{indicesPerPrimitive:r,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"iconAtlas",void 0),(0,x.Z)(this,"iconAtlasTexture",void 0),(0,x.Z)(this,"zFarIncluded",.1),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"iconButtons",[]),(0,x.Z)(this,"outline",void 0),(0,x.Z)(this,"vertexAttributesTracker",void 0),(0,x.Z)(this,"touchStart",[]),this.iconAtlas=e,this.iconAtlasTexture=i,this.settings=U.get(V),this.outline=new di(t),this.vertexAttributesTracker=new class extends Ie{constructor(t){const e=2;super(e),(0,x.Z)(this,"renderer",void 0),this.renderer=t,t.UploadAttributes(Array.from({length:t.ComponentsPerPrimitive*e},(()=>0))),t.outline.UploadAttributes(Array.from({length:t.outline.ComponentsPerPrimitive*e},(()=>0)))}OnShrink(t){const e=new Array(this.renderer.ComponentsPerPrimitive*t.length).fill(0),i=new Array(this.renderer.outline.ComponentsPerPrimitive*t.length).fill(0);for(let o=0;o<t.length;++o){const i=t[o],n=this.renderer.PrimitiveComponents(i);ot.Copy(e,o*this.renderer.ComponentsPerPrimitive,n,0,n.length);const r=this.renderer.PrimitiveComponents(i);ot.Copy(e,o*this.renderer.outline.ComponentsPerPrimitive,r,0,r.length)}this.renderer.UploadAttributes(e),this.renderer.outline.UploadAttributes(i),this.renderer.iconButtons.forEach((e=>{const i=t.indexOf(e.Offset);if(-1===i)throw new Error(`Can't find position for offset ${e.Offset}`);e.Offset=i}))}OnExtend(t){const e=this.renderer.PrimitiveComponentsRange(0,this.renderer.TotalPrimitives),i=Array.from({length:t*this.renderer.ComponentsPerPrimitive},((t,i)=>i<e.length?e[i]:0));this.renderer.UploadAttributes(i);const o=this.renderer.outline.PrimitiveComponentsRange(0,this.renderer.outline.TotalPrimitives),n=Array.from({length:t*this.renderer.outline.ComponentsPerPrimitive},((t,e)=>e<o.length?o[e]:0));this.renderer.outline.UploadAttributes(n)}}(this)}Create(t,e,i,o,n,r,s){const l=new ii(t,e,i,o,n,(t=>this.TouchProxy(t,r)),this.vertexAttributesTracker.Allocate(),(t=>this.Destroy(t)),s);return null!==s&&s.AppendChild(l),l.Observable.Attach((t=>this.UpdateAttributes(t))),this.iconButtons.push(l),null===s&&this.UpdateAttributes(l),l}TouchProxy(t,e){const i=this.touchStart.findIndex((e=>e.target===t));if(-1!==i){const t=this.touchStart[i];t.target.Style={...t.target.Style,fillColor:t.originFillColor},this.touchStart.splice(i,1)}this.touchStart.push({target:t,originFillColor:t.Style.fillColor,timestamp:Date.now()}),e(t)}Destroy(t){const e=this.iconButtons.indexOf(t);-1!==e&&(this.iconButtons.splice(e,1),this.UpdateAttributes(t),this.vertexAttributesTracker.Free(t.Offset))}Draw(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.iconAtlasTexture),this.TouchAnimation(),super.Draw(),this.outline.Draw()}TouchAnimation(){const t=80,e=100,i=1.2,o=[],n=[];for(const r of this.touchStart)r.target.Destroyed||(Date.now()-r.timestamp<=t+e?o.push(r):n.push(r));this.touchStart=o,n.forEach((t=>t.target.Style={...t.target.Style,fillColor:t.originFillColor}));for(const r of this.touchStart){const o=[...r.target.Style.fillColor],n=Date.now()-r.timestamp;if(n<=t){const e=n/t,s=1+(i-1)*e;o[0]=Math.min(1,r.originFillColor[0]*s),o[1]=Math.min(1,r.originFillColor[1]*s),o[2]=Math.min(1,r.originFillColor[2]*s)}else{const s=(n-t)/e,l=1+(i-1)*(1-s);o[0]=Math.min(1,r.originFillColor[0]*l),o[1]=Math.min(1,r.originFillColor[1]*l),o[2]=Math.min(1,r.originFillColor[2]*l)}r.target.Style={...r.target.Style,fillColor:o}}}get IconButtons(){return this.iconButtons}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t),this.outline.ViewProjection=t}UpdateAttributes(t){this.UpdateContentAttributes(t),t.Destroyed?this.ResetOutlineAttributes(t):this.UpdateOutlineAttributes(t)}UpdateContentAttributes(t){this.UpdatePrimitiveComponents(this.ExtractContentAttributes(t),t.Offset*this.ComponentsPerPrimitive)}ResetOutlineAttributes(t){this.outline.UpdatePrimitiveComponents(new Array(this.outline.ComponentsPerPrimitive).fill(0),t.Offset*this.outline.ComponentsPerPrimitive)}UpdateOutlineAttributes(t){this.outline.UpdatePrimitiveComponents(this.ExtractOutlineAttributes(t),t.Offset*this.outline.ComponentsPerPrimitive)}ExtractContentAttributes(t){const e=this.iconAtlas.LookupUV(t.Icon.icon);if(ve.IsUndefinedUV(e))throw new Error(`Can't find icon with id ${t.Icon.icon}`);return t.Dimension.width/t.Dimension.height>=1?this.ExtractContentAttributesWide(t,e):this.ExtractContentAttributesTall(t,e)}ExtractContentAttributesWide(t,e){const i=t.Dimension.height*e.aspectRatio,o=(t.Dimension.width-i)/2,n=et.AABBRectangle(t.AbsolutePosition,{width:o,height:t.Dimension.height},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor,t.Icon.color,[-1,-1]]),r=et.AABBRectangle({x:t.AbsolutePosition.x+o,y:t.AbsolutePosition.y},{width:i,height:t.Dimension.height},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor,t.Icon.color,{LeftBottom:[e.A.x,e.B.y],LeftTop:[e.A.x,e.A.y],RightTop:[e.B.x,e.A.y],RightBottom:[e.B.x,e.B.y]}]),s=et.AABBRectangle({x:t.AbsolutePosition.x+o+i,y:t.AbsolutePosition.y},{width:o,height:t.Dimension.height},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor,t.Icon.color,[-1,-1]]);return[...n,...r,...s]}ExtractContentAttributesTall(t,e){const i=t.Dimension.width/e.aspectRatio,o=(t.Dimension.height-i)/2,n=et.AABBRectangle(t.AbsolutePosition,{width:t.Dimension.width,height:o},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor,t.Icon.color,[-1,-1]]),r=et.AABBRectangle({x:t.AbsolutePosition.x,y:t.AbsolutePosition.y+o},{width:t.Dimension.width,height:i},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor,t.Icon.color,{LeftBottom:[e.A.x,e.B.y],LeftTop:[e.A.x,e.A.y],RightTop:[e.B.x,e.A.y],RightBottom:[e.B.x,e.B.y]}]),s=et.AABBRectangle({x:t.AbsolutePosition.x,y:t.AbsolutePosition.y+o+i},{width:t.Dimension.width,height:o},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.fillColor,t.Icon.color,[-1,-1]]);return[...n,...r,...s]}ExtractOutlineAttributes(t){const e=2;return et.AABBFrame({x:t.AbsolutePosition.x-e,y:t.AbsolutePosition.y-e},{width:t.Dimension.width+2*e,height:t.Dimension.height+2*e},e*t.Scale,[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],t.Style.outlineColor])}};ui=hi([(0,w.b)(),ai(0,(0,S.f)(L.WebGLRenderingContext)),ai(1,(0,S.f)(L.IconAtlas)),ai(2,(0,S.f)(L.IconAtlasTexture)),ci("design:paramtypes",["function"===typeof(oi="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?oi:Object,"function"===typeof(ni="undefined"!==typeof Re&&Re)?ni:Object,"function"===typeof(ri="undefined"!==typeof WebGLTexture&&WebGLTexture)?ri:Object])],ui),U.bind(ui).toSelf().inSingletonScope();var fi="#version 300 es\nprecision mediump float;\n\nin vec3 v_color;\nin vec2 v_glyph;\n\nout vec4 out_color;\n\nuniform sampler2D u_icon;\n\nvoid main() \n{\n    vec4 text_color = texture(u_icon, v_glyph);\n    //out_color = mix(vec4(1.0, 0, 0, 1.0), vec4(v_color - text_color.xzy, 1.0), text_color.w);\n\n    out_color = vec4(v_color - text_color.xzy, text_color.w);\n}\n",pi="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\nin vec3 a_color;\nin vec2 a_glyph;\n\nout vec3 v_color;\nout vec2 v_glyph;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0);\n\n  v_color = a_color;\n  v_glyph = a_glyph;\n}\n";class gi{constructor(t,e,i,o,n,r){(0,x.Z)(this,"position",void 0),(0,x.Z)(this,"text",void 0),(0,x.Z)(this,"lineHeight",void 0),(0,x.Z)(this,"zIndex",void 0),(0,x.Z)(this,"glyphAllocator",void 0),(0,x.Z)(this,"parent",void 0),(0,x.Z)(this,"scale",1),(0,x.Z)(this,"symbolsStyle",void 0),(0,x.Z)(this,"offsets",[]),(0,x.Z)(this,"observable",new ge),(0,x.Z)(this,"dimension",{width:0,height:0}),(0,x.Z)(this,"parentDetacher",null),(0,x.Z)(this,"updateNeeded",!1),this.position=t,this.text=e,this.lineHeight=i,this.zIndex=o,this.glyphAllocator=n,this.parent=r,this.symbolsStyle=[],this.ResizeSymbolStyles(),this.AdjustPoolMemory(),this.parentDetacher=r?.Observable.Attach((()=>this.DeferredNotify()))??null}StyleRange(t,e,i){for(let o=t;o<e;++o)this.symbolsStyle[o]={...i};this.DeferredNotify()}ReplaceOffset(t,e){this.offsets[this.offsets.indexOf(t)]=e}get Style(){return this.symbolsStyle}get Position(){return this.position}set Position(t){this.position=t,this.DeferredNotify()}get AbsolutePosition(){if(this.parent){const t=[this.parent.AbsolutePosition.x,this.parent.AbsolutePosition.y],e=R.IH(R.Ue(),t,[this.Position.x*this.Scale,this.Position.y*this.Scale]);return{x:e[0],y:e[1]}}return this.Position}get Text(){return this.text}set Text(t){this.text=t,this.ResizeSymbolStyles(),this.AdjustPoolMemory(),this.DeferredNotify()}get LineHeight(){return this.lineHeight}set LineHeight(t){this.lineHeight=t,this.DeferredNotify()}get ZIndex(){return this.zIndex}set ZIndex(t){this.zIndex=t,this.DeferredNotify()}get Scale(){return null===this.parent?this.scale:this.scale*this.parent.Scale}set Scale(t){this.scale=t,this.DeferredNotify()}get Dimension(){return{...this.dimension}}UpdateTextDimension(t){this.dimension=t}get Offsets(){return this.offsets}get Observable(){return this.observable}get PrintableTextLength(){return this.text.split("").filter((t=>!gi.NonPrintableSymbols.includes(t))).length}get PrintableOffsetLength(){return this.offsets.filter((t=>t!==gi.NonPrintableOffset)).length}Destroy(){this.Uninitialize(),this.parent?.RemoveChild(this),null!==this.parentDetacher&&this.parentDetacher()}DeferredNotify(){this.updateNeeded||(this.updateNeeded=!0,queueMicrotask((()=>this.Notify())))}Notify(){this.observable.Notify(this),this.updateNeeded=!1}Uninitialize(){this.Text=""}ExtendPoolMemory(){let t=this.PrintableTextLength-this.PrintableOffsetLength;while(t-- >0){const t=this.glyphAllocator.Allocate(this);this.offsets.push(t)}}ShrinkPoolMemory(){const t=this.PrintableOffsetLength-this.PrintableTextLength;for(let e=this.offsets.length-1,i=0;i<t;--e){const t=this.offsets[e];t!==gi.NonPrintableOffset&&(this.glyphAllocator.Free(t),this.offsets.splice(e,1),++i)}}AdjustPoolMemory(){this.PrintableTextLength>this.PrintableOffsetLength?this.ExtendPoolMemory():this.PrintableTextLength<this.PrintableOffsetLength&&this.ShrinkPoolMemory(),this.text.length>this.offsets.length?this.AddExtraNonPrintableOffsets():this.offsets.length>this.text.length&&this.RemoveExcessNonPrintableOffsets(),this.AdjustNonPrintableOffsets()}AddExtraNonPrintableOffsets(){let t=this.text.length-this.offsets.length;while(t-- >0)this.offsets.push(gi.NonPrintableOffset)}RemoveExcessNonPrintableOffsets(){const t=this.offsets.length-this.text.length;for(let e=this.offsets.length-1,i=0;i<t;--e){const t=this.offsets[e];t===gi.NonPrintableOffset&&(this.offsets.splice(e,1),++i)}}AdjustNonPrintableOffsets(){for(let t=0,e=0;t<this.text.length;++t){const i=this.text[t],o=this.offsets[t];if(gi.NonPrintableSymbols.includes(i)&&o!==gi.NonPrintableOffset){const i=this.offsets.slice(e).findIndex(((t,i)=>t===gi.NonPrintableOffset&&!gi.NonPrintableSymbols.includes(this.text[e+i])))+e;this.offsets[t]=gi.NonPrintableOffset,this.offsets[i]=o,e=i+1}}}ExtendSymbolStyles(){this.symbolsStyle=[...this.symbolsStyle,...Array.from({length:this.text.length},(()=>({...gi.DefaultSymbolStyle})))]}ShrinkSymbolStyles(){this.symbolsStyle.splice(this.text.length,this.symbolsStyle.length-this.text.length)}ResizeSymbolStyles(){this.text.length>this.symbolsStyle.length?this.ExtendSymbolStyles():this.text.length<this.symbolsStyle.length&&this.ShrinkSymbolStyles()}}(0,x.Z)(gi,"NonPrintableOffset",-1),(0,x.Z)(gi,"NonPrintableSymbols",["\r","\n"]),(0,x.Z)(gi,"DefaultSymbolStyle",{color:[0,0,0]});class yi{constructor(t,e){(0,x.Z)(this,"fn",void 0),(0,x.Z)(this,"args",void 0),this.fn=t,this.args=e}CatchFn(t,...e){try{return this.fn(...this.args)}catch(i){return t(...e)}}CatchValue(t){try{return this.fn(...this.args)}catch(e){return t}}}class bi{static Try(t,...e){return new yi(t,e)}}class vi{constructor(t,e){(0,x.Z)(this,"fn",void 0),(0,x.Z)(this,"args",void 0),this.fn=t,this.args=e}async CatchFn(t,...e){try{return await this.fn(...this.args)}catch(i){return await t(...e)}}async CatchValue(t){try{return await this.fn(...this.args)}catch(e){return await t}}}class mi{static Try(t,...e){return new vi(t,e)}}var xi,Ci=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ri=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},wi=function(t,e){return function(i,o){e(i,o,t)}};class Si{constructor(t,e){(0,x.Z)(this,"library",void 0),(0,x.Z)(this,"LineHeight",void 0),this.library=t,this.LineHeight=e}Lookup(t){if(0===t.length)throw new Error("Symbol can't be empty string");const e=this.library.get(t);if(void 0===e)throw new Error(`Failed to find glyph '${t}'`);return e}}let Pi=class{constructor(t){(0,x.Z)(this,"fontAtlas",void 0),(0,x.Z)(this,"options",void 0),(0,x.Z)(this,"context",void 0),(0,x.Z)(this,"lib",new Map),this.fontAtlas=t}Build(t){this.options=t;const e=t.ASCIIRange.Start.charCodeAt(0),i=t.ASCIIRange.End.charCodeAt(0);if(e>i)throw new Error("options.ASCIIRange.Start symbol must precede options.ASCIIRange.End");const o=this.GlyphCellSize();return this.SetupCanvas(o,o),this.BuildBlueprints(i-e+1),new Si(this.lib,t.Font.Size)}SetupCanvas(t,e){const i=document.createElement("canvas");i.width=t,i.height=e;const o=i.getContext("2d")??$("Failed to get context");o.font=`${this.options.Font.Size}px ${this.options.Font.Name}`,o.fillStyle="#000",this.context=o}GlyphCellSize(){return 10*Math.ceil(this.options.Font.Size/10)}BuildBlueprints(t){for(let e=0;e<t;++e){const t=String.fromCharCode(this.options.ASCIIRange.Start.charCodeAt(0)+e),i=this.fontAtlas.LookupUV(t),o=this.context.measureText(t),n=o.width,r=this.options.Font.Size/6.4,s=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent+r,l=this.AtlasCellToGlyphUV({uv:i,sideLength:this.GlyphCellSize()},{width:n,height:s}),h={x:0,y:o.fontBoundingBoxDescent-o.actualBoundingBoxDescent};this.lib.set(t,{uv:l,width:n,height:s,baselineOffset:h})}}AtlasCellToGlyphUV(t,e){const i={x:(t.sideLength-e.width)/2,y:(t.sideLength-e.height)/2},o={x:i.x+e.width,y:i.y+e.height},n=t.uv.B.x-t.uv.A.x,r=t.uv.B.y-t.uv.A.y;return{A:{x:t.uv.A.x+i.x/t.sideLength*n,y:t.uv.A.y+i.y/t.sideLength*r},B:{x:t.uv.A.x+o.x/t.sideLength*n,y:t.uv.A.y+o.y/t.sideLength*r}}}};function Di(t,e){return t[e].bind(t)}Pi=Ci([(0,w.b)(),wi(0,(0,S.f)(L.FontAtlas)),Ri("design:paramtypes",["function"===typeof(xi="undefined"!==typeof Q&&Q)?xi:Object])],Pi),U.bind(Pi).toSelf().inRequestScope(),U.bind(L.FontGlyphCollectionFactory).toFactory((t=>e=>t.container.get(Pi).Build(e)));var Ai,Oi,Ti,Ei,Ii,Bi,Li=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Zi=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},_i=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z",t[t["R"]=3]="R",t[t["G"]=4]="G",t[t["B"]=5]="B",t[t["Ux"]=6]="Ux",t[t["Uy"]=7]="Uy"})(Bi||(Bi={}));let ji=Ai=class extends at{constructor(t,e,i,o){const n=rt.Resolve(t.FLOAT),r=n*q(Bi),s=6;super(t,{fragment:fi,vertex:pi},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:r,offset:0},{name:"a_color",size:3,type:t.FLOAT,normalized:!1,stride:r,offset:3*n},{name:"a_glyph",size:2,type:t.FLOAT,normalized:!1,stride:r,offset:6*n}],{indicesPerPrimitive:s,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"fontTexture",void 0),(0,x.Z)(this,"fontGlyphCollectionFactory",void 0),(0,x.Z)(this,"IndicesPerPrimitive",void 0),(0,x.Z)(this,"AttributesPerComponent",void 0),(0,x.Z)(this,"zFarIncluded",.1),(0,x.Z)(this,"labels",new Map),(0,x.Z)(this,"vertexAttributesTracker",void 0),this.settings=e,this.fontTexture=i,this.fontGlyphCollectionFactory=o,this.IndicesPerPrimitive=s,this.AttributesPerComponent=q(Bi)*this.IndicesPerPrimitive,this.vertexAttributesTracker=new class extends Ie{constructor(t){const e=256;super(e),(0,x.Z)(this,"renderer",void 0),this.renderer=t,t.UploadAttributes(Array.from({length:t.AttributesPerComponent*e},(()=>0)))}Free(t){const e=new Array(this.renderer.AttributesPerComponent).fill(0);this.renderer.UpdatePrimitiveComponents(e,t*this.renderer.AttributesPerComponent),super.Free(t)}OnShrink(t){const e=new Array(this.renderer.AttributesPerComponent*t.length).fill(0);for(let i=0;i<t.length;++i){const o=t[i],n=this.renderer.PrimitiveComponents(o);ot.Copy(e,i*this.renderer.AttributesPerComponent,n,0,n.length)}this.renderer.UploadAttributes(e),t.forEach(((t,e)=>{const i=this.renderer.labels.get(t);void 0!==i&&(this.renderer.labels.delete(t),this.renderer.labels.set(e,i),i.ReplaceOffset(t,e))}))}OnExtend(t){const e=this.renderer.PrimitiveComponentsRange(0,this.renderer.TotalPrimitives),i=Array.from({length:t*this.renderer.ComponentsPerPrimitive},((t,i)=>i<e.length?e[i]:0));this.renderer.UploadAttributes(i)}}(this)}get Labels(){return[...new Set([...this.labels.values()]).values()]}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}Create(t,e,i,o,n){const r=new gi(t,i,o,e,{Allocate:t=>this.AllocateGlyph(t),Free:t=>this.GlyphFree(t)},n);return null!==n&&n.AppendChild(r),r.Observable.Attach((t=>this.UpdateAttributes(t))),this.UpdateAttributes(r),r}Draw(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.fontTexture),super.Draw()}AllocateGlyph(t){const e=this.vertexAttributesTracker.Allocate();return this.labels.set(e,t),e}GlyphFree(t){this.labels.delete(t),this.vertexAttributesTracker.Free(t)}UpdateAttributes(t){const e=this.fontGlyphCollectionFactory({ASCIIRange:{Start:" ",End:"~"},Font:{Name:"Roboto",Size:t.LineHeight}});let i=0;const o=Ai.SplitString(t.Text);if(0===o.length)return void t.UpdateTextDimension({width:0,height:0});const n=Ai.MinBaseOffset(o[o.length-1].text,t,e);let{x:r,y:s}={x:t.AbsolutePosition.x,y:t.AbsolutePosition.y-n};for(let l=o.length-1;l>=0;--l){const h=o[l];if(0!==h.text.length){for(let o=0;o<h.text.length;++o){const n=h.text[o],l=t.Style[h.startIdx+o],c=t.Offsets[h.startIdx+o];if(c===gi.NonPrintableOffset)continue;const a=Ai.LookupGlyph(n,e),d=et.AABBRectangle({x:r,y:s+a.baselineOffset.y*t.Scale},{width:a.width*t.Scale,height:a.height*t.Scale},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded],l.color,{LeftBottom:[a.uv.A.x,a.uv.B.y],LeftTop:[a.uv.A.x,a.uv.A.y],RightTop:[a.uv.B.x,a.uv.A.y],RightBottom:[a.uv.B.x,a.uv.B.y]}]);this.UpdatePrimitiveComponents(d,c*this.AttributesPerComponent),r+=a.width*t.Scale,i=Math.max(i,r-t.AbsolutePosition.x)}r=t.AbsolutePosition.x,s+=t.LineHeight*t.Scale+n}else r=t.AbsolutePosition.x,s+=t.LineHeight*t.Scale}t.UpdateTextDimension({width:i,height:s-t.AbsolutePosition.y})}static MinBaseOffset(t,e,i){if(0===t.length)return 0;const o=(t,e)=>Ai.LookupGlyph(t,i).baselineOffset.y<Ai.LookupGlyph(e,i).baselineOffset.y,n=ot.Min([...t],o);return Ai.LookupGlyph(n,i).baselineOffset.y*e.Scale}static LookupGlyph(t,e){return bi.Try(Di(e,"Lookup"),t).CatchFn(Di(e,"Lookup"),"?")}static SplitString(t){const e=[];if(0===t.length)return[];let i=0;for(let o=0;o<t.length;++o){const n=t[o];"\n"===n&&(e.push({text:t.slice(i,o),startIdx:i}),i=o+1)}return i!==t.length&&e.push({text:t.slice(i,t.length),startIdx:i}),e}};ji=Ai=Li([(0,w.b)(),_i(0,(0,S.f)(L.WebGLRenderingContext)),_i(1,(0,S.f)(V)),_i(2,(0,S.f)(L.FontAtlasTexture)),_i(3,(0,S.f)(L.FontGlyphCollectionFactory)),Zi("design:paramtypes",["function"===typeof(Oi="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Oi:Object,"function"===typeof(Ti="undefined"!==typeof V&&V)?Ti:Object,"function"===typeof(Ei="undefined"!==typeof WebGLTexture&&WebGLTexture)?Ei:Object,"function"===typeof(Ii="undefined"!==typeof n.FontGlyphCollectionFactory&&n.FontGlyphCollectionFactory)?Ii:Object])],ji),U.bind(ji).toSelf().inSingletonScope().whenTargetIsDefault(),U.bind(ji).toSelf().inSingletonScope().whenTargetNamed(Z.Perspective),U.bind(ji).toSelf().inTransientScope().whenTargetNamed(Z.Unique);class Fi{constructor(t,e,i,o,n,r,s,l=null){(0,x.Z)(this,"position",void 0),(0,x.Z)(this,"dimension",void 0),(0,x.Z)(this,"zIndex",void 0),(0,x.Z)(this,"style",void 0),(0,x.Z)(this,"caption",void 0),(0,x.Z)(this,"touchCallback",void 0),(0,x.Z)(this,"parent",void 0),(0,x.Z)(this,"observable",new ge),(0,x.Z)(this,"scale",1),(0,x.Z)(this,"destroyed",!1),(0,x.Z)(this,"disabled",!1),(0,x.Z)(this,"button",void 0),(0,x.Z)(this,"label",void 0),(0,x.Z)(this,"parentDetacher",null),this.position=t,this.dimension=e,this.zIndex=i,this.style=o,this.caption=n,this.touchCallback=r,this.parent=l,this.button=s.CreateIconButton(this.position,this.dimension,this.zIndex,this.style,{color:[0,0,0],icon:xe.Empty},(t=>this.TouchAdapter(t)),this.parent);const h=.001;this.label=s.CreateLabel(this.Position,i+h,this.caption.text,this.caption.lineHeight,this.parent),this.label.StyleRange(0,this.label.Text.length,{color:this.caption.color}),this.label.Position=this.CaptionPosition,this.parentDetacher=l?.Observable.Attach((()=>this.observable.Notify(this)))??null}get Observable(){return this.observable}get Position(){return this.position}set Position(t){this.position=t,this.button.Position=this.Position,this.label.Position=this.CaptionPosition,this.observable.Notify(this)}get AbsolutePosition(){if(this.parent){const t=[this.parent.AbsolutePosition.x,this.parent.AbsolutePosition.y],e=R.IH(R.Ue(),t,[this.Position.x*this.Scale,this.Position.y*this.Scale]);return{x:e[0],y:e[1]}}return this.Position}get Dimension(){return{width:this.dimension.width*this.Scale,height:this.dimension.height*this.Scale}}set Dimension(t){this.dimension=t,this.button.Dimension=t,this.label.Position=this.CaptionPosition,this.observable.Notify(this)}get ZIndex(){return this.zIndex}set ZIndex(t){this.zIndex=t,this.button.ZIndex=t;const e=.001;this.label.ZIndex=t+e,this.observable.Notify(this)}get Caption(){return this.caption}set Caption(t){this.caption={...t},this.label.Text=t.text,this.label.LineHeight=t.lineHeight,this.label.StyleRange(0,this.label.Text.length,{color:t.color}),queueMicrotask((()=>this.label.Position=this.CaptionPosition)),this.observable.Notify(this)}get Style(){return this.style}set Style(t){this.style={...t},this.button.Style={...t},this.observable.Notify(this)}get Scale(){return null===this.parent?this.scale:this.scale*this.parent.Scale}set Scale(t){this.scale=t,this.button.Scale=t,this.label.Scale=t,this.observable.Notify(this)}get Destroyed(){return this.destroyed}get Disable(){return this.disabled}set Disable(t){t!==this.disabled&&(this.disabled=t,this.button.Disable=t,this.observable.Notify(this))}get CaptionPosition(){return{x:this.Position.x+(this.dimension.width-this.label.Dimension.width/this.label.Scale)/2,y:this.Position.y+(this.dimension.height-this.label.Dimension.height/this.label.Scale)/2}}TouchAdapter(t){this.touchCallback(this)}StyleCaptionRange(t,e,i){this.label.StyleRange(t,e,i)}Touch(){this.button.Touch()}Destroy(){this.label.Destroy(),this.button.Destroy(),this.parent?.RemoveChild(this),null!==this.parentDetacher&&this.parentDetacher()}}(0,x.Z)(Fi,"DisabledIconColor",[.47058823529411764,.5647058823529412,.611764705882353]);class ki{constructor(t,e,i,o,n,r,s,l,h,c,a){(0,x.Z)(this,"position",void 0),(0,x.Z)(this,"dimension",void 0),(0,x.Z)(this,"zIndex",void 0),(0,x.Z)(this,"containerStyle",void 0),(0,x.Z)(this,"Offset",void 0),(0,x.Z)(this,"labelRenderer",void 0),(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"deleter",void 0),(0,x.Z)(this,"parent",void 0),(0,x.Z)(this,"visible",!0),(0,x.Z)(this,"scale",1),(0,x.Z)(this,"scroll",0),(0,x.Z)(this,"label",void 0),(0,x.Z)(this,"scrollControls",null),(0,x.Z)(this,"observable",new ge),(0,x.Z)(this,"scrollButtonDimension",{width:10,height:20}),(0,x.Z)(this,"margin",5),(0,x.Z)(this,"scrollButtonStyle",{fillColor:[.9254901960784314,.9411764705882353,.9450980392156862],outlineColor:[.9254901960784314,.9411764705882353,.9450980392156862]}),(0,x.Z)(this,"scrollButtonIconColor",[.17254901960784313,.24313725490196078,.3137254901960784]),(0,x.Z)(this,"parentDetacher",null),this.position=t,this.dimension=e,this.zIndex=i,this.containerStyle=r,this.Offset=s,this.labelRenderer=l,this.uiRenderer=h,this.deleter=c,this.parent=a,this.label=this.labelRenderer.Create({x:t.x+this.ContainerStyle.borderWidth,y:t.y},i,o,n,a),this.parentDetacher=a?.Observable.Attach((()=>this.observable.Notify(this)))??null,this.ScheduleUpdateScrollControlsPresence()}StyleRange(t,e,i){this.label.StyleRange(t,e,i)}get Position(){return this.position}set Position(t){this.position=t,this.observable.Notify(this)}get Dimension(){return{width:this.dimension.width*this.Scale,height:this.dimension.height*this.Scale}}set Dimension(t){this.dimension=t,this.observable.Notify(this),this.ScheduleUpdateScrollControlsPresence()}get AbsolutePosition(){if(this.parent){const t=[this.parent.AbsolutePosition.x,this.parent.AbsolutePosition.y],e=R.IH(R.Ue(),t,[this.Position.x*this.Scale,this.Position.y*this.Scale]);return{x:e[0],y:e[1]}}return this.Position}get Text(){return this.label.Text}set Text(t){this.label.Text=t,this.scroll=0,this.label.Position={x:this.position.x+this.ContainerStyle.borderWidth,y:this.position.y},this.observable.Notify(this),this.ScheduleUpdateScrollControlsPresence()}get ZIndex(){return this.zIndex}set ZIndex(t){this.zIndex=t,this.label.ZIndex=t,this.observable.Notify(this)}get LineHeight(){return this.label.LineHeight}set LineHeight(t){this.label.LineHeight=t,this.observable.Notify(this),this.ScheduleUpdateScrollControlsPresence()}get ContainerStyle(){return{borderWidth:this.containerStyle.borderWidth*this.Scale,fillColor:this.containerStyle.fillColor}}set BorderWidth(t){this.containerStyle.borderWidth=t.borderWidth,this.containerStyle.fillColor=t.fillColor,this.observable.Notify(this)}get Visible(){return this.visible}set Visible(t){this.visible=t,this.ScheduleUpdateScrollControlsPresence(),this.observable.Notify(this)}get Scale(){return null===this.parent?this.scale:this.scale*this.parent.Scale}set Scale(t){this.scale=t,null===this.parent&&(this.label.Scale=t),this.ScheduleUpdateScrollControlsPresence(),null!==this.scrollControls&&(this.scrollControls.scrollTopButton.Scale=t,this.scrollControls.scrollBottomButton.Scale=t),this.observable.Notify(this)}get Observable(){return this.observable}get IsContentOverflow(){return this.label.Dimension.height>this.Dimension.height}ScrollToTop(){queueMicrotask((()=>{this.visible&&this.IsContentOverflow&&(this.scroll=0,this.ScrollAligned(this.MinScroll))}))}Destroy(){this.parent?.RemoveChild(this),null!==this.parentDetacher&&this.parentDetacher(),null!==this.scrollControls&&(this.scrollControls.scrollTopButton.Destroy(),this.scrollControls.scrollBottomButton.Destroy(),this.scrollControls=null),this.deleter()}ScheduleUpdateScrollControlsPresence(){queueMicrotask((()=>this.UpdateScrollControlsPresence()))}UpdateScrollControlsPresence(){this.visible&&this.IsContentOverflow?(null===this.scrollControls&&(this.scrollControls={scrollTopButton:this.CreateTopScrollButton(),scrollBottomButton:this.CreateBottomScrollButton()},null===this.parent&&(this.scrollControls.scrollBottomButton.Scale=this.Scale,this.scrollControls.scrollTopButton.Scale=this.Scale),this.ScrollAligned(0)),this.scrollControls.scrollBottomButton.Position={x:this.ScrollButtonX,y:this.ScrollBottomButtonY},this.scrollControls.scrollTopButton.Position={x:this.ScrollButtonX,y:this.ScrollTopButtonY}):null!==this.scrollControls&&(this.scrollControls.scrollTopButton.Destroy(),this.scrollControls.scrollBottomButton.Destroy(),this.scrollControls=null)}get ScrollButtonX(){return this.Position.x+this.dimension.width-this.containerStyle.borderWidth-this.scrollButtonDimension.width-this.margin}get ScrollTopButtonY(){return this.Position.y+this.dimension.height-this.scrollButtonDimension.height-this.containerStyle.borderWidth-this.margin}get ScrollBottomButtonY(){return this.Position.y+this.ContainerStyle.borderWidth+this.margin}CreateTopScrollButton(){return this.uiRenderer.CreateIconButton({x:this.ScrollButtonX,y:this.ScrollTopButtonY},this.scrollButtonDimension,1,this.scrollButtonStyle,{color:this.scrollButtonIconColor,icon:xe.ArrowUp},(t=>this.ScrollAligned(-this.LineHeight)),this.parent)}CreateBottomScrollButton(){return this.uiRenderer.CreateIconButton({x:this.ScrollButtonX,y:this.ScrollBottomButtonY},this.scrollButtonDimension,1,this.scrollButtonStyle,{color:this.scrollButtonIconColor,icon:xe.ArrowDown},(t=>this.ScrollAligned(this.LineHeight)),this.parent)}get MinScroll(){return this.Position.y-this.label.Dimension.height/this.label.Scale+this.dimension.height-2*this.containerStyle.borderWidth}get MaxScroll(){return this.Position.y}ScrollAligned(t){this.IsContentOverflow&&(this.scroll+=t,this.scroll=D.Clamp(this.scroll,this.MinScroll,this.MaxScroll),this.UpdateScrollButtonDisability(),this.label.Position={...this.label.Position,y:this.scroll})}UpdateScrollButtonDisability(){this.scroll===this.MinScroll?this.scrollControls.scrollTopButton.Disable=!0:this.scrollControls.scrollTopButton.Disable&&(this.scrollControls.scrollTopButton.Disable=!1),this.scroll===this.MaxScroll?this.scrollControls.scrollBottomButton.Disable=!0:this.scrollControls.scrollBottomButton.Disable&&(this.scrollControls.scrollBottomButton.Disable=!1)}}var Ui,Mi,Ni,zi,Gi,Vi="#version 300 es\nprecision mediump float;\n\nout vec4 out_color;\n\nvoid main() \n{\n      out_color = vec4(0.17254901960784313, 0.24313725490196078, 0.3137254901960784, 1);\n}\n",Hi="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0) ;\n}\n",Wi="#version 300 es\nprecision mediump float;\n\nin vec4 v_fill_color;\n\nout vec4 out_color;\n\nvoid main() {\n      out_color = v_fill_color;\n}\n",Yi="#version 300 es\nprecision mediump float;\n\nin vec3 a_vertex;\nin vec4 a_fill_color;\n\nout vec4 v_fill_color;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position =  u_viewProject * vec4(a_vertex, 1.0);\n  v_fill_color = a_fill_color;\n}\n",Xi=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ki=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},qi=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z"})(zi||(zi={})),function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Z"]=2]="Z",t[t["Fr"]=3]="Fr",t[t["Fg"]=4]="Fg",t[t["Fb"]=5]="Fb"}(Gi||(Gi={}));class $i extends at{constructor(t){const e=rt.Resolve(t.FLOAT),i=e*q(zi),o=24;super(t,{fragment:Vi,vertex:Hi},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:i,offset:0}],{indicesPerPrimitive:o,basePrimitiveType:t.TRIANGLES})}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}}let Qi=class extends at{constructor(t,e,i){const o=rt.Resolve(e.FLOAT),n=o*q(Gi),r=6;super(e,{fragment:Wi,vertex:Yi},[{name:"a_vertex",size:3,type:e.FLOAT,normalized:!1,stride:n,offset:0},{name:"a_fill_color",size:4,type:e.FLOAT,normalized:!1,stride:n,offset:3}],{indicesPerPrimitive:r,basePrimitiveType:e.TRIANGLES}),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"labelRenderer",void 0),(0,x.Z)(this,"zFarIncluded",.1),(0,x.Z)(this,"borderRenderer",void 0),(0,x.Z)(this,"vertexAttributesTracker",void 0),(0,x.Z)(this,"uiRenderer",void 0),this.settings=t,this.labelRenderer=i,this.borderRenderer=new $i(this.gl),this.vertexAttributesTracker=new class extends Ie{constructor(t){const e=2;super(e),(0,x.Z)(this,"renderer",void 0),this.renderer=t,t.UploadAttributes(Array.from({length:t.ComponentsPerPrimitive*e},(()=>0))),this.renderer.borderRenderer.UploadAttributes(Array.from({length:t.borderRenderer.ComponentsPerPrimitive*e},(()=>0)))}Free(t){this.renderer.UpdatePrimitiveComponents(new Array(this.renderer.ComponentsPerPrimitive).fill(0),t*this.renderer.ComponentsPerPrimitive),this.renderer.borderRenderer.UpdatePrimitiveComponents(new Array(this.renderer.borderRenderer.ComponentsPerPrimitive).fill(0),t*this.renderer.borderRenderer.ComponentsPerPrimitive),super.Free(t)}OnShrink(t){const e=new Array(this.renderer.ComponentsPerPrimitive*t.length).fill(0),i=new Array(this.renderer.borderRenderer.ComponentsPerPrimitive*t.length).fill(0);for(let o=0;o<t.length;++o){const n=t[o],r=this.renderer.PrimitiveComponents(n);ot.Copy(e,o*this.renderer.ComponentsPerPrimitive,r,0,r.length);const s=this.renderer.borderRenderer.PrimitiveComponents(n);ot.Copy(i,o*this.renderer.borderRenderer.ComponentsPerPrimitive,s,0,s.length)}this.renderer.UploadAttributes(e),this.renderer.borderRenderer.UploadAttributes(i)}OnExtend(t){const e=this.renderer.PrimitiveComponentsRange(0,this.renderer.TotalPrimitives),i=Array.from({length:t*this.renderer.ComponentsPerPrimitive},((t,i)=>i<e.length?e[i]:0));this.renderer.UploadAttributes(i);const o=this.renderer.borderRenderer.PrimitiveComponentsRange(0,this.renderer.borderRenderer.TotalPrimitives),n=Array.from({length:t*this.renderer.borderRenderer.ComponentsPerPrimitive},((t,e)=>e<o.length?o[e]:0));this.renderer.UploadAttributes(n)}}(this)}Create(t,e,i,o,n,r,s,l=null){const h=new ki(t,e,i,o,r,n,this.vertexAttributesTracker.Allocate(),this.labelRenderer,this.UIRenderer,s,l);return null!==l&&l.AppendChild(h),h.Observable.Attach((t=>this.UpdateAttributes(t))),this.UpdateAttributes(h),h}Draw(){this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilFunc(this.gl.ALWAYS,1,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.REPLACE),super.Draw(),this.gl.stencilFunc(this.gl.EQUAL,1,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.KEEP),this.labelRenderer.Draw(),this.gl.clear(this.gl.STENCIL_BUFFER_BIT),this.gl.disable(this.gl.STENCIL_TEST),this.borderRenderer.Draw()}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t),this.labelRenderer.ViewProjection=t,this.borderRenderer.ViewProjection=t}get UIRenderer(){return this.uiRenderer}set UIRenderer(t){this.uiRenderer=t}Dispose(){this.borderRenderer.Dispose(),super.Dispose()}UpdateAttributes(t){this.UpdateStencilAttributes(t),this.UpdateBorderAttributes(t)}UpdateStencilAttributes(t){let e;e=t.Visible?et.AABBRectangle({x:t.AbsolutePosition.x+t.ContainerStyle.borderWidth,y:t.AbsolutePosition.y+t.ContainerStyle.borderWidth},{width:t.Dimension.width-2*t.ContainerStyle.borderWidth,height:t.Dimension.height-2*t.ContainerStyle.borderWidth},[[this.settings.ZFar-t.ZIndex-this.zFarIncluded+.1],t.ContainerStyle.fillColor]):new Array(this.ComponentsPerPrimitive).fill(0),this.UpdatePrimitiveComponents(e,t.Offset*this.ComponentsPerPrimitive)}UpdateBorderAttributes(t){let e;e=t.Visible?et.AABBFrame(t.AbsolutePosition,t.Dimension,t.ContainerStyle.borderWidth,[[this.settings.ZFar-t.ZIndex-this.zFarIncluded]]):new Array(this.borderRenderer.ComponentsPerPrimitive).fill(0),this.borderRenderer.UpdatePrimitiveComponents(e,t.Offset*this.borderRenderer.ComponentsPerPrimitive)}};Qi=Xi([(0,w.b)(),qi(0,(0,S.f)(V)),qi(1,(0,S.f)(L.WebGLRenderingContext)),qi(2,(0,S.f)(ji)),qi(2,(0,P.t)(Z.Unique)),Ki("design:paramtypes",["function"===typeof(Ui="undefined"!==typeof V&&V)?Ui:Object,"function"===typeof(Mi="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Mi:Object,"function"===typeof(Ni="undefined"!==typeof ji&&ji)?Ni:Object])],Qi),U.bind(Qi).toSelf().inTransientScope(),U.bind(L.UITextListRendererFactory).toFactory((t=>e=>{const i=t.container.get(Qi);return i.UIRenderer=e,i}));var Ji,to,eo,io,oo,no,ro=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},so=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},lo=function(t,e){return function(i,o){e(i,o,t)}};let ho=class{constructor(t,e,i,o,n,r){(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"iconButtonRenderer",void 0),(0,x.Z)(this,"alertRenderer",void 0),(0,x.Z)(this,"labelsRenderer",void 0),(0,x.Z)(this,"uiTextListRendererFactory",void 0),(0,x.Z)(this,"uiEditableTextListRendererFactory",void 0),(0,x.Z)(this,"viewProjection",null),(0,x.Z)(this,"uiTextLists",[]),(0,x.Z)(this,"uiEditableTextLists",[]),this.gl=t,this.iconButtonRenderer=e,this.alertRenderer=i,this.labelsRenderer=o,this.uiTextListRendererFactory=n,this.uiEditableTextListRendererFactory=r,this.alertRenderer.UIRenderer=this}CreateIconButton(t,e,i,o,n,r,s=null){return this.iconButtonRenderer.Create(t,e,i,o,n,r,s)}CreateTextButton(t,e,i,o,n,r,s=null){return new Fi(t,e,i,o,n,r,this,s)}CreateLabel(t,e,i,o,n=null){return this.labelsRenderer.Create(t,e,i,o,n)}CreateAlert(t,e,i,o,n,r=null){return this.alertRenderer.Create(t,e,i,o,n,r)}CreateTextList(t,e,i,o,n,r,s=null){const l=this.uiTextListRendererFactory(this);null!==this.viewProjection&&(l.ViewProjection=this.viewProjection);const h={renderer:l},c=l.Create(t,e,i,o,n,r,(()=>this.UIObservableTextListDeleter(h)),s);return h.component=c,this.uiTextLists.push(h),c}CreateEditableTextList(t,e,i,o,n,r,s=null){const l=this.uiEditableTextListRendererFactory(this);null!==this.viewProjection&&(l.ViewProjection=this.viewProjection);const h={renderer:l},c=l.Create(t,e,i,o,n,r,(()=>this.UIObservableEditableTextListDeleter(h)),s);return h.component=c,this.uiEditableTextLists.push(h),c}Touch(t){const e=this.TouchAlerts(t.offsetX,t.offsetY)||this.TouchButtons(t.offsetX,t.offsetY)||this.TouchLabels(t.offsetX,t.offsetY);return e||(this.TouchTextList(this.uiEditableTextLists,t.offsetX,t.offsetY)??!1)}FindTextList(t,e){const i=this.TouchTextList(this.uiTextLists,t,e),o=this.TouchTextList(this.uiEditableTextLists,t,e);return null===i?o:null===o||i.ZIndex>o.ZIndex?i:o}TouchButtons(t,e){const i=this.iconButtonRenderer.IconButtons.filter((i=>Yt.AABBRectanglePoint({x:i.AbsolutePosition.x,y:i.AbsolutePosition.y,width:i.Dimension.width,height:i.Dimension.height},{x:t,y:e})));return 0!==i.length&&(ot.Max(i,((t,e)=>t.ZIndex<e.ZIndex)).Touch(),!0)}TouchLabels(t,e){const i=this.labelsRenderer.Labels.filter((i=>Yt.AABBRectanglePoint({x:i.AbsolutePosition.x,y:i.AbsolutePosition.y,width:i.Dimension.width,height:i.Dimension.height},{x:t,y:e})));return 0!==i.length}TouchAlerts(t,e){const i=this.alertRenderer.Alerts.filter((i=>Yt.AABBRectanglePoint({x:i.AbsolutePosition.x,y:i.AbsolutePosition.y,width:i.Dimension.width,height:i.Dimension.height},{x:t,y:e})));return 0!==i.length&&(i[0].Destroy(),!0)}TouchTextList(t,e,i){const o=t.filter((t=>t.component.Visible&&Yt.AABBRectanglePoint({x:t.component.AbsolutePosition.x,y:t.component.AbsolutePosition.y,width:t.component.Dimension.width,height:t.component.Dimension.height},{x:e,y:i})));return 0===o.length?null:ot.Max(o,((t,e)=>t.component.ZIndex<e.component.ZIndex)).component}UIObservableTextListDeleter(t){this.uiTextLists.splice(this.uiTextLists.findIndex((e=>e===t)),1)}UIObservableEditableTextListDeleter(t){this.uiEditableTextLists.splice(this.uiEditableTextLists.findIndex((e=>e===t)),1)}Draw(){this.alertRenderer.Draw(),this.iconButtonRenderer.Draw(),this.labelsRenderer.Draw(),this.uiTextLists.forEach((t=>t.renderer.Draw())),this.uiEditableTextLists.forEach((t=>t.renderer.Draw()))}set ViewProjection(t){this.viewProjection=t,this.iconButtonRenderer.ViewProjection=t,this.labelsRenderer.ViewProjection=t,this.alertRenderer.ViewProjection=t,this.uiTextLists.forEach((e=>e.renderer.ViewProjection=t)),this.uiEditableTextLists.forEach((e=>e.renderer.ViewProjection=t))}};var co;ho=ro([(0,w.b)(),lo(0,(0,S.f)(L.WebGLRenderingContext)),lo(1,(0,S.f)(ui)),lo(2,(0,S.f)(ze)),lo(3,(0,S.f)(ji)),lo(4,(0,S.f)(L.UITextListRendererFactory)),lo(5,(0,S.f)(L.UIEditableTextListRendererFactory)),so("design:paramtypes",["function"===typeof(Ji="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Ji:Object,"function"===typeof(to="undefined"!==typeof ui&&ui)?to:Object,"function"===typeof(eo="undefined"!==typeof ze&&ze)?eo:Object,"function"===typeof(io="undefined"!==typeof ji&&ji)?io:Object,"function"===typeof(oo="undefined"!==typeof r.UITextListRendererFactory&&r.UITextListRendererFactory)?oo:Object,"function"===typeof(no="undefined"!==typeof o.UIEditableTextListRendererFactory&&o.UIEditableTextListRendererFactory)?no:Object])],ho),U.bind(ho).toSelf().inSingletonScope();var ao,uo,fo,po,go=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},yo=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},bo=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["RunNextBreakpoint"]=0]="RunNextBreakpoint",t[t["RunNextInstruction"]=1]="RunNextInstruction",t[t["Interrupt"]=2]="Interrupt"})(po||(po={}));let vo=(co=class{constructor(t,e){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"layout",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"executeButton",void 0),(0,x.Z)(this,"debugButton",void 0),(0,x.Z)(this,"debugMenuGroup",null),(0,x.Z)(this,"breakpointMenuButton",void 0),(0,x.Z)(this,"isBreakpointMenuOpen",!1),(0,x.Z)(this,"breakpointMenuGroup",null),(0,x.Z)(this,"heatmapButton",void 0),(0,x.Z)(this,"executeObservable",new ge),(0,x.Z)(this,"debugObservable",new ge),(0,x.Z)(this,"cellBreakpointObservable",new ge),(0,x.Z)(this,"cellBreakpointDeleteObservable",new ge),(0,x.Z)(this,"isHeatmapShown",!1),(0,x.Z)(this,"heatmapObservable",new ge),(0,x.Z)(this,"debugMode",!1),(0,x.Z)(this,"DeactivateButton",!1),this.uiRenderer=t,this.layout=e,this.group=new Pe({x:0,y:60},{vertical:Se.Top,horizontal:we.Middle});const i=10,o=50;this.executeButton=this.uiRenderer.CreateIconButton({x:0,y:0},{width:o,height:o},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.Play,color:ao.DefaultButtonIconColor},(t=>this.executeObservable.Notify()),this.group),this.debugButton=this.uiRenderer.CreateIconButton({x:o+i,y:0},{width:o,height:o},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.PlayDebug,color:ao.DefaultButtonIconColor},(t=>this.debugObservable.Notify(po.RunNextBreakpoint)),this.group),this.breakpointMenuButton=this.uiRenderer.CreateIconButton({x:2*o+2*i,y:0},{width:o,height:o},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.Breakpoint,color:ao.BreakpointButtonIconColor},(t=>this.ToggleBreakpointMenuButton()),this.group),this.heatmapButton=this.uiRenderer.CreateIconButton({x:3*o+3*i,y:0},{width:o,height:o},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.Heatmap,color:ao.ProfilerButtonIconColor},(t=>this.ToggleHeatmap(t)),this.group),this.layout.DebugGroup=this.group}Resize(){this.group.Resize(),this.breakpointMenuGroup?.Resize(),this.debugMenuGroup?.Resize()}get DebugMode(){return this.debugMode}set DebugMode(t){if(t!==this.debugMode){this.debugButton.Icon={icon:xe.PlayDebug,color:t?ao.DebugModeButtonIconColor:ao.DefaultButtonIconColor};const e=10,i=50;if(t){this.debugMenuGroup=new Pe({x:this.debugButton.AbsolutePosition.x/this.group.Scale,y:this.group.Position.y+2*e+2*i},{vertical:Se.Top});this.uiRenderer.CreateIconButton({x:0,y:e+i},{width:i,height:i},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.DebugStepInto,color:ao.DebugModeButtonIconColor},(t=>this.debugObservable.Notify(po.RunNextInstruction)),this.debugMenuGroup),this.uiRenderer.CreateIconButton({x:0,y:0},{width:i,height:i},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.Stop,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.debugObservable.Notify(po.Interrupt)),this.debugMenuGroup)}else this.debugMenuGroup?.Destroy(),this.debugMenuGroup=null;this.executeButton.Disable=t,this.heatmapButton.Disable=t}this.debugMode=t}get IsHeatmapShown(){return this.isHeatmapShown}get Execute(){return this.executeObservable}get Debug(){return this.debugObservable}get CellBreakopint(){return this.cellBreakpointObservable}get CellBreakpointDelete(){return this.cellBreakpointDeleteObservable}get Heatmap(){return this.heatmapObservable}ToggleBreakpointMenuButton(){this.isBreakpointMenuOpen?this.CloseCellBreakpointDirectionMenu():this.ShowCellBreakpointDirectionMenu()}ShowCellBreakpointDirectionMenu(){this.isBreakpointMenuOpen=!0,this.breakpointMenuButton.Icon={icon:xe.Breakpoint,color:[.4588235294117647,.4588235294117647,.4588235294117647]};const t=10,e=50,i=+this.DeactivateButton+5;this.breakpointMenuGroup=new Pe({x:this.breakpointMenuButton.AbsolutePosition.x/this.breakpointMenuButton.Scale,y:this.group.Position.y+i*t+i*e},{vertical:Se.Top});this.uiRenderer.CreateIconButton({x:0,y:0},{width:e,height:e},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.ArrowThinAll,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.NotifyWithPCLocationCondition({})),this.breakpointMenuGroup),this.uiRenderer.CreateIconButton({x:0,y:t+e},{width:e,height:e},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.ArrowThinLeft,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.NotifyWithPCLocationCondition({Direction:fe.Left})),this.breakpointMenuGroup),this.uiRenderer.CreateIconButton({x:0,y:2*t+2*e},{width:e,height:e},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.ArrowThinUp,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.NotifyWithPCLocationCondition({Direction:fe.Up})),this.breakpointMenuGroup),this.uiRenderer.CreateIconButton({x:0,y:3*t+3*e},{width:e,height:e},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.ArrowThinRight,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.NotifyWithPCLocationCondition({Direction:fe.Right})),this.breakpointMenuGroup),this.uiRenderer.CreateIconButton({x:0,y:4*t+4*e},{width:e,height:e},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.ArrowThinDown,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.NotifyWithPCLocationCondition({Direction:fe.Down})),this.breakpointMenuGroup);if(this.DeactivateButton){this.uiRenderer.CreateIconButton({x:0,y:5*t+5*e},{width:e,height:e},1,{fillColor:ao.DefaultButtonFillColor,outlineColor:ao.DefaultButtonOutlineColor},{icon:xe.Delete,color:[.8980392156862745,.2235294117647059,.20784313725490197]},(t=>this.NotifyWithCellBreakpointDeactivation()),this.breakpointMenuGroup)}}NotifyWithPCLocationCondition(t){this.CloseCellBreakpointDirectionMenu(),this.cellBreakpointObservable.Notify(t)}NotifyWithCellBreakpointDeactivation(){this.CloseCellBreakpointDirectionMenu(),this.cellBreakpointDeleteObservable.Notify()}CloseCellBreakpointDirectionMenu(){this.isBreakpointMenuOpen=!1,this.breakpointMenuButton.Icon={icon:xe.Breakpoint,color:ao.BreakpointButtonIconColor},this.breakpointMenuGroup?.Destroy(),this.breakpointMenuGroup=null}ToggleHeatmap(t){this.isHeatmapShown=!this.isHeatmapShown;const e={isShown:this.isHeatmapShown};if(this.heatmapObservable.Notify(e),e.isShown===this.isHeatmapShown){const e=this.isHeatmapShown?ao.ToggleButtonOutlineColor:ao.DefaultButtonOutlineColor;t.Style={...t.Style,outlineColor:e},this.isHeatmapShown&&this.CloseCellBreakpointDirectionMenu(),this.executeButton.Disable=this.isHeatmapShown,this.debugButton.Disable=this.isHeatmapShown,this.breakpointMenuButton.Disable=this.isHeatmapShown}this.isHeatmapShown=e.isShown}},ao=co,(0,x.Z)(co,"DefaultButtonFillColor",[.9254901960784314,.9411764705882353,.9450980392156862]),(0,x.Z)(co,"DefaultButtonOutlineColor",[.4980392156862745,.5490196078431373,.5529411764705883]),(0,x.Z)(co,"ToggleButtonOutlineColor",[0,0,0]),(0,x.Z)(co,"DefaultButtonIconColor",[.40784313725490196,.6235294117647059,.2196078431372549]),(0,x.Z)(co,"DebugModeButtonIconColor",[.9411764705882353,.6392156862745098,.0392156862745098]),(0,x.Z)(co,"BreakpointButtonIconColor",[.8980392156862745,.2235294117647059,.20784313725490197]),(0,x.Z)(co,"ProfilerButtonIconColor",[.11764705882352941,.5647058823529412,1]),co);vo=ao=go([(0,w.b)(),bo(0,(0,S.f)(ho)),bo(1,(0,S.f)(de)),yo("design:paramtypes",["function"===typeof(uo="undefined"!==typeof ho&&ho)?uo:Object,"function"===typeof(fo="undefined"!==typeof de&&de)?fo:Object])],vo),U.bind(vo).toSelf().inSingletonScope();var mo,xo,Co=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ro=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},wo=function(t,e){return function(i,o){e(i,o,t)}};let So=class{constructor(t,e){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"layout",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"selectButton",void 0),(0,x.Z)(this,"cutButton",void 0),(0,x.Z)(this,"copyButton",void 0),(0,x.Z)(this,"pasteButton",void 0),(0,x.Z)(this,"deleteButton",void 0),(0,x.Z)(this,"selectObservable",new ge),(0,x.Z)(this,"cutObservable",new ge),(0,x.Z)(this,"copyObservable",new ge),(0,x.Z)(this,"pasteObservable",new ge),(0,x.Z)(this,"deleteObservable",new ge),this.uiRenderer=t,this.layout=e;const i=[.9254901960784314,.9411764705882353,.9450980392156862],o=[.4980392156862745,.5490196078431373,.5529411764705883],n=[.17254901960784313,.24313725490196078,.3137254901960784],r=10,s=30;this.group=new Pe({x:9*r+6*s,y:r+s},{vertical:Se.Top}),this.selectButton=this.uiRenderer.CreateIconButton({x:0,y:0},{width:s,height:s},1,{fillColor:i,outlineColor:o},{icon:xe.Select,color:n},(t=>this.selectObservable.Notify()),this.group),this.cutButton=this.uiRenderer.CreateIconButton({x:r+s,y:0},{width:s,height:s},1,{fillColor:i,outlineColor:o},{icon:xe.Cut,color:n},(t=>this.cutObservable.Notify()),this.group),this.copyButton=this.uiRenderer.CreateIconButton({x:2*r+2*s,y:0},{width:s,height:s},1,{fillColor:i,outlineColor:o},{icon:xe.Copy,color:n},(t=>this.copyObservable.Notify()),this.group),this.pasteButton=this.uiRenderer.CreateIconButton({x:3*r+3*s,y:0},{width:s,height:s},1,{fillColor:i,outlineColor:o},{icon:xe.Paste,color:n},(t=>this.pasteObservable.Notify()),this.group),this.deleteButton=this.uiRenderer.CreateIconButton({x:4*r+4*s,y:0},{width:s,height:s},1,{fillColor:i,outlineColor:o},{icon:xe.EditDelete,color:n},(t=>this.deleteObservable.Notify()),this.group),this.layout.Watch(this.group)}Resize(){this.group.Resize()}get Disable(){return this.selectButton.Disable}set Disable(t){this.selectButton.Disable=t,this.cutButton.Disable=t,this.copyButton.Disable=t,this.pasteButton.Disable=t,this.deleteButton.Disable=t}get SelectObservable(){return this.selectObservable}get CutObservable(){return this.cutObservable}get CopyObservable(){return this.copyObservable}get PasteObservable(){return this.pasteObservable}get DeleteObservable(){return this.deleteObservable}get Position(){return this.group.AbsolutePosition}get Dimension(){return this.group.Dimension}};var Po;So=Co([(0,w.b)(),wo(0,(0,S.f)(ho)),wo(1,(0,S.f)(re)),Ro("design:paramtypes",["function"===typeof(mo="undefined"!==typeof ho&&ho)?mo:Object,"function"===typeof(xo="undefined"!==typeof re&&re)?xo:Object])],So),U.bind(So).toSelf().inSingletonScope();var Do,Ao,Oo=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},To=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Eo=function(t,e){return function(i,o){e(i,o,t)}};let Io=(Po=class{constructor(t){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"editDirectionControls",void 0),(0,x.Z)(this,"currentDirectionControl",void 0),(0,x.Z)(this,"editDirectionObservable",new ge),this.uiRenderer=t;const e=5,[i,o]=[37.5,25],n=[.9254901960784314,.9411764705882353,.9450980392156862],r=[.4980392156862745,.5490196078431373,.5529411764705883];this.group=new Pe({x:10,y:2*i+3*e+o+50},{vertical:Se.Top}),this.editDirectionControls={group:this.group,left:this.uiRenderer.CreateIconButton({x:0,y:i+e},{width:i,height:o},1,{fillColor:n,outlineColor:r},{icon:xe.ArrowLeft,color:Do.CurrentDirectionInactiveIconColor},(t=>this.UpdateEditDirection(t,Cr.Left)),this.group),up:this.uiRenderer.CreateIconButton({x:i+e/2-o/2,y:i+2*e+o},{width:o,height:i},1,{fillColor:n,outlineColor:r},{icon:xe.ArrowUp,color:Do.CurrentDirectionInactiveIconColor},(t=>this.UpdateEditDirection(t,Cr.Up)),this.group),right:this.uiRenderer.CreateIconButton({x:i+e,y:i+e},{width:i,height:o},1,{fillColor:n,outlineColor:r},{icon:xe.ArrowRight,color:Do.CurrentDirrectionActiveIconColor},(t=>this.UpdateEditDirection(t,Cr.Right)),this.group),down:this.uiRenderer.CreateIconButton({x:i+e/2-o/2,y:0},{width:o,height:i},1,{fillColor:n,outlineColor:r},{icon:xe.ArrowDown,color:Do.CurrentDirectionInactiveIconColor},(t=>this.UpdateEditDirection(t,Cr.Down)),this.group)},this.currentDirectionControl=this.editDirectionControls.right}get EditDirectionObservable(){return this.editDirectionObservable}Resize(){this.group.Resize()}ForceEditDirection(t){this.currentDirectionControl.Icon={...this.currentDirectionControl.Icon,color:Do.CurrentDirectionInactiveIconColor};const e=t===Cr.Left?this.editDirectionControls.left:t===Cr.Up?this.editDirectionControls.up:t===Cr.Right?this.editDirectionControls.right:this.editDirectionControls.down;e.Icon={...e.Icon,color:Do.CurrentDirrectionActiveIconColor},this.currentDirectionControl=e}UpdateEditDirection(t,e){t!==this.currentDirectionControl&&(this.currentDirectionControl.Icon={...this.currentDirectionControl.Icon,color:Do.CurrentDirectionInactiveIconColor},t.Icon={...t.Icon,color:Do.CurrentDirrectionActiveIconColor},this.currentDirectionControl=t,this.editDirectionObservable.Notify(e))}get Boundaries(){const t=this.group.Dimension;return{lb:this.group.AbsolutePosition,rt:{x:this.group.AbsolutePosition.x+t.width,y:this.group.AbsolutePosition.y+t.height}}}},Do=Po,(0,x.Z)(Po,"CurrentDirectionInactiveIconColor",[.17254901960784313,.24313725490196078,.3137254901960784]),(0,x.Z)(Po,"CurrentDirrectionActiveIconColor",[.1607843137254902,.5019607843137255,.7254901960784313]),Po);var Bo;Io=Do=Oo([(0,w.b)(),Eo(0,(0,S.f)(ho)),To("design:paramtypes",["function"===typeof(Ao="undefined"!==typeof ho&&ho)?Ao:Object])],Io),U.bind(Io).toSelf().inSingletonScope();var Lo,Zo,_o,jo=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Fo=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},ko=function(t,e){return function(i,o){e(i,o,t)}};let Uo=(Bo=class{constructor(t,e){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"layout",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"openButton",void 0),(0,x.Z)(this,"saveButton",void 0),(0,x.Z)(this,"shareButton",void 0),(0,x.Z)(this,"helpButton",void 0),(0,x.Z)(this,"helpShowed",!1),(0,x.Z)(this,"openFromDiskObservable",new ge),(0,x.Z)(this,"saveToDiskObservable",new ge),(0,x.Z)(this,"shareObservable",new ge),(0,x.Z)(this,"showHelpObservable",new ge),this.uiRenderer=t,this.layout=e;const i=[.9254901960784314,.9411764705882353,.9450980392156862],o=[.9411764705882353,.6392156862745098,.0392156862745098],n=[.08235294117647059,.396078431372549,.7529411764705882],r=[.17254901960784313,.24313725490196078,.3137254901960784],s=10,l=30;this.group=new Pe({x:s,y:s+l},{vertical:Se.Top}),this.openButton=this.uiRenderer.CreateIconButton({x:0,y:0},{width:l,height:l},1,{fillColor:i,outlineColor:Lo.DefaultButtonOutlineColor},{icon:xe.Open,color:o},(t=>this.openFromDiskObservable.Notify()),this.group),this.saveButton=this.uiRenderer.CreateIconButton({x:l+s,y:0},{width:l,height:l},1,{fillColor:i,outlineColor:Lo.DefaultButtonOutlineColor},{icon:xe.Save,color:n},(t=>this.saveToDiskObservable.Notify()),this.group),this.saveButton.Disable=!0,this.shareButton=this.uiRenderer.CreateIconButton({x:2*l+2*s,y:0},{width:l,height:l},1,{fillColor:i,outlineColor:Lo.DefaultButtonOutlineColor},{icon:xe.Share,color:n},(t=>this.shareObservable.Notify()),this.group),this.shareButton.Disable=!0,this.helpButton=this.uiRenderer.CreateIconButton({x:3*l+3*s,y:0},{width:l,height:l},1,{fillColor:i,outlineColor:Lo.DefaultButtonOutlineColor},{icon:xe.QuestionMark,color:r},(t=>this.ToggleHelpButton()),this.group),this.layout.Watch(this.group)}ToggleHelpButton(){this.helpButton.Style={...this.helpButton.Style,outlineColor:this.helpShowed?Lo.DefaultButtonOutlineColor:Lo.ToggleButtonOutlineColor},this.helpShowed=!this.helpShowed,this.showHelpObservable.Notify()}Resize(){this.group.Resize()}get ShareDisabled(){return this.shareButton.Disable}set ShareDisabled(t){this.saveButton.Disable=t,this.shareButton.Disable=t}get OpenFromDiskDisabled(){return this.openButton.Disable}set OpenFromDiskDisabled(t){this.openButton.Disable=t}get OpenFromDiskObservable(){return this.openFromDiskObservable}get SaveToDiskObservable(){return this.saveToDiskObservable}get ShareObservable(){return this.shareObservable}get ShowHelpObservable(){return this.showHelpObservable}},Lo=Bo,(0,x.Z)(Bo,"DefaultButtonOutlineColor",[.4980392156862745,.5490196078431373,.5529411764705883]),(0,x.Z)(Bo,"ToggleButtonOutlineColor",[0,0,0]),Bo);Uo=Lo=jo([(0,w.b)(),ko(0,(0,S.f)(ho)),ko(1,(0,S.f)(re)),Fo("design:paramtypes",["function"===typeof(Zo="undefined"!==typeof ho&&ho)?Zo:Object,"function"===typeof(_o="undefined"!==typeof re&&re)?_o:Object])],Uo),U.bind(Uo).toSelf().inSingletonScope();var Mo=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let No=class{constructor(){(0,x.Z)(this,"history",[]),(0,x.Z)(this,"cursor",-1),(0,x.Z)(this,"updateObservable",new ge)}Push(t){this.CanRedo&&this.history.splice(this.cursor+1),this.history.push(t),this.cursor=this.history.length-1,this.updateObservable.Notify()}Undo(){this.CanUndo&&(this.history[this.cursor--].Undo(),this.updateObservable.Notify())}Redo(){this.CanRedo&&(this.history[++this.cursor].Apply(),this.updateObservable.Notify())}Reset(){this.history.length=0,this.cursor=-1,this.updateObservable.Notify()}get CanUndo(){return this.cursor>=0}get CanRedo(){return this.cursor<this.history.length-1}get UpdateObservable(){return this.updateObservable}};No=Mo([(0,w.b)()],No),U.bind(No).toSelf().inSingletonScope();var zo,Go,Vo,Ho=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Wo=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Yo=function(t,e){return function(i,o){e(i,o,t)}};let Xo=class{constructor(t,e,i){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"history",void 0),(0,x.Z)(this,"layout",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"undoButton",void 0),(0,x.Z)(this,"redoButton",void 0),(0,x.Z)(this,"undoObservable",new ge),(0,x.Z)(this,"redoObservable",new ge),this.uiRenderer=t,this.history=e,this.layout=i;const o=[.9254901960784314,.9411764705882353,.9450980392156862],n=[.4980392156862745,.5490196078431373,.5529411764705883],r=[.08235294117647059,.396078431372549,.7529411764705882],s=10,l=30;this.group=new Pe({x:6*s+4*l,y:s+l},{vertical:Se.Top}),this.undoButton=this.uiRenderer.CreateIconButton({x:0,y:0},{width:l,height:l},1,{fillColor:o,outlineColor:n},{icon:xe.Undo,color:r},(t=>this.undoObservable.Notify()),this.group),this.undoButton.Disable=!0,this.redoButton=this.uiRenderer.CreateIconButton({x:l+s,y:0},{width:l,height:l},1,{fillColor:o,outlineColor:n},{icon:xe.Redo,color:r},(t=>this.redoObservable.Notify()),this.group),this.redoButton.Disable=!0,this.history.UpdateObservable.Attach((()=>this.UpdateButtonsAvailability())),this.layout.Watch(this.group)}Resize(){this.group.Resize()}get CanUndo(){return this.undoButton.Disable}set CanUndo(t){this.undoButton.Disable!==t&&(this.undoButton.Disable=t)}get CanRedo(){return this.redoButton.Disable}set CanRedo(t){this.redoButton.Disable!==t&&(this.redoButton.Disable=t)}get UndoObservable(){return this.undoObservable}get RedoObservable(){return this.redoObservable}Lock(){this.undoButton.Disable=!0,this.redoButton.Disable=!0}Unlock(){this.UpdateButtonsAvailability()}UpdateButtonsAvailability(){this.undoButton.Disable=!this.history.CanUndo,this.redoButton.Disable=!this.history.CanRedo}};Xo=Ho([(0,w.b)(),Yo(0,(0,S.f)(ho)),Yo(1,(0,S.f)(No)),Yo(2,(0,S.f)(re)),Wo("design:paramtypes",["function"===typeof(zo="undefined"!==typeof ho&&ho)?zo:Object,"function"===typeof(Go="undefined"!==typeof No&&No)?Go:Object,"function"===typeof(Vo="undefined"!==typeof re&&re)?Vo:Object])],Xo),U.bind(Xo).toSelf().inSingletonScope();var Ko,qo,$o,Qo=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Jo=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},tn=function(t,e){return function(i,o){e(i,o,t)}};let en=class{constructor(t,e,i){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"fontGlyphCollectionFactory",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"outputTextList",void 0),(0,x.Z)(this,"inputEditableTextList",void 0),(0,x.Z)(this,"inputButton",void 0),(0,x.Z)(this,"outputButton",void 0),(0,x.Z)(this,"fontGlyphCollection",null),(0,x.Z)(this,"maxPanelWidth",800),this.settings=t,this.uiRenderer=e,this.fontGlyphCollectionFactory=i;const o=[.9254901960784314,.9411764705882353,.9450980392156862],n=[.4980392156862745,.5490196078431373,.5529411764705883],r=[.17254901960784313,.24313725490196078,.3137254901960784],s=10,l=25,h=100;this.group=new Pe({x:145,y:10},{vertical:Se.Bottom}),this.inputButton=this.uiRenderer.CreateIconButton({x:0,y:h+s/2},{width:l,height:l},1,{fillColor:o,outlineColor:n},{icon:xe.Input,color:r},(t=>this.SwitchTab(!0)),this.group),this.outputButton=this.uiRenderer.CreateIconButton({x:l+s,y:h+s/2},{width:l,height:l},1,{fillColor:o,outlineColor:n},{icon:xe.Output,color:r},(t=>this.SwitchTab(!1)),this.group),this.outputButton.Disable=!0,this.outputTextList=this.uiRenderer.CreateTextList({x:0,y:0},{width:this.maxPanelWidth,height:h},1,"",{borderWidth:2,fillColor:[0,0,0,0]},32,this.group),this.inputEditableTextList=this.uiRenderer.CreateEditableTextList({x:0,y:0},{width:this.maxPanelWidth,height:h},1,"",{borderWidth:2,fillColor:[0,0,0,0]},32,this.group),this.inputEditableTextList.Visible=!1}SwitchTab(t){this.inputButton.Disable=t,this.outputButton.Disable=!t,this.inputEditableTextList.Visible=t,this.outputTextList.Visible=!t,this.outputTextList.Visible&&this.outputTextList.ScrollToTop()}get Output(){return this.outputTextList.Text}set Output(t){this.outputTextList.Text=this.NewLineFormatter(t),this.outputTextList.ScrollToTop()}get Input(){return this.inputEditableTextList.Text}Resize(){this.inputEditableTextList.Dimension={width:this.PanelWidth,height:this.inputEditableTextList.Dimension.height/this.inputEditableTextList.Scale},this.outputTextList.Dimension={width:this.PanelWidth,height:this.inputEditableTextList.Dimension.height/this.inputEditableTextList.Scale},this.group.Resize()}get PanelWidth(){const t=this.settings.ViewDimension.Width-this.group.AbsolutePosition.x;return Math.min(this.maxPanelWidth,t)/this.group.Scale}NewLineFormatter(t){const e=this.RetrieveFontGlyphCollection(),i=[...t],o=20*this.group.Scale;for(let n=0,r=o;n<i.length;++n){const t=i[n];if("\n"===t){r=o;continue}const s=bi.Try(Di(e,"Lookup"),t).CatchFn(Di(e,"Lookup"),"?");r+s.width>this.outputTextList.Dimension.width?(r=o,i.splice(n,0,"\n")):r+=s.width}return i.join("")}RetrieveFontGlyphCollection(){return null!==this.fontGlyphCollection&&this.fontGlyphCollection.LineHeight===this.outputTextList.LineHeight*this.outputTextList.Scale||(this.fontGlyphCollection=this.fontGlyphCollectionFactory({ASCIIRange:{Start:" ",End:"~"},Font:{Name:"Roboto",Size:this.outputTextList.LineHeight*this.outputTextList.Scale}})),this.fontGlyphCollection}};en=Qo([(0,w.b)(),tn(0,(0,S.f)(V)),tn(1,(0,S.f)(ho)),tn(2,(0,S.f)(L.FontGlyphCollectionFactory)),Jo("design:paramtypes",["function"===typeof(Ko="undefined"!==typeof V&&V)?Ko:Object,"function"===typeof(qo="undefined"!==typeof ho&&ho)?qo:Object,"function"===typeof($o="undefined"!==typeof n.FontGlyphCollectionFactory&&n.FontGlyphCollectionFactory)?$o:Object])],en),U.bind(en).toSelf().inSingletonScope();var on,nn,rn,sn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ln=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},hn=function(t,e){return function(i,o){e(i,o,t)}};let cn=class{constructor(t,e,i){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"fontGlyphCollectionFactory",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"display",null),(0,x.Z)(this,"lineHeight",16),(0,x.Z)(this,"maxWidth",1024),(0,x.Z)(this,"defaultTextColor",[.9254901960784314,.9411764705882353,.9450980392156862]),(0,x.Z)(this,"instructions",void 0),(0,x.Z)(this,"helpString",void 0),(0,x.Z)(this,"instructionPaddingEnd",void 0),this.settings=t,this.uiRenderer=e,this.fontGlyphCollectionFactory=i,this.group=new Pe({x:0,y:0},{vertical:Se.Bottom,horizontal:we.Middle}),this.instructions=[{instruction:"0-9",description:"Push this number onto the stack."},{instruction:"+",description:"Addition: Pop a and b, then push a+b."},{instruction:"-",description:"Subtraction: Pop a and b, then push b-a."},{instruction:"*",description:"Multiplication: Pop a and b, then push a*b."},{instruction:"/",description:"Integer division: Pop a and b, then push b/a, rounded towards 0."},{instruction:"%",description:"Modulo: Pop a and b, then push the remainder of the integer division of b/a."},{instruction:"!",description:"Logical NOT: Pop a value. If the value is zero, push 1; otherwise, push zero."},{instruction:"`",description:"Greater than: Pop a and b, then push 1 if b>a, otherwise zero."},{instruction:">",description:"Start moving right."},{instruction:"<",description:"Start moving left."},{instruction:"^",description:"Start moving up."},{instruction:"v",description:"Start moving down."},{instruction:"?",description:"Start moving in a random cardinal direction."},{instruction:"_",description:"Pop a value; move right if value=0, left otherwise."},{instruction:"|",description:"Pop a value; move down if value=0, up otherwise."},{instruction:'"',description:"Start string mode: push each character's ASCII value all the way up to the next \""},{instruction:":",description:"Duplicate value on top of the stack."},{instruction:"\\",description:"Swap two values on top of the stack."},{instruction:"$",description:"Pop value from the stack and discard it."},{instruction:".",description:"Pop value and output as an integer followed by a space."},{instruction:",",description:"Pop value and output as ASCII character."},{instruction:"#",description:"Bridge: Skip next cell."},{instruction:"p",description:'A "put" call (a way to store a value for later use). Pop y, x, and v, then change the character at (x,y) in the program to the character with ASCII value v.'},{instruction:"g",description:'A "get" call (a way to retrieve data in storage). Pop y and x, then push ASCII value of the character at that position in the program.'},{instruction:"&",description:"Ask user for a number and push it."},{instruction:"~",description:"Ask user for a character and push its ASCII value."},{instruction:"@",description:"End program."},{instruction:'" "',description:"No-op. Does nothing"}],this.BuildHelpString()}BuildHelpString(){this.instructionPaddingEnd=ot.Max(this.instructions,((t,e)=>t.instruction.length<e.instruction.length)).instruction.length,this.helpString=this.instructions.map((t=>` ${t.instruction.padEnd(this.instructionPaddingEnd)} ${t.description}`)).join("\n")}NewLineFormatter(t){const e=this.fontGlyphCollectionFactory({ASCIIRange:{Start:" ",End:"~"},Font:{Name:"Roboto",Size:this.lineHeight*this.group.Scale}}),i=[...t],o=20*this.group.Scale;let n=1;const r=[[1,1+this.instructions[0].instruction.length]];for(let s=0,l=o;s<i.length;++s){const t=i[s];if("\n"===t){l=o,r.push([s+2,s+2+this.instructions[n++].instruction.length]);continue}const h=bi.Try(Di(e,"Lookup"),t).CatchFn(Di(e,"Lookup"),"?");l+h.width>this.display.Dimension.width?(l=o,i.splice(s,0,"\n",..." ".repeat(this.instructionPaddingEnd+2))):l+=h.width}return{text:i.join(""),instructionRange:r}}ToggleHelp(){if(null===this.display){this.display=this.uiRenderer.CreateTextList({x:0,y:0},{width:Math.min(this.maxWidth,this.settings.ViewDimension.Width)/this.group.Scale,height:this.settings.ViewDimension.Height/this.group.Scale*.75},6,"",{borderWidth:2,fillColor:[1,1,1,1]},this.lineHeight,this.group);const t=this.NewLineFormatter(this.helpString);this.display.Text=t.text,t.instructionRange.forEach((t=>this.display.StyleRange(t[0],t[1],{color:[.9058823529411765,.2980392156862745,.23529411764705882]})))}else this.display.Destroy(),this.display=null}};cn=sn([(0,w.b)(),hn(0,(0,S.f)(V)),hn(1,(0,S.f)(ho)),hn(2,(0,S.f)(L.FontGlyphCollectionFactory)),ln("design:paramtypes",["function"===typeof(on="undefined"!==typeof V&&V)?on:Object,"function"===typeof(nn="undefined"!==typeof ho&&ho)?nn:Object,"function"===typeof(rn="undefined"!==typeof n.FontGlyphCollectionFactory&&n.FontGlyphCollectionFactory)?rn:Object])],cn),U.bind(cn).toSelf().inSingletonScope();var an,dn,un=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},fn=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},pn=function(t,e){return function(i,o){e(i,o,t)}};let gn=class{constructor(t,e){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"snackbar",null),(0,x.Z)(this,"contentColor",[.9,.9,.9]),(0,x.Z)(this,"lineHeight",24),(0,x.Z)(this,"showTime",5e3),(0,x.Z)(this,"hideTimer",-1),this.uiRenderer=t,this.settings=e,this.group=new Pe({x:0,y:0},{vertical:Se.Bottom,horizontal:we.Middle})}Show(t,e,i){null!==this.snackbar&&this.Hide(),this.snackbar=this.uiRenderer.CreateAlert({x:0,y:0},1,t,e,i,this.group),this.LimitToViewportWidth(),this.hideTimer=setTimeout((()=>this.Hide()),this.showTime)}LimitToViewportWidth(){const t=this.group.Dimension.width;if(t>this.settings.ViewDimension.Width){const e=this.settings.ViewDimension.Width/t;this.group.Scale=e}}ShowError(t){this.Show({icon:xe.ExclamationCircle,color:this.contentColor},{text:t,lineHeight:this.lineHeight,color:this.contentColor},{fillColor:[.83,.18,.18]})}ShowWarning(t){this.Show({icon:xe.ExclamationTriangle,color:this.contentColor},{text:t,lineHeight:this.lineHeight,color:this.contentColor},{fillColor:[.93,.42,.01]})}ShowInformation(t){this.Show({icon:xe.ExclamationCircle,color:this.contentColor},{text:t,lineHeight:this.lineHeight,color:this.contentColor},{fillColor:[.1,.53,.82]})}ShowSuccess(t){this.Show({icon:xe.ExclamationCircle,color:this.contentColor},{text:t,lineHeight:this.lineHeight,color:this.contentColor},{fillColor:[.18,.49,.2]})}Hide(){this.snackbar?.Destroy(),this.snackbar=null,clearTimeout(this.hideTimer)}Resize(){this.group.Resize()}};function yn(t){return[...t].map((t=>bn(t))).join()}function bn(t){return"\n"===t?"\\n":"\r"===t?"\\r":t}gn=un([(0,w.b)(),pn(0,(0,S.f)(ho)),pn(1,(0,S.f)(V)),fn("design:paramtypes",["function"===typeof(an="undefined"!==typeof ho&&ho)?an:Object,"function"===typeof(dn="undefined"!==typeof V&&V)?dn:Object])],gn),U.bind(gn).toSelf().inSingletonScope();var vn,mn,xn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Cn=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Rn=function(t,e){return function(i,o){e(i,o,t)}};let wn=class{constructor(t,e){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"group",void 0),(0,x.Z)(this,"stackTextList",void 0),this.uiRenderer=t,this.settings=e,this.group=new Pe({x:10,y:480},{vertical:Se.Top}),this.stackTextList=this.uiRenderer.CreateTextList({x:0,y:0},{width:130,height:300},1,"",{borderWidth:2,fillColor:[0,0,0,0]},32,this.group),this.stackTextList.Visible=!1}ScrollToTop(){this.stackTextList.ScrollToTop()}Resize(){this.group.Resize()}set Stack(t){this.stackTextList.Text=[...t].reverse().map((t=>`${t} (${yn(String.fromCharCode(t))})`)).join("\n")}get Visible(){return this.stackTextList.Visible}set Visible(t){this.stackTextList.Visible=t}};wn=xn([(0,w.b)(),Rn(0,(0,S.f)(ho)),Rn(1,(0,S.f)(V)),Cn("design:paramtypes",["function"===typeof(vn="undefined"!==typeof ho&&ho)?vn:Object,"function"===typeof(mn="undefined"!==typeof V&&V)?mn:Object])],wn),U.bind(wn).toSelf().inSingletonScope();var Sn,Pn,Dn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},An=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},On=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["Lovercase"]=0]="Lovercase",t[t["Uppercase"]=1]="Uppercase",t[t["Secondary"]=2]="Secondary"})(Pn||(Pn={}));class Tn{constructor(t,e,i){(0,x.Z)(this,"keyboardState",void 0),(0,x.Z)(this,"symbols",void 0),this.keyboardState=t,this.symbols=void 0===i?[e]:[i,e]}get Caption(){let t=this.symbols[this.symbols.length-1];if(t=this.IsUppercase?t.toUpperCase():t.toLowerCase(),this.keyboardState.shift()!==Pn.Secondary&&this.keyboardState.ascii()&&(t=t.charCodeAt(0).toString()),this.HasSecondary){let e=this.symbols[0];return this.keyboardState.shift()===Pn.Secondary&&this.keyboardState.ascii()&&(e=e.charCodeAt(0).toString()),`${e}\n${t}`}return t}get Symbol(){const t=this.symbols[this.Index];return this.IsUppercase?t.toUpperCase():t.toLowerCase()}get CaptionDelimiter(){return this.keyboardState.shift()===Pn.Secondary&&this.keyboardState.ascii()?this.symbols[0].charCodeAt(0).toString().length:this.symbols[0].length}get HasSecondary(){return this.symbols.length>1}get Index(){return+(this.keyboardState.shift()===Pn.Lovercase||this.keyboardState.shift()===Pn.Uppercase)%this.symbols.length}get IsUppercase(){return this.keyboardState.shift()===Pn.Uppercase}}let En=class{constructor(t){(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"fillColor",[.9254901960784314,.9411764705882353,.9450980392156862]),(0,x.Z)(this,"outlineColor",[.4980392156862745,.5490196078431373,.5529411764705883]),(0,x.Z)(this,"zIndex",5),(0,x.Z)(this,"toggleKeyboardGroup",void 0),(0,x.Z)(this,"toggleKeyboard",!1),(0,x.Z)(this,"toggleKeyboardButton",void 0),(0,x.Z)(this,"shiftIconColor",{lovercase:[.17254901960784313,.24313725490196078,.3137254901960784],uppercase:[.08235294117647059,.396078431372549,.7529411764705882],secondary:[.5568627450980392,.26666666666666666,.6784313725490196]}),(0,x.Z)(this,"buttonCaptionColor",{inactive:[.7411764705882353,.7411764705882353,.7411764705882353],active:[.17254901960784313,.24313725490196078,.3137254901960784]}),(0,x.Z)(this,"asciiToggleOutlineColor",{inactive:[.4980392156862745,.5490196078431373,.5529411764705883],active:[0,0,0]}),(0,x.Z)(this,"buttonContentColor",[.17254901960784313,.24313725490196078,.3137254901960784]),(0,x.Z)(this,"keyboardGroup",void 0),(0,x.Z)(this,"symbolButtons",[]),(0,x.Z)(this,"buttonDimension",{width:30,height:60}),(0,x.Z)(this,"symbolMargin",5),(0,x.Z)(this,"spacebarButton",void 0),(0,x.Z)(this,"buttonDeleter",[]),(0,x.Z)(this,"shiftWidth",50),(0,x.Z)(this,"shiftMode",Pn.Lovercase),(0,x.Z)(this,"asciiMode",!1),(0,x.Z)(this,"digitsSymbolRow",void 0),(0,x.Z)(this,"firstSymbolRow",void 0),(0,x.Z)(this,"secondSymbolRow",void 0),(0,x.Z)(this,"thirdSymbolRow",void 0),(0,x.Z)(this,"observable",new ge),this.uiRenderer=t,this.toggleKeyboardGroup=new Pe({x:10,y:10}),this.toggleKeyboardButton=this.uiRenderer.CreateIconButton({x:0,y:0},{width:30,height:30},this.zIndex,{fillColor:this.fillColor,outlineColor:this.outlineColor},{icon:xe.Keyboard,color:this.shiftIconColor.lovercase},(t=>this.ToggleKeyboard()),this.toggleKeyboardGroup),this.keyboardGroup=new Pe({x:0,y:this.symbolMargin},{horizontal:we.Middle}),this.SetupKeyboardLayouts(),this.observable.Attach((t=>this.TouchFeedback()))}SetupKeyboardLayouts(){const t={shift:()=>this.shiftMode,ascii:()=>this.asciiMode};this.digitsSymbolRow=[new Tn(t,"1","!"),new Tn(t,"2","?"),new Tn(t,"3",","),new Tn(t,"4","."),new Tn(t,"5","\\"),new Tn(t,"6","`"),new Tn(t,"7"),new Tn(t,"8"),new Tn(t,"9"),new Tn(t,"0")],this.firstSymbolRow=[new Tn(t,"q","%"),new Tn(t,"w","^"),new Tn(t,"e","~"),new Tn(t,"r","|"),new Tn(t,"t","["),new Tn(t,"y","]"),new Tn(t,"u","<"),new Tn(t,"i",">"),new Tn(t,"o","{"),new Tn(t,"p","}")],this.secondSymbolRow=[new Tn(t,"a","@"),new Tn(t,"s","#"),new Tn(t,"d","&"),new Tn(t,"f","*"),new Tn(t,"g","-"),new Tn(t,"h","+"),new Tn(t,"j","="),new Tn(t,"k","("),new Tn(t,"l",")")],this.thirdSymbolRow=[new Tn(t,"z","_"),new Tn(t,"s","$"),new Tn(t,"c",'"'),new Tn(t,"v","'"),new Tn(t,"b",":"),new Tn(t,"n",";"),new Tn(t,"m","/")]}ToggleKeyboard(){this.toggleKeyboard=!this.toggleKeyboard,this.toggleKeyboardButton.Icon={icon:this.toggleKeyboardButton.Icon.icon,color:this.toggleKeyboard?this.shiftIconColor.uppercase:this.shiftIconColor.lovercase},this.toggleKeyboard?this.SpawnKeyboard():this.HideKeyboard()}SpawnKeyboard(){this.CreateSymbolRow({x:0,y:4*this.buttonDimension.height+5*this.symbolMargin},this.digitsSymbolRow),this.CreateSymbolRow({x:0,y:3*this.buttonDimension.height+4*this.symbolMargin},this.firstSymbolRow),this.CreateSymbolRow({x:this.buttonDimension.width/2,y:2*this.buttonDimension.height+3*this.symbolMargin},this.secondSymbolRow),this.CreateSymbolRow({x:this.shiftWidth+this.symbolMargin,y:this.buttonDimension.height+2*this.symbolMargin},this.thirdSymbolRow),this.CreateBottomRow()}CreateSymbolRow(t,e){for(let i=0;i<e.length;++i){const o=e[i],n=this.uiRenderer.CreateTextButton({x:t.x+(this.buttonDimension.width+this.symbolMargin)*i,y:t.y},{width:this.buttonDimension.width,height:this.buttonDimension.height},this.zIndex,{fillColor:this.fillColor,outlineColor:this.outlineColor},{text:o.Caption,lineHeight:16,color:this.buttonContentColor},(t=>this.observable.Notify(e[i].Symbol)),this.keyboardGroup);this.StyleButtonCaption(n,o,!0),this.symbolButtons.push({button:n,layout:o}),this.buttonDeleter.push((()=>n.Destroy()))}}CreateBottomRow(){const t=this.uiRenderer.CreateIconButton({x:0,y:this.buttonDimension.height+2*this.symbolMargin},{width:this.shiftWidth,height:this.buttonDimension.height},this.zIndex,{fillColor:this.fillColor,outlineColor:this.outlineColor},{icon:xe.Shift,color:this.buttonContentColor},(t=>this.ToggleShift(t)),this.keyboardGroup);this.buttonDeleter.push((()=>t.Destroy())),this.spacebarButton=this.uiRenderer.CreateTextButton({x:this.shiftWidth+this.symbolMargin,y:this.symbolMargin},{width:this.thirdSymbolRow.length*this.buttonDimension.width+this.symbolMargin*(this.thirdSymbolRow.length-1),height:this.buttonDimension.height},this.zIndex,{fillColor:this.fillColor,outlineColor:this.outlineColor},{text:"",lineHeight:16,color:this.buttonContentColor},(t=>this.observable.Notify(" ")),this.keyboardGroup),this.buttonDeleter.push((()=>this.spacebarButton.Destroy()));const e=this.uiRenderer.CreateIconButton({x:this.shiftWidth+this.thirdSymbolRow.length*this.buttonDimension.width+(this.thirdSymbolRow.length+1)*this.symbolMargin,y:this.buttonDimension.height+2*this.symbolMargin},{width:this.shiftWidth,height:this.buttonDimension.height},this.zIndex,{fillColor:this.fillColor,outlineColor:this.outlineColor},{icon:xe.Backspace,color:this.buttonContentColor},(t=>this.observable.Notify("Backspace")),this.keyboardGroup);this.buttonDeleter.push((()=>e.Destroy()));const i=this.uiRenderer.CreateTextButton({x:this.shiftWidth+this.thirdSymbolRow.length*this.buttonDimension.width+(this.thirdSymbolRow.length+1)*this.symbolMargin,y:this.symbolMargin},{width:this.shiftWidth,height:this.buttonDimension.height},this.zIndex,{fillColor:this.fillColor,outlineColor:this.outlineColor},{text:"ASCII",lineHeight:16,color:this.buttonContentColor},(t=>this.ToggleASCII(t)),this.keyboardGroup);this.buttonDeleter.push((()=>i.Destroy()))}ToggleShift(t){this.TouchFeedback(),this.shiftMode=(this.shiftMode+1)%q(Pn);const e=[this.shiftIconColor.lovercase,this.shiftIconColor.uppercase,this.shiftIconColor.secondary][this.shiftMode];t.Icon={...t.Icon,color:e},this.UpdateSymbolButtonsCaptions()}ToggleASCII(t){this.TouchFeedback(),this.asciiMode=!this.asciiMode,this.spacebarButton.Caption={...this.spacebarButton.Caption,text:this.asciiMode?" ".charCodeAt(0).toString():""},t.Style={...t.Style,outlineColor:this.asciiToggleOutlineColor[this.asciiMode?"active":"inactive"]},this.UpdateSymbolButtonsCaptions()}UpdateSymbolButtonsCaptions(){this.symbolButtons.forEach((t=>{const{button:e,layout:i}=t;switch(e.Caption={...e.Caption,text:i.Caption},this.shiftMode){case Pn.Lovercase:case Pn.Uppercase:this.StyleButtonCaption(e,i,!0);break;case Pn.Secondary:this.StyleButtonCaption(e,i,!1);break}}))}StyleButtonCaption(t,e,i){if(e.HasSecondary){const[o,n]=i?[this.buttonCaptionColor.inactive,this.buttonCaptionColor.active]:[this.buttonCaptionColor.active,this.buttonCaptionColor.inactive];t.StyleCaptionRange(0,e.CaptionDelimiter,{color:o}),t.StyleCaptionRange(e.CaptionDelimiter+1,t.Caption.text.length,{color:n})}else t.StyleCaptionRange(0,t.Caption.text.length,{color:this.buttonCaptionColor.active})}HideKeyboard(){this.buttonDeleter.forEach((t=>t())),this.buttonDeleter.length=0,this.symbolButtons.length=0,this.shiftMode=Pn.Lovercase}TouchFeedback(){navigator.vibrate(30)}get Observable(){return this.observable}get AbsolutePosition(){return this.keyboardGroup.AbsolutePosition}get Dimension(){return this.keyboardGroup.Dimension}Resize(){this.toggleKeyboardGroup.Resize(),this.keyboardGroup.Resize()}};En=Dn([(0,w.b)(),On(0,(0,S.f)(ho)),An("design:paramtypes",["function"===typeof(Sn="undefined"!==typeof ho&&ho)?Sn:Object])],En),U.bind(En).toSelf().inSingletonScope();var In,Bn,Ln,Zn,_n,jn,Fn,kn,Un,Mn,Nn,zn,Gn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Vn=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Hn=function(t,e){return function(i,o){e(i,o,t)}};let Wn=class{constructor(t,e,i,o,n,r,s,l,h,c,a,d){(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"uiRenderer",void 0),(0,x.Z)(this,"snackbarControls",void 0),(0,x.Z)(this,"fileControls",void 0),(0,x.Z)(this,"languageSyntaxHelpControls",void 0),(0,x.Z)(this,"historyControls",void 0),(0,x.Z)(this,"editControls",void 0),(0,x.Z)(this,"editDirectionControls",void 0),(0,x.Z)(this,"debugControls",void 0),(0,x.Z)(this,"stackControls",void 0),(0,x.Z)(this,"virtualKeyboardControls",void 0),(0,x.Z)(this,"ioControls",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"stickyProjection",void 0),this.gl=t,this.uiRenderer=e,this.snackbarControls=i,this.fileControls=o,this.languageSyntaxHelpControls=n,this.historyControls=r,this.editControls=s,this.editDirectionControls=l,this.debugControls=h,this.stackControls=c,this.virtualKeyboardControls=a,this.ioControls=d,this.settings=U.get(V),this.BuildStickyProjection()}get EditDirectionControls(){return this.editDirectionControls}get DebugControls(){return this.debugControls}get IOControls(){return this.ioControls}get Snackbar(){return this.snackbarControls}get FileControls(){return this.fileControls}get LanguageSyntaxHelpControls(){return this.languageSyntaxHelpControls}get HistoryControls(){return this.historyControls}get EditControls(){return this.editControls}get StackControls(){return this.stackControls}get VirtualKeyboardControls(){return this.virtualKeyboardControls}Resize(){this.BuildStickyProjection(),this.uiRenderer.ViewProjection=this.stickyProjection,this.editDirectionControls.Resize(),this.debugControls.Resize(),this.fileControls.Resize(),this.snackbarControls.Resize(),this.historyControls.Resize(),this.editControls.Resize(),this.stackControls.Resize(),this.virtualKeyboardControls.Resize(),this.ioControls.Resize()}Touch(t){const e=t.offsetX,i=this.gl.canvas.height-t.offsetY,o=Yt.AABBRectanglePoint({x:this.virtualKeyboardControls.AbsolutePosition.x,y:this.virtualKeyboardControls.AbsolutePosition.y,width:this.virtualKeyboardControls.Dimension.width,height:this.virtualKeyboardControls.Dimension.height},{x:e,y:i});return this.uiRenderer.Touch({offsetX:e,offsetY:i})||o}Scroll(t){t.startY=this.gl.canvas.height-t.startY;const e=this.uiRenderer.FindTextList(t.startX,t.startY);return null!==e&&("px"===t.units?e.ScrollAligned(t.scroll):"row"===t.units&&e.ScrollAligned(t.scroll*e.LineHeight),!0)}Draw(){this.uiRenderer.Draw()}BuildStickyProjection(){this.stickyProjection=H.M5(H.Ue(),0,this.gl.canvas.width,0,this.gl.canvas.height,-this.settings.ZNear,-this.settings.ZFar)}};Wn=Gn([(0,w.b)(),Hn(0,(0,S.f)(L.WebGLRenderingContext)),Hn(1,(0,S.f)(ho)),Hn(2,(0,S.f)(gn)),Hn(3,(0,S.f)(Uo)),Hn(4,(0,S.f)(cn)),Hn(5,(0,S.f)(Xo)),Hn(6,(0,S.f)(So)),Hn(7,(0,S.f)(Io)),Hn(8,(0,S.f)(vo)),Hn(9,(0,S.f)(wn)),Hn(10,(0,S.f)(En)),Hn(11,(0,S.f)(en)),Vn("design:paramtypes",["function"===typeof(In="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?In:Object,"function"===typeof(Bn="undefined"!==typeof ho&&ho)?Bn:Object,"function"===typeof(Ln="undefined"!==typeof gn&&gn)?Ln:Object,"function"===typeof(Zn="undefined"!==typeof Uo&&Uo)?Zn:Object,"function"===typeof(_n="undefined"!==typeof cn&&cn)?_n:Object,"function"===typeof(jn="undefined"!==typeof Xo&&Xo)?jn:Object,"function"===typeof(Fn="undefined"!==typeof So&&So)?Fn:Object,"function"===typeof(kn="undefined"!==typeof Io&&Io)?kn:Object,"function"===typeof(Un="undefined"!==typeof vo&&vo)?Un:Object,"function"===typeof(Mn="undefined"!==typeof wn&&wn)?Mn:Object,"function"===typeof(Nn="undefined"!==typeof En&&En)?Nn:Object,"function"===typeof(zn="undefined"!==typeof en&&en)?zn:Object])],Wn),U.bind(Wn).toSelf().inSingletonScope();var Yn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Xn=class{constructor(){(0,x.Z)(this,"nonEmptyCells",0),(0,x.Z)(this,"target",void 0)}Initialize(t,...e){this.nonEmptyCells=0,this.target=new t(...e)}Read(t){return this.target.Read(t)}Write(t,e){const i=" ".charCodeAt(0),o=this.target.Read(t);o!==e&&(o===i?++this.nonEmptyCells:e===i&&--this.nonEmptyCells),this.target.Write(t,e)}Resize(t){this.target.Resize(t)}Clone(){return this.target.Clone()}get Empty(){return 0===this.nonEmptyCells}get PointerArithmetics(){return this.target.PointerArithmetics}get Target(){return this.target}};Xn=Yn([(0,w.b)()],Xn),U.bind(Xn).toSelf().inSingletonScope();class Kn{Draw(){}Unload(){}set ViewProjection(t){}}var qn,$n,Qn,Jn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},tr=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},er=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["LeftBottom"]=0]="LeftBottom",t[t["LeftTop"]=1]="LeftTop",t[t["RightTop"]=2]="RightTop",t[t["RightBottom"]=3]="RightBottom"})(Qn||(Qn={}));let ir=class{constructor(t,e){(0,x.Z)(this,"codeEditorRenderer",void 0),(0,x.Z)(this,"perspectiveLabelRenderer",void 0),(0,x.Z)(this,"tooltips",[]),this.codeEditorRenderer=t,this.perspectiveLabelRenderer=e}Tooltip(t,e,i,o){const n=this.FindIndex(t,e,o);if(-1!==n)return""===i?this.ReleaseTooltip(n):this.tooltips[n].instance.Text=i,this.BuildReleaser(t,e,o);const r=10,s=.5,l=this.perspectiveLabelRenderer.Create({x:0,y:0},499.7,i,8,null);return l.Scale=.2,queueMicrotask((()=>{let i=0,n=0;switch(o){case Qn.LeftBottom:i=s+t*r,n=s+(this.codeEditorRenderer.Dimension.Rows-e-1)*r;break;case Qn.LeftTop:i=s+t*r,n=(this.codeEditorRenderer.Dimension.Rows-e-1)*r+r-l.Dimension.height-s;break;case Qn.RightTop:i=t*r+r-l.Dimension.width-s,n=(this.codeEditorRenderer.Dimension.Rows-e-1)*r+r-l.Dimension.height-s;break;case Qn.RightBottom:i=t*r+r-l.Dimension.width-s,n=s+(this.codeEditorRenderer.Dimension.Rows-e-1)*r;break}l.Position={x:i,y:n}})),this.tooltips.push({column:t,row:e,position:o,instance:l}),this.BuildReleaser(t,e,o)}ReleaseAll(){while(this.tooltips.length>0)this.ReleaseTooltip(this.tooltips.length-1)}FindIndex(t,e,i){return this.tooltips.findIndex((o=>o.column===t&&o.row===e&&o.position===i))}BuildReleaser(t,e,i){return()=>{const o=this.FindIndex(t,e,i);-1!==o&&this.ReleaseTooltip(o)}}ReleaseTooltip(t){this.tooltips[t].instance.Destroy(),this.tooltips.splice(t,1)}};ir=Jn([(0,w.b)(),er(0,(0,S.f)(Vt)),er(1,(0,S.f)(ji)),er(1,(0,P.t)(Z.Perspective)),tr("design:paramtypes",["function"===typeof(qn="undefined"!==typeof Vt&&Vt)?qn:Object,"function"===typeof($n="undefined"!==typeof ji&&ji)?$n:Object])],ir),U.bind(ir).toSelf().inSingletonScope();var or=i(3346);class nr{constructor(t,e,i){(0,x.Z)(this,"width",void 0),(0,x.Z)(this,"height",void 0),(0,x.Z)(this,"provider",void 0),(0,x.Z)(this,"data",void 0),this.width=t,this.height=e,this.provider=i,i&&this.Initialize()}static WithConstructor(t,e,i){return new nr(t,e,(()=>new i))}static WithProvider(t,e,i){return new nr(t,e,i)}Get(t){return this.data[this.CoordsToIndex(t)]}Set(t,e){this.data[this.CoordsToIndex(t)]=e}Update(t,e){const i=this.CoordsToIndex(t);this.data[i]=e(this.data[i])}Map(t){const e=new nr(this.width,this.height);return e.data=this.data.map(((e,i)=>t(e,this.IndexToCoord(i),this))),e}ForEach(t){this.data.forEach(((e,i)=>t(e,this.IndexToCoord(i),this)))}Every(t){return this.data.every(((e,i)=>t(e,this.IndexToCoord(i),this)))}Equals(t){return t.width===this.width&&t.height===this.height&&this.Every(((e,i)=>e===t.Get(i)))}get RawRef(){return this.data}Initialize(){this.data=Array.from({length:this.width*this.height},(()=>this.provider()))}CoordsToIndex(t){return t.row*this.width+t.column}IndexToCoord(t){const e=Math.floor(t/this.width),i=t-e*this.width;return{column:i,row:e}}}var rr,sr,lr,hr,cr,ar,dr=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ur=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},fr=function(t,e){return function(i,o){e(i,o,t)}};let pr=class{constructor(t,e,i,o,n,r,s,l){(0,x.Z)(this,"editorSourceCode",void 0),(0,x.Z)(this,"codeEditorRenderer",void 0),(0,x.Z)(this,"editCellCommandFactory",void 0),(0,x.Z)(this,"cellMoveNextPostActionFactory",void 0),(0,x.Z)(this,"editCellsRegionCommandFactory",void 0),(0,x.Z)(this,"regionMoveNextPostActionFactory",void 0),(0,x.Z)(this,"regionStayLeftTopPostActionFactory",void 0),(0,x.Z)(this,"history",void 0),(0,x.Z)(this,"editableCellStyle",[.21568627450980393,.2784313725490196,.30980392156862746]),(0,x.Z)(this,"editableRegion",{lt:{x:0,y:0},rb:{x:0,y:0}}),(0,x.Z)(this,"editionDirection",Cr.Right),this.editorSourceCode=t,this.codeEditorRenderer=e,this.editCellCommandFactory=i,this.cellMoveNextPostActionFactory=o,this.editCellsRegionCommandFactory=n,this.regionMoveNextPostActionFactory=r,this.regionStayLeftTopPostActionFactory=s,this.history=l,this.IsSingleCell?this.codeEditorRenderer.Select(this.editableRegion.lt.x,this.editableRegion.lt.y,this.editableCellStyle):this.codeEditorRenderer.SelectRegion(this.editableRegion.lt,this.editableRegion.rb,this.editableCellStyle)}CellInput(t){this.IsSingleCell?this.CellInputSingle(t):this.CellInputRegion(t)}CellInputSingle(t){const e=String.fromCharCode(this.editorSourceCode.Read(this.editableRegion.lt)),i="Backspace"===t?this.editCellCommandFactory(this.editableRegion.lt,e," ",this.ReversedDirection(this.editionDirection),this.cellMoveNextPostActionFactory()):this.editCellCommandFactory(this.editableRegion.lt,e,t,this.editionDirection,this.cellMoveNextPostActionFactory());i.Apply(),t===String.fromCharCode(this.editorSourceCode.Read(this.editableRegion.lt))||"Backspace"===t&&" "===e||this.history.Push(i)}CellInputRegion(t){const e=this.RegionDimension,i=nr.WithProvider(e.width,e.height,(()=>0));for(let n=this.editableRegion.lt.y;n<=this.editableRegion.rb.y;++n)for(let t=this.editableRegion.lt.x;t<=this.editableRegion.rb.x;++t)i.Set({column:t-this.editableRegion.lt.x,row:n-this.editableRegion.lt.y},this.editorSourceCode.Read({x:t,y:n}));const o="Backspace"===t?this.editCellsRegionCommandFactory(this.editableRegion,i,nr.WithProvider(e.width,e.height,(()=>" ".charCodeAt(0))),this.ReversedDirection(this.editionDirection),this.regionMoveNextPostActionFactory()):this.editCellsRegionCommandFactory(this.editableRegion,i,nr.WithProvider(e.width,e.height,(()=>t.charCodeAt(0))),this.editionDirection,this.regionMoveNextPostActionFactory());o.Apply(),"Backspace"===t&&i.Every((t=>" "===String.fromCharCode(t)))||i.Every((e=>String.fromCharCode(e)===t))||this.history.Push(o)}ReversedDirection(t){switch(t){case Cr.Left:return Cr.Right;case Cr.Right:return Cr.Left;case Cr.Up:return Cr.Down;case Cr.Down:return Cr.Up}}Select(t){this.IsLocationValid(t)&&(this.Unselect(),this.editableRegion.lt.x=t.x,this.editableRegion.lt.y=t.y,this.editableRegion.rb.x=t.x,this.editableRegion.rb.y=t.y,this.codeEditorRenderer.Select(this.editableRegion.lt.x,this.editableRegion.lt.y,this.editableCellStyle))}SelectRegion(t,e){if(!this.IsLocationValid(t)||!this.IsLocationValid(e))return;this.Unselect();const i=D.Extremum([t,e]),o={lt:i.min,rb:i.max};this.editableRegion.lt={...o.lt},this.editableRegion.rb={...o.rb},this.codeEditorRenderer.SelectRegion(o.lt,o.rb,this.editableCellStyle)}IsLocationValid(t){return t.x>=0&&t.y>=0&&t.x<this.codeEditorRenderer.Dimension.Columns&&t.y<this.codeEditorRenderer.Dimension.Rows}Unselect(){this.IsSingleCell?this.codeEditorRenderer.Unselect(this.editableRegion.lt.x,this.editableRegion.lt.y):this.codeEditorRenderer.UnselectRegion(this.editableRegion.lt,this.editableRegion.rb)}Focus(){this.codeEditorRenderer.SelectRegion(this.editableRegion.lt,this.editableRegion.rb,this.editableCellStyle)}Blur(){this.codeEditorRenderer.UnselectRegion(this.editableRegion.lt,this.editableRegion.rb)}ContentString(){let t="";for(let e=this.editableRegion.lt.y;e<=this.editableRegion.rb.y;++e){for(let i=this.editableRegion.lt.x;i<=this.editableRegion.rb.x;++i)t+=String.fromCharCode(this.editorSourceCode.Read({x:i,y:e}));t+="\n"}return t.slice(0,-1)}InsertSourceCode(t){const e=t.split(/\r?\n/);let i=0;const o=e.length;for(let l=0;l<e.length;++l){const t=e[l];t.length>i&&(i=t.length)}if(!this.IsLocationValid({x:this.editableRegion.lt.x+i-1,y:this.editableRegion.lt.y+o-1}))return!1;const n=nr.WithProvider(i,o,(()=>32));for(let l=0;l<e.length;++l){const t=e[l];for(let e=0;e<t.length;++e)n.Set({column:e,row:l},t[e].charCodeAt(0))}const r=nr.WithProvider(i,o,(()=>0));for(let l=this.editableRegion.lt.y;l<this.editableRegion.lt.y+o;++l)for(let t=this.editableRegion.lt.x;t<this.editableRegion.lt.x+i;++t)r.Set({column:t-this.editableRegion.lt.x,row:l-this.editableRegion.lt.y},this.editorSourceCode.Read({x:t,y:l}));const s=this.editCellsRegionCommandFactory(this.editableRegion,r,n,this.editionDirection,this.regionMoveNextPostActionFactory());return s.Apply(),n.Equals(r)||this.history.Push(s),!0}Clear(){const t=nr.WithProvider(this.RegionDimension.width,this.RegionDimension.height,(()=>0));for(let i=this.editableRegion.lt.y;i<=this.editableRegion.rb.y;++i)for(let e=this.editableRegion.lt.x;e<=this.editableRegion.rb.x;++e)t.Set({column:e-this.editableRegion.lt.x,row:i-this.editableRegion.lt.y},this.editorSourceCode.Read({x:e,y:i}));const e=this.editCellsRegionCommandFactory(this.editableRegion,t,nr.WithProvider(this.RegionDimension.width,this.RegionDimension.height,(()=>32)),this.editionDirection,this.regionStayLeftTopPostActionFactory());e.Apply(),t.Every((t=>32===t))||this.history.Push(e)}get IsSingleCell(){return this.editableRegion.lt.x===this.editableRegion.rb.x&&this.editableRegion.lt.y===this.editableRegion.rb.y}get RegionDimension(){return{width:this.editableRegion.rb.x-this.editableRegion.lt.x+1,height:this.editableRegion.rb.y-this.editableRegion.lt.y+1}}get Target(){return this.editableRegion}get EditionDirection(){return this.editionDirection}set EditionDirection(t){this.editionDirection=t}};pr=dr([(0,w.b)(),fr(0,(0,S.f)(Xn)),fr(1,(0,S.f)(Vt)),fr(2,(0,S.f)(_.EditCellCommandFactory)),fr(3,(0,S.f)(j.MoveNext)),fr(4,(0,S.f)(_.EditCellsRegionFactory)),fr(5,(0,S.f)(F.MoveNext)),fr(6,(0,S.f)(F.StayLeftTop)),fr(7,(0,S.f)(No)),ur("design:paramtypes",["function"===typeof(rr="undefined"!==typeof Xn&&Xn)?rr:Object,"function"===typeof(sr="undefined"!==typeof Vt&&Vt)?sr:Object,Object,"function"===typeof(lr="undefined"!==typeof or.e&&or.e.AutoFactory)?lr:Object,Object,"function"===typeof(hr="undefined"!==typeof or.e&&or.e.AutoFactory)?hr:Object,"function"===typeof(cr="undefined"!==typeof or.e&&or.e.AutoFactory)?cr:Object,"function"===typeof(ar="undefined"!==typeof No&&No)?ar:Object])],pr),U.bind(pr).toSelf().inSingletonScope();var gr,yr,br,vr,mr,xr,Cr,Rr=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},wr=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Sr=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["Left"]=0]="Left",t[t["Up"]=1]="Up",t[t["Right"]=2]="Right",t[t["Down"]=3]="Down"})(Cr||(Cr={}));class Pr{constructor(t){(0,x.Z)(this,"editableCell",void 0),this.editableCell=t}Touch(t){return this.editableCell.Select(t),this}}class Dr{constructor(t){(0,x.Z)(this,"editableCell",void 0),(0,x.Z)(this,"firstTouch",void 0),this.editableCell=t,this.firstTouch={...t.Target.lt}}Touch(t){return this.editableCell.SelectRegion(this.firstTouch,t),new Pr(this.editableCell)}}let Ar=class{constructor(t,e,i,o,n,r){(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"overlay",void 0),(0,x.Z)(this,"editableCell",void 0),(0,x.Z)(this,"codeEditorRenderer",void 0),(0,x.Z)(this,"editorSourceCode",void 0),(0,x.Z)(this,"tooltipService",void 0),(0,x.Z)(this,"editDirectionObservable",new ge),(0,x.Z)(this,"editableCellLostObservale",new ge),(0,x.Z)(this,"extension",new Kn),(0,x.Z)(this,"touchBehavior",void 0),this.gl=t,this.overlay=e,this.editableCell=i,this.codeEditorRenderer=o,this.editorSourceCode=n,this.tooltipService=r,this.touchBehavior=new Pr(this.editableCell),this.overlay.EditControls.SelectObservable.Attach((()=>this.OnSetEditableRegion())),this.overlay.EditControls.CutObservable.Attach((()=>this.OnCut())),this.overlay.EditControls.CopyObservable.Attach((()=>this.OnCopyEditableRegion())),this.overlay.EditControls.PasteObservable.Attach((()=>this.OnPaste())),this.overlay.EditControls.DeleteObservable.Attach((()=>this.OnDelete()))}get EditDirectionObservable(){return this.editDirectionObservable}get EditableCellLostObservable(){return this.editableCellLostObservale}get EditableCellDirection(){return this.editableCell.EditionDirection}set EditableCellDirection(t){this.editableCell.EditionDirection=t,this.editDirectionObservable.Notify(t)}LoadExtension(t){this.extension.Unload(),this.extension=t,this.extension.ViewProjection=this.codeEditorRenderer.ViewProjection}UnloadExtension(){this.extension.Unload(),this.extension=new Kn}EditCell(t,e,i){this.editorSourceCode.Write({x:e,y:i},t.charCodeAt(0)),this.codeEditorRenderer.Symbol(t,e,i)}Select(t,e,i){this.codeEditorRenderer.Select(t,e,i)}SelectRegion(t,e,i){this.codeEditorRenderer.SelectRegion(t,e,i)}Unselect(t,e){this.codeEditorRenderer.Unselect(t,e)}UnselectRegion(t,e){this.codeEditorRenderer.UnselectRegion(t,e)}Tooltip(t,e,i,o){return this.tooltipService.Tooltip(t,e,i,o)}HideAllTooltips(){this.tooltipService.ReleaseAll()}Touch(t){const e=Xt.Unproject({x:t.offsetX,y:t.offsetY,z:0},this.ViewProjection,this.gl.canvas),i=Xt.Unproject({x:t.offsetX,y:t.offsetY,z:1},this.ViewProjection,this.gl.canvas),o=Yt.PlaneLine({a:0,b:0,c:1,d:0},{a:[e[0],e[1],e[2]],b:[i[0],i[1],i[2]]}),n=Math.floor(o[0]/this.codeEditorRenderer.CellSize),r=this.codeEditorRenderer.Dimension.Rows-Math.floor(o[1]/this.codeEditorRenderer.CellSize)-1,s=this.touchBehavior.Touch({x:n,y:r});s!==this.touchBehavior&&(this.touchBehavior=s)}Focus(){this.editableCell.Focus()}Blur(){this.editableCell.Blur()}SetEditableCell(t){this.editableCell.Select(t),this.IsEditableCellVisible||this.editableCellLostObservale.Notify()}SetEditableRegion(t,e){this.editableCell.SelectRegion(t,e)}CellInput(t){this.editableCell.CellInput(t.key)}Clear(){this.codeEditorRenderer.Clear()}Draw(){this.codeEditorRenderer.Draw(),this.extension.Draw()}get Dimension(){return this.codeEditorRenderer.Dimension}get ViewProjection(){return this.codeEditorRenderer.ViewProjection}set ViewProjection(t){this.codeEditorRenderer.ViewProjection=t,this.extension.ViewProjection=t}get EditableCell(){return this.editableCell.Target.lt}get EditableCellRect(){const t=[this.EditableCell.x*this.codeEditorRenderer.CellSize,(this.codeEditorRenderer.Dimension.Rows-this.EditableCell.y-1)*this.codeEditorRenderer.CellSize,.02],e=[(this.EditableCell.x+1)*this.codeEditorRenderer.CellSize,(this.codeEditorRenderer.Dimension.Rows-this.EditableCell.y)*this.codeEditorRenderer.CellSize,.02];return{lb:t,rt:e}}get IsEditableCellVisible(){const t=[this.editableCell.Target.lt.x*this.codeEditorRenderer.CellSize,(this.codeEditorRenderer.Dimension.Rows-this.editableCell.Target.lt.y-1)*this.codeEditorRenderer.CellSize,.02],e=C.fF(C.Ue(),t,this.ViewProjection);if(e[0]<-1||e[1]<-1)return!1;const i=[(this.editableCell.Target.lt.x+1)*this.codeEditorRenderer.CellSize,(this.codeEditorRenderer.Dimension.Rows-this.editableCell.Target.lt.y)*this.codeEditorRenderer.CellSize,.02],o=C.fF(C.Ue(),i,this.ViewProjection);return!(o[0]>1||o[1]>1)}get CellSize(){return this.codeEditorRenderer.CellSize}OnSetEditableRegion(){this.touchBehavior=new Dr(this.editableCell)}OnCut(){navigator.clipboard.writeText(this.editableCell.ContentString()),this.editableCell.Clear()}OnCopyEditableRegion(){navigator.clipboard.writeText(this.editableCell.ContentString())}async OnPaste(){const t=await mi.Try(Di(navigator.clipboard,"readText")).CatchValue("");0!==t.length&&(this.editableCell.InsertSourceCode(t)||this.overlay.Snackbar.ShowWarning("Not enough space to insert the fragment"))}OnDelete(){this.editableCell.Clear()}};Ar=Rr([(0,w.b)(),Sr(0,(0,S.f)(L.WebGLRenderingContext)),Sr(1,(0,S.f)(Wn)),Sr(2,(0,S.f)(pr)),Sr(3,(0,S.f)(Vt)),Sr(4,(0,S.f)(Xn)),Sr(5,(0,S.f)(ir)),wr("design:paramtypes",["function"===typeof(gr="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?gr:Object,"function"===typeof(yr="undefined"!==typeof Wn&&Wn)?yr:Object,"function"===typeof(br="undefined"!==typeof pr&&pr)?br:Object,"function"===typeof(vr="undefined"!==typeof Vt&&Vt)?vr:Object,"function"===typeof(mr="undefined"!==typeof Xn&&Xn)?mr:Object,"function"===typeof(xr="undefined"!==typeof ir&&ir)?xr:Object])],Ar),U.bind(Ar).toSelf().inSingletonScope();class Or{constructor(t,e,i){(0,x.Z)(this,"memory",void 0),(0,x.Z)(this,"io",void 0),(0,x.Z)(this,"pcDirection",fe.Right),(0,x.Z)(this,"pcLocation",{x:0,y:0}),(0,x.Z)(this,"stack",[]),(0,x.Z)(this,"isStringMode",!1),(0,x.Z)(this,"isHalted",!1),(0,x.Z)(this,"instructionSet",Array.from({length:128})),this.memory=t,this.io=e,i.forEach((t=>this.instructionSet[t.Code.charCodeAt(0)]=t))}get Stack(){return this.stack}get PC(){return{Location:this.pcLocation,Direction:this.pcDirection}}get NextInstructionCode(){return String.fromCharCode(this.memory.Read(this.pcLocation))}StackPush(t){this.stack.push(t)}StackPop(){if(0===this.stack.length)return 0;{const t=this.stack[this.stack.length-1];return this.stack.pop(),t}}StackDuplicate(){this.stack.length>=1?this.stack.push(this.stack[this.stack.length-1]):this.stack.push(0,0)}StackSwap(){if(this.stack.length>=2){const t=this.stack[this.stack.length-1];this.stack[this.stack.length-1]=this.stack[this.stack.length-2],this.stack[this.stack.length-2]=t}else this.stack.push(...Array.from({length:2-this.stack.length},(()=>0)))}PCDirection(t){this.pcDirection=t}ExecuteNext(){const t=this.memory.Read(this.pcLocation);if(this.isStringMode&&t!=='"'.charCodeAt(0))this.stack.push(t);else{if(!this.KnownInstruction(t))throw new ue(this.pcLocation,t,String.fromCharCode(t));this.instructionSet[t].Execute(this)}this.SkipNext()}SkipNext(){this.pcLocation=this.memory.PointerArithmetics.Move(this.pcLocation,this.pcDirection)}StringModeToggle(){this.isStringMode=!this.isStringMode}ReadMemory(t){return this.memory.Read(t)}WriteMemory(t,e){this.memory.Write(t,e)}WriteIO(t){this.io.OutputWrite(t)}ReadCharacter(){return this.io.InputReadCharacter()}ReadNumber(){return this.io.InputReadNumber()}Halt(){this.isHalted=!0}get IsHalted(){return this.isHalted}KnownInstruction(t){return void 0!==this.instructionSet[t]}}class Tr{get Code(){return"+"}Execute(t){t.StackPush(t.StackPop()+t.StackPop())}}class Er{get Code(){return"#"}Execute(t){t.SkipNext()}}class Ir{get Code(){return"/"}Execute(t){const e=t.StackPop(),i=t.StackPop();t.StackPush(Math.trunc(i/e))}}class Br{get Code(){return"@"}Execute(t){t.Halt()}}class Lr{get Code(){return"`"}Execute(t){t.StackPush(+(t.StackPop()<t.StackPop()))}}class Zr{get Code(){return"_"}Execute(t){t.PCDirection(0===t.StackPop()?fe.Right:fe.Left)}}class _r{get Code(){return"~"}Execute(t){t.StackPush(t.ReadCharacter().charCodeAt(0))}}class jr{get Code(){return"&"}Execute(t){t.StackPush(t.ReadNumber())}}class Fr{get Code(){return"g"}Execute(t){const e=t.StackPop(),i=t.StackPop();t.StackPush(t.ReadMemory({x:i,y:e}))}}class kr{get Code(){return"p"}Execute(t){const e=t.StackPop(),i=t.StackPop(),o=t.StackPop();t.WriteMemory({x:i,y:e},o)}}class Ur{get Code(){return"%"}Execute(t){const e=t.StackPop(),i=t.StackPop();t.StackPush(i%e)}}class Mr{get Code(){return"*"}Execute(t){t.StackPush(t.StackPop()*t.StackPop())}}class Nr{get Code(){return"!"}Execute(t){t.StackPush(+(0===t.StackPop()))}}class zr{get Code(){return" "}Execute(t){}}class Gr{get Code(){return"v"}Execute(t){t.PCDirection(fe.Down)}}class Vr{get Code(){return"<"}Execute(t){t.PCDirection(fe.Left)}}class Hr{get Code(){return"?"}Execute(t){t.PCDirection(Math.floor(Math.random()*Object.keys(fe).length>>1))}}class Wr{get Code(){return">"}Execute(t){t.PCDirection(fe.Right)}}class Yr{get Code(){return"^"}Execute(t){t.PCDirection(fe.Up)}}class Xr{get Code(){return"$"}Execute(t){t.StackPop()}}class Kr{get Code(){return","}Execute(t){t.WriteIO(String.fromCharCode(t.StackPop()))}}class qr{get Code(){return"."}Execute(t){t.WriteIO(t.StackPop().toString()+" ")}}class $r{get Code(){return":"}Execute(t){t.StackDuplicate()}}class Qr{constructor(t){(0,x.Z)(this,"digit",void 0),this.digit=t}get Code(){return this.digit.toString()}Execute(t){t.StackPush(this.digit)}}class Jr{get Code(){return"\\"}Execute(t){t.StackSwap()}}class ts{get Code(){return"-"}Execute(t){const e=t.StackPop(),i=t.StackPop();t.StackPush(i-e)}}class es{get Code(){return'"'}Execute(t){t.StringModeToggle()}}class is{get Code(){return"|"}Execute(t){t.PCDirection(0===t.StackPop()?fe.Down:fe.Up)}}class os{constructor(){(0,x.Z)(this,"input",[]),(0,x.Z)(this,"output",[])}InputWrite(t){this.input.push(...t)}InputReadCharacter(){if(0===this.input.length)throw new Error("Failed to read from IO port");return this.input.shift()}InputReadNumber(){let t=this.input.findIndex((t=>" "!==t));["-","+"].includes(this.input[t])&&++t;let e=t;for(let i=this.input[e];e<this.input.length&&i>="0"&&i<="9";i=this.input[++e]);if(e===t)throw new Error("Failed to read number from IO port");return Number.parseInt(this.input.splice(0,e).join(""))}get HasInput(){return this.input.length>0}OutputWrite(t){this.output.push(...t)}OutputRead(){if(0===this.output.length)throw new Error("Failed to read from IO port");return this.output.shift()}get HasOutput(){return this.output.length>0}}class ns{constructor(t,e){(0,x.Z)(this,"origin",void 0),(0,x.Z)(this,"interceptor",void 0),this.origin=t,this.interceptor=e}get Code(){return this.origin.Code}Execute(t){const[e,i,o]=t.Stack.slice(-3);this.interceptor({x:i,y:o},e),this.origin.Execute(t)}}class rs{constructor(t,e){(0,x.Z)(this,"memoryLimit",void 0),(0,x.Z)(this,"memory",void 0),(0,x.Z)(this,"io",void 0),(0,x.Z)(this,"cpu",void 0),(0,x.Z)(this,"instructionsExecuted",0),(0,x.Z)(this,"memoryWriteInterceptors",[]),this.memoryLimit=t,this.memory=e,this.io=new os,this.cpu=new Or(this.memory,this.io,[new Tr,new ts,new Mr,new Ir,new Ur,new Nr,new Lr,new Wr,new Vr,new Gr,new Yr,new Hr,new Zr,new is,new es,new $r,new Jr,new Xr,new qr,new Kr,new Er,new ns(new kr,((t,e)=>this.OnMemoryWrite(t,e))),new Fr,new jr,new _r,new Br,new zr,...[0,1,2,3,4,5,6,7,8,9].map((t=>new Qr(t)))])}LoadExecutable(t){if(this.IsMemoryLimitDynamic){const e=rs.ExecutableMemoryLimit(t);(e.Width>this.memoryLimit.Width||e.Height>this.memoryLimit.Height)&&this.memory.Resize(e)}const e={x:0,y:0};for(const i of t)"\n"===i?(e.x=0,++e.y):(this.memory.Write(e,i.charCodeAt(0)),++e.x)}SetInput(t){this.io.InputWrite(t)}Run(){while(!this.cpu.IsHalted)this.cpu.ExecuteNext()}RunFor(t){const e=Date.now(),i=1e5;for(this.instructionsExecuted=0;!this.cpu.IsHalted&&(this.instructionsExecuted%i!==0||Date.now()-e<t);++this.instructionsExecuted)this.cpu.ExecuteNext();return this.IsHalted}RunNext(){this.cpu.ExecuteNext()}CollectOutput(){let t="";while(this.io.HasOutput)t+=this.io.OutputRead();return t}CollectOutputUntil(t){let e="";for(let i=0;this.io.HasOutput&&i<t;++i)e+=this.io.OutputRead();return e}AttachDebugger(t){t.AttachCPU(this.cpu)}AttachProfiler(t){t.AttachCPU(this.cpu)}AddMemoryWriteInterceptor(t){return this.memoryWriteInterceptors.push(t),()=>{const e=this.memoryWriteInterceptors.indexOf(t);-1!==e&&this.memoryWriteInterceptors.splice(e,1)}}OnMemoryWrite(t,e){this.memoryWriteInterceptors.forEach((i=>i(t,e)))}get NextInstruction(){return this.cpu.NextInstructionCode}get IsHalted(){return this.cpu.IsHalted}get InstructionsExecuted(){return this.instructionsExecuted}get IP(){return this.cpu.PC.Location}get IsMemoryLimitDynamic(){return this.memoryLimit.Width===Number.POSITIVE_INFINITY||this.memoryLimit.Height===Number.POSITIVE_INFINITY}static ExecutableMemoryLimit(t){let e=0,i=0,o=0;for(const n of t)"\n"===n?(e<o&&(e=o),o=0,++i):++o;return{Width:e,Height:i}}}var ss;(function(t){t[t["Less"]=0]="Less",t[t["LessEqual"]=1]="LessEqual",t[t["Greater"]=2]="Greater",t[t["GreaterEqual"]=3]="GreaterEqual",t[t["Equal"]=4]="Equal"})(ss||(ss={}));class ls{constructor(){(0,x.Z)(this,"target",null),(0,x.Z)(this,"pcLocationBrk",new Map),(0,x.Z)(this,"stackBrk",[]),(0,x.Z)(this,"noDebug",!1)}AttachCPU(t){this.target=t}get IsHalted(){return this.target?.IsHalted??!0}RunNext(){if(!this.target?.IsHalted){if(this.noDebug)this.noDebug=!1;else{const t=this.BreakpointsCheck();if(t.length>0)return this.noDebug=!0,t}this.target?.ExecuteNext()}return[]}RunFor(t){const e=Date.now(),i=1e5;let o=[];for(let n=0;!this.target?.IsHalted&&0===o.length&&(n%i!==0||Date.now()-e<t);++n)o=this.RunNext();return o.length>0?o:null}SetBreakpoint(t){if(t.PC){let e=this.pcLocationBrk.get(t.PC.Location.x);e||(e=new Map,e.set(t.PC.Location.y,[]),this.pcLocationBrk.set(t.PC.Location.x,e));let i=e.get(t.PC.Location.y);void 0===i&&(i=[],e.set(t.PC.Location.y,i)),i.push(t)}return t.Stack&&(t.Stack.Size||t.Stack.Value)&&this.stackBrk.push(t),()=>this.BreakpointReleaser(t)}get PCBreakpoints(){return[...this.pcLocationBrk.values()].flatMap((t=>[...t.values()])).flatMap((t=>[...t])).map((t=>t.PC))}get Stack(){return this.target?.Stack??[]}BreakpointReleaser(t){if(t.PC){const e=this.pcLocationBrk.get(t.PC.Location.x),i=e?.get(t.PC.Location.y);if(i)if(1===i.length)e?.delete(t.PC.Location.y);else{const e=i.indexOf(t);e>=0&&i.splice(e,1)}}if(t.Stack){const e=this.stackBrk.indexOf(t);e>=0&&this.stackBrk.splice(e,1)}}BreakpointsCheck(){return[...this.BreakpointCheckPC(),...this.BreakpointCheckStack()]}BreakpointCheckPC(){if(null===this.target)return[];const t=this.pcLocationBrk.get(this.target.PC.Location.x);if(!t)return[];const e=t.get(this.target.PC.Location.y);return e?.filter((t=>!!t&&(void 0===t.PC?.Direction||t.PC.Direction===this.target.PC.Direction)))??[]}BreakpointCheckStack(){return null===this.target?[]:this.stackBrk.filter((t=>{if(t.Stack?.Size?.Value!==this.target?.Stack.length)return!1;if(t.Stack?.Value){if(0===this.target?.Stack.length)return!1;const e=this.target.Stack[this.target.Stack.length-1];switch(t.Stack.Value.Condition){case ss.Equal:return t.Stack.Value.Value===e;case ss.Less:return t.Stack.Value.Value<e;case ss.LessEqual:return t.Stack.Value.Value<=e;case ss.Greater:return t.Stack.Value.Value>e;case ss.GreaterEqual:return t.Stack.Value.Value>=e}}return!0}))}}class hs{constructor(){(0,x.Z)(this,"stats",void 0);const t=q(fe);this.stats=nr.WithProvider(t,t,(()=>0))}Update(t,e){this.stats.Update(t,e)}get Total(){let t=0;return this.stats.ForEach((e=>t+=e)),t}get Normalized(){const t=this.Total;return this.stats.Map((e=>e/t)).RawRef}}class cs{constructor(t){(0,x.Z)(this,"memoryLimit",void 0),(0,x.Z)(this,"target",null),this.memoryLimit=t}AttachCPU(t){this.target=t}CellHeatmapFor(t){if(null===this.target)throw new Error("Attempting to gather heatmap without attached any cpu. Call AttachCPU first.");const e=Date.now(),i=1e5,o=nr.WithProvider(this.memoryLimit.Width,this.memoryLimit.Height,(()=>new hs));for(let n=0;!this.target.IsHalted&&(n%i!==0||Date.now()-e<t);++n){const t=o.Get({column:this.target.PC.Location.x,row:this.target.PC.Location.y}),e=this.target.PC.Direction;this.target.ExecuteNext();const i=this.target.PC.Direction;t.Update({column:e,row:i},(t=>t+1))}return this.target.IsHalted?o:null}}var as,ds=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},us=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},fs=function(t,e){return function(i,o){e(i,o,t)}};let ps=class{constructor(t){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"interpreter",void 0),(0,x.Z)(this,"debugger",void 0),(0,x.Z)(this,"profiler",void 0),this.settings=t}get Interpreter(){return this.interpreter}get Debugger(){return this.debugger}get Profiler(){return this.profiler}Reset(t,e){this.interpreter=new rs(t,e),this.debugger=new ls,this.interpreter.AttachDebugger(this.debugger),this.profiler=new cs(this.settings.MemoryLimit),this.interpreter.AttachProfiler(this.profiler)}};ps=ds([(0,w.b)(),fs(0,(0,S.f)(V)),us("design:paramtypes",["function"===typeof(as="undefined"!==typeof V&&V)?as:Object])],ps),U.bind(ps).toSelf().inSingletonScope();var gs,ys,bs,vs,ms,xs=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Cs=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Rs=function(t,e){return function(i,o){e(i,o,t)}};let ws=class{constructor(t,e,i,o,n){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"overlay",void 0),(0,x.Z)(this,"codeEditor",void 0),(0,x.Z)(this,"befungeToolbox",void 0),(0,x.Z)(this,"editorSourceCode",void 0),(0,x.Z)(this,"debugMode",!1),(0,x.Z)(this,"breakpoints",[]),(0,x.Z)(this,"activeCellBreakpoints",[]),(0,x.Z)(this,"activeBreakpointColor",[.8980392156862745,.2235294117647059,.20784313725490197]),(0,x.Z)(this,"inactiveBreakpointColor",[.9764705882352941,.6588235294117647,.1450980392156863]),this.settings=t,this.overlay=e,this.codeEditor=i,this.befungeToolbox=o,this.editorSourceCode=n,this.overlay.DebugControls.Debug.Attach((t=>this.DebugCodeAction(t))),this.overlay.DebugControls.CellBreakopint.Attach((t=>this.OnCellBreakpointAction(t))),this.overlay.DebugControls.CellBreakpointDelete.Attach((()=>this.OnCellBreakpointDelete()))}OnSelect(t){const e=this.breakpoints.some((t=>t.Location.x===this.codeEditor.EditableCell.x&&t.Location.y===this.codeEditor.EditableCell.y));this.overlay.DebugControls.DeactivateButton=e,t.x===this.codeEditor.EditableCell.x&&t.y===this.codeEditor.EditableCell.y||(this.activeCellBreakpoints.some((e=>e.Location.x===t.x&&e.Location.y===t.y))?this.codeEditor.Select(t.x,t.y,this.activeBreakpointColor):this.breakpoints.some((e=>e.Location.x===t.x&&e.Location.y===t.y))&&this.codeEditor.Select(t.x,t.y,this.inactiveBreakpointColor))}OnCellInput(t){this.breakpoints.some((e=>e.Location.x===t.x&&e.Location.y===t.y))&&this.codeEditor.Select(t.x,t.y,this.inactiveBreakpointColor)}RunNext(t){this.DebugMode||(this.befungeToolbox.Reset(this.settings.MemoryLimit,this.editorSourceCode.Clone()),this.befungeToolbox.Interpreter.SetInput(this.overlay.IOControls.Input),this.befungeToolbox.Interpreter.AddMemoryWriteInterceptor(((t,e)=>this.OnMemoryWrite(t,e))),this.UploadBreakpointsToDebugger(),this.DebugMode=!0,this.overlay.DebugControls.DebugMode=!0,this.overlay.IOControls.Output="");const e=this.befungeToolbox.Debugger,i=this.befungeToolbox.Interpreter;let o;this.activeCellBreakpoints.forEach((t=>this.codeEditor.Unselect(t.Location.x,t.Location.y)));try{if(t===po.RunNextBreakpoint)o=e.RunFor(this.settings.ExecutionTimeout);else{if(t!==po.RunNextInstruction)throw new Error("Unexpected debug action");o=e.RunNext(),o.length>0&&(o=e.RunNext())}}catch(r){return r instanceof Error&&this.overlay.Snackbar.ShowError(r.message),void this.Interrupt()}let n=[];if(null===o?(e.IsHalted||(this.overlay.Snackbar.ShowWarning("Terminated due timeout"),this.overlay.StackControls.Stack=[]),this.DebugMode=!1,this.overlay.DebugControls.DebugMode=!1,this.activeCellBreakpoints=[],this.codeEditor.HideAllTooltips()):n=o,t===po.RunNextBreakpoint&&n.length>0){this.RestoreCellBreakpointsSelection(),this.activeCellBreakpoints=[];for(const t of n)t.PC&&(this.activeCellBreakpoints.push(t.PC),this.codeEditor.Select(t.PC.Location.x,t.PC.Location.y,this.activeBreakpointColor));this.overlay.StackControls.Stack=e.Stack,this.overlay.StackControls.ScrollToTop(),this.overlay.IOControls.Output+=i.CollectOutputUntil(this.settings.MaxOutputLength)}else this.RestoreCellBreakpointsSelection(),this.activeCellBreakpoints=[{Location:{x:i.IP.x,y:i.IP.y}}],this.codeEditor.Select(i.IP.x,i.IP.y,this.activeBreakpointColor),this.overlay.StackControls.Stack=e.Stack,this.overlay.StackControls.ScrollToTop(),this.overlay.IOControls.Output+=i.CollectOutputUntil(this.settings.MaxOutputLength);e.IsHalted&&(this.DebugMode=!1,this.overlay.DebugControls.DebugMode=!1,this.activeCellBreakpoints.forEach((t=>this.codeEditor.Unselect(t.Location.x,t.Location.y))),this.activeCellBreakpoints=[],this.overlay.IOControls.Output+=i.CollectOutputUntil(this.settings.MaxOutputLength),this.RestoreCellBreakpointsSelection(),this.codeEditor.HideAllTooltips(),this.overlay.Snackbar.ShowSuccess("Completed"),this.overlay.StackControls.Stack=[])}Interrupt(){this.DebugMode=!1,this.overlay.DebugControls.DebugMode=!1,this.activeCellBreakpoints.forEach((t=>this.codeEditor.Unselect(t.Location.x,t.Location.y))),this.activeCellBreakpoints=[],this.RestoreCellBreakpointsSelection(),this.codeEditor.HideAllTooltips(),this.overlay.StackControls.Stack=[]}get DebugMode(){return this.debugMode}set DebugMode(t){this.debugMode=t,this.overlay.StackControls.Visible=t,this.overlay.EditControls.Disable=t}DebugCodeAction(t){t!==po.RunNextBreakpoint||0!==this.breakpoints.length||this.debugMode?t===po.Interrupt?this.Interrupt():this.RunNext(t):this.RunNext(po.RunNextInstruction)}UploadBreakpointsToDebugger(){this.breakpoints.forEach((t=>{t.releaser=this.SetCellBreakpoint(t)}))}SetCellBreakpoint(t){const e=this.befungeToolbox.Debugger.SetBreakpoint({PC:t});return this.codeEditor.Select(t.Location.x,t.Location.y,this.inactiveBreakpointColor),()=>{e(),this.codeEditor.Unselect(t.Location.x,t.Location.y)}}OnCellBreakpointAction(t){const e=this.breakpoints.findIndex((t=>t.Location.x===this.codeEditor.EditableCell.x&&t.Location.y===this.codeEditor.EditableCell.y)),i={Location:{...this.codeEditor.EditableCell},...t};if(-1===e){const t=this.DebugMode?this.SetCellBreakpoint(i):null;this.breakpoints.push({...i,releaser:t}),this.codeEditor.Select(i.Location.x,i.Location.y,this.inactiveBreakpointColor),this.overlay.DebugControls.DeactivateButton=!0}else{const t=this.DebugMode?this.SetCellBreakpoint(i):null;this.breakpoints[e]={...i,releaser:t}}}OnCellBreakpointDelete(){const t=this.breakpoints.findIndex((t=>t.Location.x===this.codeEditor.EditableCell.x&&t.Location.y===this.codeEditor.EditableCell.y));if(-1!==t){const e=this.breakpoints[t];null!==e.releaser&&e.releaser(),this.breakpoints.splice(t,1),this.codeEditor.Select(e.Location.x,e.Location.y,[.21568627450980393,.2784313725490196,.30980392156862746]),this.overlay.DebugControls.DeactivateButton=!1}}RestoreCellBreakpointsSelection(){for(const t of this.befungeToolbox.Debugger.PCBreakpoints)this.codeEditor.Select(t.Location.x,t.Location.y,this.inactiveBreakpointColor)}OnMemoryWrite(t,e){this.codeEditor.Tooltip(t.x,t.y,`${e.toString()}(${String.fromCharCode(e)})`,Qn.RightTop)}};ws=xs([(0,w.b)(),Rs(0,(0,S.f)(V)),Rs(1,(0,S.f)(Wn)),Rs(2,(0,S.f)(Ar)),Rs(3,(0,S.f)(ps)),Rs(4,(0,S.f)(Xn)),Cs("design:paramtypes",["function"===typeof(gs="undefined"!==typeof V&&V)?gs:Object,"function"===typeof(ys="undefined"!==typeof Wn&&Wn)?ys:Object,"function"===typeof(bs="undefined"!==typeof Ar&&Ar)?bs:Object,"function"===typeof(vs="undefined"!==typeof ps&&ps)?vs:Object,"function"===typeof(ms="undefined"!==typeof Xn&&Xn)?ms:Object])],ws),U.bind(ws).toSelf().inSingletonScope();var Ss,Ps,Ds,As,Os=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ts=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Es=function(t,e){return function(i,o){e(i,o,t)}};let Is=class{constructor(t,e,i,o){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"overlay",void 0),(0,x.Z)(this,"befungeToolbox",void 0),(0,x.Z)(this,"editorSourceCode",void 0),this.settings=t,this.overlay=e,this.befungeToolbox=i,this.editorSourceCode=o,this.overlay.DebugControls.Execute.Attach((()=>this.Execute()))}Execute(){this.befungeToolbox.Reset(this.settings.MemoryLimit,this.editorSourceCode.Clone()),this.befungeToolbox.Interpreter.SetInput(this.overlay.IOControls.Input);try{this.befungeToolbox.Interpreter.RunFor(this.settings.ExecutionTimeout)?this.overlay.Snackbar.ShowSuccess(`Ok\nInstructions executed: ${this.befungeToolbox.Interpreter.InstructionsExecuted}`):this.overlay.Snackbar.ShowWarning("Terminated due timeout"),this.overlay.IOControls.Output=this.befungeToolbox.Interpreter.CollectOutputUntil(this.settings.MaxOutputLength)}catch(t){t instanceof Error&&this.overlay.Snackbar.ShowError(t.message)}}};Is=Os([(0,w.b)(),Es(0,(0,S.f)(V)),Es(1,(0,S.f)(Wn)),Es(2,(0,S.f)(ps)),Es(3,(0,S.f)(Xn)),Ts("design:paramtypes",["function"===typeof(Ss="undefined"!==typeof V&&V)?Ss:Object,"function"===typeof(Ps="undefined"!==typeof Wn&&Wn)?Ps:Object,"function"===typeof(Ds="undefined"!==typeof ps&&ps)?Ds:Object,"function"===typeof(As="undefined"!==typeof Xn&&Xn)?As:Object])],Is),U.bind(Is).toSelf().inSingletonScope();var Bs,Ls,Zs,_s="#version 300 es\nprecision highp float;\nprecision highp int;\n\nconst float PI = 3.1415926535897932384626433832795f;\nconst float circleRadius = 0.03f;\nconst float sector = 1.f / 3.f;\nconst float subsector = 1.f / 9.f;\n\nconst float lowSpeed = 1.f / 5.f;\nconst float mediumSpeed = 1.f / 2.f;\nconst float highSpeed = 1.f;\nconst float speed[4] = float[](0.f, lowSpeed, mediumSpeed, highSpeed);\n\nin vec2 v_uvCoord;\nin vec4 v_color;\n/*\n* Each 2 bits describe frequency of hits flow in an direction.\n* RR, DR, LR, UR,\n* RD, DD, LD, UD,\n* RL, DL, LL, UL,\n* RU, DU, LU, UU\n*/\nflat in uint v_hitsFlow;\n\nuniform float u_time;\n\nout vec4 out_color;\n\nvoid main() {\n    if(v_color.a == 0.0f) {\n        discard;\n    }\n\n    float columnWidth = 1.f / 32.f;\n    uint bitIdx = uint(floor(v_uvCoord.x / columnWidth));\n    float bit = float(v_hitsFlow >> bitIdx & uint(1));\n    out_color = vec4(bit, 0, 0, 0.9f);\n\n    uint rightRight = v_hitsFlow & uint(3);\n    uint downRight = v_hitsFlow >> 2 & uint(3);\n    uint leftRight = v_hitsFlow >> 4 & uint(3);\n    uint upRight = v_hitsFlow >> 6 & uint(3);\n    uint rightDown = v_hitsFlow >> 8 & uint(3);\n    uint downDown = v_hitsFlow >> 10 & uint(3);\n    uint leftDown = v_hitsFlow >> 12 & uint(3);\n    uint upDown = v_hitsFlow >> 14 & uint(3);\n    uint rightLeft = v_hitsFlow >> 16 & uint(3);\n    uint downLeft = v_hitsFlow >> 18 & uint(3);\n    uint leftLeft = v_hitsFlow >> 20 & uint(3);\n    uint upLeft = v_hitsFlow >> 22 & uint(3);\n    uint rightUp = v_hitsFlow >> 24 & uint(3);\n    uint downUp = v_hitsFlow >> 26 & uint(3);\n    uint leftUp = v_hitsFlow >> 28 & uint(3);\n    uint upUp = v_hitsFlow >> 30 & uint(3);\n\n    out_color = v_color;\n\n    if(rightRight > uint(0)) {\n        float x = fract(u_time * speed[rightRight] / sector);\n        float y = 1.5f * sector;\n\n        if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n            out_color = vec4(1, 1, 1, v_color.a);\n            return;\n        }\n    }\n\n    if(downRight > uint(0)) {\n        {\n            float x = 1.5f * sector;\n            float y = mod(1.0f - fract(u_time * speed[downRight]), sector) + 2.0f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = mod(u_time * speed[downRight] * 0.5f * PI / sector, 0.5f * PI) + PI;\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += 2.f * sector;\n            y += 2.f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = mod(fract(u_time * speed[downRight]), sector) + 2.0f * sector;\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(leftRight > uint(0)) {\n        float x = fract(u_time * speed[leftRight] / sector);\n        float y = 1.5f * sector;\n\n        if(x < 1.5f * sector) {\n            if(distance(vec2(1.f - x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        } else {\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(upRight > uint(0)) {\n        {\n            float x = 1.5f * sector;\n            float y = mod(fract(u_time * speed[upRight]), sector);\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = 0.5f * PI - mod(u_time * speed[upRight] * 0.5f * PI / sector, 0.5f * PI) + 0.5f * PI;\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += 2.f * sector;\n            y += sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = mod(fract(u_time * speed[upRight]), sector) + 2.0f * sector;\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(rightDown > uint(0)) {\n        {\n            float x = mod(fract(u_time * speed[rightDown]), sector);\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = 0.5f * PI - mod(u_time * speed[rightDown] * 0.5f * PI / sector, 0.5f * PI);\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += sector;\n            y += sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = 1.5f * sector;\n            float y = mod(1.0f - fract(u_time * speed[rightDown]), sector);\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(downDown > uint(0)) {\n        float x = 1.5f * sector;\n        float y = fract(1.f - u_time * speed[downDown] / sector);\n\n        if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n            out_color = vec4(1, 1, 1, v_color.a);\n            return;\n        }\n    }\n\n    if(leftDown > uint(0)) {\n        {\n            float x = mod(1.f - fract(u_time * speed[leftDown]), sector) + 2.0f * sector;\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = mod(u_time * speed[leftDown] * 0.5f * PI / sector, 0.5f * PI) + 0.5f * PI;\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += 2.f * sector;\n            y += sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = 1.5f * sector;\n            float y = mod(1.0f - fract(u_time * speed[leftDown]), sector);\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(upDown > uint(0)) {\n        float x = 1.5f * sector;\n        float y = fract(u_time * speed[upDown] / sector);\n\n        if(y < 1.5f * sector) {\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        } else {\n            if(distance(vec2(x, 1.f - y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(rightLeft > uint(0)) {\n        float x = fract(u_time * speed[rightLeft] / sector);\n        float y = 1.5f * sector;\n\n        if(x < 1.5f * sector) {\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        } else {\n            if(distance(vec2(1.5f * sector - (x - 1.5f * sector), y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(downLeft > uint(0)) {\n        {\n            float x = 1.5f * sector;\n            float y = mod(1.0f - fract(u_time * speed[downLeft]), sector) + 2.0f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = 0.5f * PI - mod(u_time * speed[downLeft] * 0.5f * PI / sector, 0.5f * PI) + 1.5f * PI;\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += sector;\n            y += 2.f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = mod(1.f - fract(u_time * speed[downLeft]), sector);\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(leftLeft > uint(0)) {\n        float x = 1.f - fract(u_time * speed[leftLeft] / sector);\n        float y = 1.5f * sector;\n\n        if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n            out_color = vec4(1, 1, 1, v_color.a);\n            return;\n        }\n    }\n\n    if(upLeft > uint(0)) {\n        {\n            float x = 1.5f * sector;\n            float y = mod(fract(u_time * speed[upLeft]), sector);\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = mod(u_time * speed[upLeft] * 0.5f * PI / sector, 0.5f * PI);\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += sector;\n            y += sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = mod(1.f - fract(u_time * speed[upLeft]), sector);\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(rightUp > uint(0)) {\n        {\n            float x = 1.5f * sector;\n            float y = mod(fract(u_time * speed[rightUp]), sector) + 2.0f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = mod(u_time * speed[rightUp] * 0.5f * PI / sector, 0.5f * PI) + 1.5f * PI;\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += sector;\n            y += 2.f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = mod(fract(u_time * speed[rightUp]), sector);\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(downUp > uint(0)) {\n        float x = 1.5f * sector;\n        float y = fract(u_time * speed[downUp] / sector);\n\n        if(y < 1.5f * sector) {\n            if(distance(vec2(x, 1.f - y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        } else {\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(leftUp > uint(0)) {\n        {\n            float x = 1.5f * sector;\n            float y = mod(fract(u_time * speed[leftUp]), sector) + 2.0f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float t = 0.5f * PI - mod(u_time * speed[leftUp] * 0.5f * PI / sector, 0.5f * PI) + PI;\n            float x = cos(t) * sector / 2.f;\n            float y = sin(t) * sector / 2.f;\n\n            x += 2.f * sector;\n            y += 2.f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n        {\n            float x = mod(1.0f - fract(u_time * speed[leftUp]), sector) + 2.0f * sector;\n            float y = 1.5f * sector;\n\n            if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n                out_color = vec4(1, 1, 1, v_color.a);\n                return;\n            }\n        }\n    }\n\n    if(upUp > uint(0)) {\n        float x = 1.5f * sector;\n        float y = fract(u_time * speed[upUp] / sector);\n\n        if(distance(vec2(x, y), v_uvCoord) <= circleRadius) {\n            out_color = vec4(1, 1, 1, v_color.a);\n            return;\n        }\n    }\n}\n",js="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec2 a_vertex;\nin vec2 a_uvCoord;\nin vec4 a_color;\nin uint a_hitsFlow;\n\nout vec2 v_uvCoord;\nout vec4 v_color;\nflat out uint v_hitsFlow;\n\nuniform mat4 u_viewProject;\n\nvoid main() {\n  gl_Position = u_viewProject * vec4(a_vertex, 0.1f, 1.0f);\n\n  v_uvCoord = a_uvCoord;\n  v_color = a_color;\n  v_hitsFlow = a_hitsFlow;\n}\n",Fs=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ks=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Us=function(t,e){return function(i,o){e(i,o,t)}};(function(t){t[t["X"]=0]="X",t[t["Y"]=1]="Y",t[t["Fx"]=2]="Fx",t[t["Fy"]=3]="Fy",t[t["R"]=4]="R",t[t["G"]=5]="G",t[t["B"]=6]="B"})(Zs||(Zs={}));class Ms extends at{constructor(t,e){const i=rt.Resolve(t.FLOAT),o=i*q(Zs)+4;super(t,{fragment:_s,vertex:js},[{name:"a_vertex",size:2,type:t.FLOAT,normalized:!1,stride:o,offset:0},{name:"a_uvCoord",size:2,type:t.FLOAT,normalized:!1,stride:o,offset:2*i},{name:"a_color",size:4,type:t.FLOAT,normalized:!1,stride:o,offset:4*i},{name:"a_hitsFlow",size:1,type:t.UNSIGNED_INT,stride:o,offset:8*i}],{indicesPerPrimitive:6,basePrimitiveType:t.TRIANGLES}),(0,x.Z)(this,"startTime",Date.now()/1e3),this.UploadAttributes(e)}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}Draw(){this.shader.SetUniform1f("u_time",Date.now()/1e3-this.startTime),super.Draw()}}let Ns=class{constructor(t,e){(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"CellSize",10),this.gl=t,this.settings=e}Build(t){const e=[];for(let i=0;i<this.settings.MemoryLimit.Height;++i)for(let o=0;o<this.settings.MemoryLimit.Width;++o){const n=t.Get({column:o,row:this.settings.MemoryLimit.Height-i-1}),r=this.BuildCell({x:o*this.CellSize,y:i*this.CellSize},{A:{x:0,y:0},B:{x:1,y:1}},n.color,n.hitsFlow);e.push(...r)}return new Ms(this.gl,e)}BuildCell(t,e,i,o){return et.AABBRectangle(t,{width:this.CellSize,height:this.CellSize},[{LeftBottom:[e.A.x,e.A.y],LeftTop:[e.A.x,e.B.y],RightTop:[e.B.x,e.B.y],RightBottom:[e.B.x,e.A.y]},i,[o]])}};Ns=Fs([(0,w.b)(),Us(0,(0,S.f)(L.WebGLRenderingContext)),Us(1,(0,S.f)(V)),ks("design:paramtypes",["function"===typeof(Bs="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Bs:Object,"function"===typeof(Ls="undefined"!==typeof V&&V)?Ls:Object])],Ns),U.bind(Ns).toSelf().inRequestScope(),U.bind(L.HeatmapGridRendererFactory).toFactory((t=>e=>t.container.get(Ns).Build(e)));var zs,Gs,Vs,Hs=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ws=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Ys=function(t,e){return function(i,o){e(i,o,t)}};class Xs{constructor(t,e){(0,x.Z)(this,"heatmapGridRenderer",void 0),(0,x.Z)(this,"tooltipReleasers",void 0),this.heatmapGridRenderer=t,this.tooltipReleasers=e}Draw(){this.heatmapGridRenderer.Draw()}Unload(){this.heatmapGridRenderer.Dispose(),this.tooltipReleasers.forEach((t=>t()))}set ViewProjection(t){this.heatmapGridRenderer.ViewProjection=t}}let Ks=class{constructor(t,e,i){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"codeEditor",void 0),(0,x.Z)(this,"heatmapGridRendererFactory",void 0),(0,x.Z)(this,"lowHitsColor",[0,.5568627450980392,1]),(0,x.Z)(this,"highHitsColor",[1,0,0]),(0,x.Z)(this,"hitsColorsDiff",void 0),(0,x.Z)(this,"maxHits",Number.NEGATIVE_INFINITY),(0,x.Z)(this,"heatmap",void 0),this.settings=t,this.codeEditor=e,this.heatmapGridRendererFactory=i}Build(t){this.heatmap=t,this.Setup();const e=this.DrawHitsOnCell(),i=this.heatmap.Map((t=>({color:this.HitsToColor(t.Total),hitsFlow:this.PackHitsFlow(t.Normalized)}))),o=this.heatmapGridRendererFactory(i);return new Xs(o,e)}HitsToColor(t){if(0===t)return[1,1,1,0];const e=t/this.maxHits;return[this.lowHitsColor[0]+this.hitsColorsDiff[0]*e,this.lowHitsColor[1]+this.hitsColorsDiff[1]*e,this.lowHitsColor[2]+this.hitsColorsDiff[2]*e,.8]}PackHitsFlow(t){return t.reduce(((t,e,i)=>e>=.66?t|3<<2*i:e>=.33?t|2<<2*i:e>0?t|1<<2*i:t),0)}Setup(){this.heatmap.ForEach((t=>this.maxHits=Math.max(this.maxHits,t.Total))),this.hitsColorsDiff=[this.highHitsColor[0]-this.lowHitsColor[0],this.highHitsColor[1]-this.lowHitsColor[1],this.highHitsColor[2]-this.lowHitsColor[2]]}DrawHitsOnCell(){const t=[];for(let e=0;e<this.settings.MemoryLimit.Height;++e)for(let i=0;i<this.settings.MemoryLimit.Width;++i){const o=this.heatmap.Get({column:i,row:e});if(o.Total>0){const n=this.codeEditor.Tooltip(i,e,o.Total.toString(),Qn.LeftBottom);t.push(n)}}return t}};Ks=Hs([(0,w.b)(),Ys(0,(0,S.f)(V)),Ys(1,(0,S.f)(Ar)),Ys(2,(0,S.f)(L.HeatmapGridRendererFactory)),Ws("design:paramtypes",["function"===typeof(zs="undefined"!==typeof V&&V)?zs:Object,"function"===typeof(Gs="undefined"!==typeof Ar&&Ar)?Gs:Object,"function"===typeof(Vs="undefined"!==typeof s.HeatMapGridFactory&&s.HeatMapGridFactory)?Vs:Object])],Ks),U.bind(Ks).toSelf().inTransientScope(),U.bind(L.HeatmapExtensionFactory).toFactory((t=>e=>t.container.get(Ks).Build(e)));var qs,$s,Qs,Js,tl,el,il=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ol=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},nl=function(t,e){return function(i,o){e(i,o,t)}};let rl=class{constructor(t,e,i,o,n,r){(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"editorSourceCode",void 0),(0,x.Z)(this,"befungeToolbox",void 0),(0,x.Z)(this,"codeEditor",void 0),(0,x.Z)(this,"overlay",void 0),(0,x.Z)(this,"heatmapExtensionFactory",void 0),this.settings=t,this.editorSourceCode=e,this.befungeToolbox=i,this.codeEditor=o,this.overlay=n,this.heatmapExtensionFactory=r,this.overlay.DebugControls.Heatmap.Attach((t=>this.ToggleHeatmap(t)),{priority:pe.High})}ToggleHeatmap(t){t.isShown?this.BuildHeatmap(t):this.HideHeatmap()}BuildHeatmap(t){this.befungeToolbox.Reset(this.settings.MemoryLimit,this.editorSourceCode.Clone()),this.befungeToolbox.Interpreter.SetInput(this.overlay.IOControls.Input);try{const e=this.befungeToolbox.Profiler.CellHeatmapFor(1e3);if(null===e)this.overlay.Snackbar.ShowWarning("Terminated due timeout"),t.isShown=!1;else{const t=this.heatmapExtensionFactory(e);this.codeEditor.LoadExtension(t)}}catch(e){e instanceof Error&&this.overlay.Snackbar.ShowError(e.message),t.isShown=!1}}HideHeatmap(){this.codeEditor.UnloadExtension()}};rl=il([(0,w.b)(),nl(0,(0,S.f)(V)),nl(1,(0,S.f)(Xn)),nl(2,(0,S.f)(ps)),nl(3,(0,S.f)(Ar)),nl(4,(0,S.f)(Wn)),nl(5,(0,S.f)(L.HeatmapExtensionFactory)),ol("design:paramtypes",["function"===typeof(qs="undefined"!==typeof V&&V)?qs:Object,"function"===typeof($s="undefined"!==typeof Xn&&Xn)?$s:Object,"function"===typeof(Qs="undefined"!==typeof ps&&ps)?Qs:Object,"function"===typeof(Js="undefined"!==typeof Ar&&Ar)?Js:Object,"function"===typeof(tl="undefined"!==typeof Wn&&Wn)?tl:Object,"function"===typeof(el="undefined"!==typeof l.HeatmapExtensionFactory&&l.HeatmapExtensionFactory)?el:Object])],rl),U.bind(rl).toSelf().inSingletonScope();var sl,ll,hl,cl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},al=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},dl=function(t,e){return function(i,o){e(i,o,t)}};let ul=class{constructor(t,e,i){(0,x.Z)(this,"executionService",void 0),(0,x.Z)(this,"debuggingService",void 0),(0,x.Z)(this,"profillingService",void 0),this.executionService=t,this.debuggingService=e,this.profillingService=i}get Execution(){return this.executionService}get Debugging(){return this.debuggingService}get Profilling(){return this.profillingService}};ul=cl([(0,w.b)(),dl(0,(0,S.f)(Is)),dl(1,(0,S.f)(ws)),dl(2,(0,S.f)(rl)),al("design:paramtypes",["function"===typeof(sl="undefined"!==typeof Is&&Is)?sl:Object,"function"===typeof(ll="undefined"!==typeof ws&&ws)?ll:Object,"function"===typeof(hl="undefined"!==typeof rl&&rl)?hl:Object])],ul),U.bind(ul).toSelf().inSingletonScope();var fl,pl,gl,yl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},bl=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},vl=function(t,e){return function(i,o){e(i,o,t)}};let ml=class{constructor(t,e,i){(0,x.Z)(this,"codeEditor",void 0),(0,x.Z)(this,"overlay",void 0),(0,x.Z)(this,"codeExecutionService",void 0),(0,x.Z)(this,"onVanish",new ge),this.codeEditor=t,this.overlay=e,this.codeExecutionService=i}OnInput(t){const e=t.key.charCodeAt(0);if(1===t.key.length&&e>=" ".charCodeAt(0)&&e<="~".charCodeAt(0)||"Backspace"===t.key)if(this.overlay.DebugControls.DebugMode)this.overlay.Snackbar.ShowInformation("Editing is disabled during the debugging");else if(this.overlay.DebugControls.IsHeatmapShown)this.overlay.Snackbar.ShowInformation("Editing is disabled while heatmap is active");else{const e={...this.codeEditor.EditableCell};this.codeEditor.CellInput(t),this.codeExecutionService.Debugging.OnCellInput(e)}}Focus(){this.codeEditor.Focus()}Blur(){this.codeEditor.Blur()}get OnVanish(){return this.onVanish}};ml=yl([(0,w.b)(),vl(0,(0,S.f)(Ar)),vl(1,(0,S.f)(Wn)),vl(2,(0,S.f)(ul)),bl("design:paramtypes",["function"===typeof(fl="undefined"!==typeof Ar&&Ar)?fl:Object,"function"===typeof(pl="undefined"!==typeof Wn&&Wn)?pl:Object,"function"===typeof(gl="undefined"!==typeof ul&&ul)?gl:Object])],ml),U.bind(ml).toSelf().inRequestScope(),U.bind(L.CodeEditorServiceInputReceiverFactory).toFactory((t=>()=>t.container.get(ml)));var xl="#version 300 es\nprecision mediump float;\n\nout vec4 out_color;\n\n\nvoid main() \n{\n      out_color = vec4(0, 0.5686274509803921, 0.9176470588235294, 1);\n}\n",Cl="#version 300 es\nprecision mediump float;\n\nin vec4 a_vertex;\n\nuniform mat4 u_viewProject;\n\nvoid main() \n{\n  gl_Position = u_viewProject * a_vertex;\n  gl_PointSize = 10.0;\n}\n";class Rl extends at{constructor(t){const e=rt.Resolve(t.FLOAT);super(t,{vertex:Cl,fragment:xl},[{name:"a_vertex",size:3,type:t.FLOAT,normalized:!1,stride:3*e,offset:0}],{indicesPerPrimitive:3,basePrimitiveType:t.LINES})}set ViewProjection(t){this.shader.SetUniformMatrix4fv("u_viewProject",t)}}class wl{constructor(t,e,i){(0,x.Z)(this,"camera",void 0),(0,x.Z)(this,"destination",void 0),(0,x.Z)(this,"viewport",void 0),(0,x.Z)(this,"isDone",!1),(0,x.Z)(this,"progress",0),(0,x.Z)(this,"duration",400),this.camera=t,this.destination=e,this.viewport=i}get IsDone(){return this.isDone}Draw(t){let e=t/this.duration;this.progress+=e,this.progress>1&&(e-=this.progress-1);const i=R.dC(R.Ue(),this.destination,R.al(e,e)),o=Xt.UnprojectMovement({x:i[0],y:-i[1]},{a:0,b:0,c:1,d:0},this.camera.ViewProjection,this.viewport);this.camera.Translate({x:o.x,y:o.y}),this.progress>=1&&(this.isDone=!0)}}class Sl{constructor(t,e,i){(0,x.Z)(this,"direction",void 0),(0,x.Z)(this,"camera",void 0),(0,x.Z)(this,"boundary",void 0),(0,x.Z)(this,"progress",0),(0,x.Z)(this,"duration",100),(0,x.Z)(this,"distance",50),(0,x.Z)(this,"isDone",!1),this.direction=t,this.camera=e,this.boundary=i}get IsDone(){return this.isDone}Draw(t){const e=t/this.duration;this.progress+=e;const i=this.distance*e*("in"===this.direction?-1:1),o=this.camera.Position.z+i;o>=this.boundary.max||o<=this.boundary.min?this.isDone=!0:(this.camera.Translate({z:i}),this.progress>=1&&(this.isDone=!0))}}i(2801);class Pl extends Error{constructor(){super("Failed to decode shared url")}}class Dl{static Encode(t){return btoa(t)}static Decode(t){try{return atob(t)}catch(e){if(e instanceof DOMException)switch(e.name){case"InvalidCharacterError":throw new Pl}throw e}}}class Al{constructor(t){(0,x.Z)(this,"memoryLimit",void 0),this.memoryLimit=t}Move(t,e){switch(e){case fe.Right:return{x:(t.x+1)%this.memoryLimit.Width,y:t.y};case fe.Left:return{x:0===t.x?this.memoryLimit.Width-1:t.x-1,y:t.y};case fe.Down:return{x:t.x,y:(t.y+1)%this.memoryLimit.Height};case fe.Up:return{x:t.x,y:0===t.y?this.memoryLimit.Height-1:t.y-1}}}}class Ol{constructor(t){(0,x.Z)(this,"limit",void 0),(0,x.Z)(this,"pointerArithmetics",void 0),(0,x.Z)(this,"memory",void 0),this.limit=t,this.pointerArithmetics=new Al(t),this.memory=new Uint8Array(t.Width*t.Height);const e=" ".charCodeAt(0);for(let i=0;i<this.memory.length;++i)this.memory[i]=e}get PointerArithmetics(){return this.pointerArithmetics}Read(t){return this.IsPointerOutOfBound(t)?0:this.memory[this.PointerToIndex(t)]}Write(t,e){this.IsPointerOutOfBound(t)||(this.memory[this.PointerToIndex(t)]=e)}Resize(t){const e=new Ol(t);this.CopyMemoryTo(e),this.memory=e.memory,this.limit=t}Clone(){const t=new Ol(this.limit);return t.memory.set(this.memory),t}PointerToIndex(t){return t.y*this.limit.Width+t.x}IsPointerOutOfBound(t){return t.x>=this.limit.Width||t.y>=this.limit.Height}CopyMemoryTo(t){const e=Math.min(this.limit.Width,t.limit.Width),i=Math.min(this.limit.Height,t.limit.Height);for(let o=0;o<e;++o)for(let e=0;e<i;++e){const i={x:o,y:e};t.Write(i,this.Read(i))}}}i(7287);class Tl{constructor(t){(0,x.Z)(this,"sourceCode",void 0),(0,x.Z)(this,"sourceCodeLength",void 0),this.sourceCode=[...t].reverse(),this.sourceCodeLength=this.sourceCode.length}NextIllegalInstruction(){if(0===this.sourceCode.length)return null;const t=this.sourceCode.findLastIndex((t=>!Tl.validSymbols.includes(t.charCodeAt(0))));if(-1===t)return this.sourceCode=[],null;const e=this.sourceCode[t].charCodeAt(0);return this.sourceCode.length=t,{value:e,offset:this.sourceCodeLength-t+1}}static ValidSymbols(){const t=" ".charCodeAt(0),e="~".charCodeAt(0);return[10,13,...Array.from({length:e-t+1},((e,i)=>i+t))]}}(0,x.Z)(Tl,"validSymbols",Tl.ValidSymbols());class El extends Error{}i(7635);var Il,Bl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ll=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};(function(t){t[t["Add"]=0]="Add",t[t["Replace"]=1]="Replace",t[t["Skip"]=2]="Skip"})(Il||(Il={}));let Zl=class{constructor(){(0,x.Z)(this,"defaultPolicy",void 0),(0,x.Z)(this,"effects",[]),this.defaultPolicy={id:Symbol("Default policy id"),rule:Il.Add}}Register(t,e=this.defaultPolicy){const i=this.effects.findLast((t=>t.policy.id===e.id));void 0===i||i.policy.rule===Il.Add?this.effects.push({effect:t,policy:e}):i.policy.rule===Il.Replace&&(i.effect=t)}Draw(t){for(let e=0;e<this.effects.length;++e){const i=this.effects[e];i.effect.IsDone?this.effects.splice(e--,1):i.effect.Draw(t)}return this.effects.length>0}};function _l(t){return"object"===typeof t&&"OnInput"in t}Zl=Bl([(0,w.b)(),Ll("design:paramtypes",[])],Zl),U.bind(Zl).toSelf().inSingletonScope();var jl,Fl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},kl=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Ul=function(t,e){return function(i,o){e(i,o,t)}};let Ml=class{constructor(t){(0,x.Z)(this,"codeEditorService",void 0),(0,x.Z)(this,"location",{x:-1,y:-1}),(0,x.Z)(this,"oldValue",""),(0,x.Z)(this,"newValue",""),(0,x.Z)(this,"editDirection",Cr.Right),(0,x.Z)(this,"postAction",void 0),this.codeEditorService=t}Initialize(...t){[{...this.location},this.oldValue,this.newValue,this.editDirection,this.postAction]=t}Apply(){this.codeEditorService.EditCell(this.newValue,this.location.x,this.location.y),this.postAction.Apply(this)}Undo(){this.codeEditorService.EditCell(this.oldValue,this.location.x,this.location.y),this.codeEditorService.SetEditableCell(this.location),this.codeEditorService.EditableCellDirection=this.editDirection}get Location(){return this.location}get OldValue(){return this.oldValue}get NewValue(){return this.newValue}get EditDirection(){return this.editDirection}};Ml=Fl([(0,w.b)(),Ul(0,(0,S.f)(Ar)),kl("design:paramtypes",["function"===typeof(jl="undefined"!==typeof Ar&&Ar)?jl:Object])],Ml),U.bind(Ml).toSelf().inTransientScope(),U.bind(_.EditCellCommandFactory).toFactory((t=>(e,i,o,n,r)=>{const s=t.container.get(Ml);return s.Initialize(e,i,o,n,r),s}));var Nl,zl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Gl=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Vl=function(t,e){return function(i,o){e(i,o,t)}};let Hl=class{constructor(t){(0,x.Z)(this,"codeEditorService",void 0),this.codeEditorService=t}Apply(t){const e=this.FollowCodeFlowHelper(t);t.EditDirection!==e&&(this.codeEditorService.EditableCellDirection=e),this.codeEditorService.SetEditableCell(this.GetNextEditableCell(t,e))}GetNextEditableCell(t,e){const i={...t.Location};switch(e){case Cr.Left:i.x=0===t.Location.x?this.codeEditorService.Dimension.Columns-1:t.Location.x-1;break;case Cr.Up:i.y=0===t.Location.y?this.codeEditorService.Dimension.Rows-1:t.Location.y-1;break;case Cr.Right:i.x=t.Location.x===this.codeEditorService.Dimension.Columns-1?0:t.Location.x+1;break;case Cr.Down:i.y=t.Location.y===this.codeEditorService.Dimension.Rows-1?0:t.Location.y+1;break}return i}FollowCodeFlowHelper(t){return"<"===t.NewValue?Cr.Left:"^"===t.NewValue?Cr.Up:">"===t.NewValue?Cr.Right:"v"===t.NewValue?Cr.Down:t.EditDirection}};Hl=zl([(0,w.b)(),Vl(0,(0,S.f)(Ar)),Gl("design:paramtypes",["function"===typeof(Nl="undefined"!==typeof Ar&&Ar)?Nl:Object])],Hl),U.bind(Hl).toSelf().inTransientScope(),U.bind(j.MoveNext).toAutoFactory(Hl);var Wl,Yl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Xl=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Kl=function(t,e){return function(i,o){e(i,o,t)}};let ql=class{constructor(t){(0,x.Z)(this,"codeEditorService",void 0),(0,x.Z)(this,"region",{lt:{x:-1,y:-1},rb:{x:-1,y:-1}}),(0,x.Z)(this,"oldValue",void 0),(0,x.Z)(this,"newValue",void 0),(0,x.Z)(this,"editDirection",Cr.Right),(0,x.Z)(this,"postAction",void 0),this.codeEditorService=t}Initialize(...t){const e=D.Extremum([t[0].lt,t[0].rb]);this.region.lt=e.min,this.region.rb=e.max,[,this.oldValue,this.newValue,this.editDirection,this.postAction]=t}Apply(){this.newValue.ForEach(((t,e)=>this.codeEditorService.EditCell(String.fromCharCode(t),this.region.lt.x+e.column,this.region.lt.y+e.row))),this.postAction.Apply(this)}Undo(){this.oldValue.ForEach(((t,e)=>this.codeEditorService.EditCell(String.fromCharCode(t),this.region.lt.x+e.column,this.region.lt.y+e.row))),this.codeEditorService.SetEditableCell(this.region.lt),this.codeEditorService.EditableCellDirection=this.editDirection}get Region(){return this.region}get EditDirection(){return this.editDirection}};ql=Yl([(0,w.b)(),Kl(0,(0,S.f)(Ar)),Xl("design:paramtypes",["function"===typeof(Wl="undefined"!==typeof Ar&&Ar)?Wl:Object])],ql),U.bind(ql).toSelf().inTransientScope(),U.bind(_.EditCellsRegionFactory).toFactory((t=>(e,i,o,n,r)=>{const s=t.container.get(ql);return s.Initialize(e,i,o,n,r),s}));var $l,Ql=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Jl=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},th=function(t,e){return function(i,o){e(i,o,t)}};let eh=class{constructor(t){(0,x.Z)(this,"codeEditorService",void 0),this.codeEditorService=t}Apply(t){this.codeEditorService.SetEditableCell(this.GetNextEditableCell(t))}GetNextEditableCell(t){switch(t.EditDirection){case Cr.Left:{const e=0===t.Region.lt.x?this.codeEditorService.Dimension.Columns-1:t.Region.lt.x-1;return{x:e,y:t.Region.lt.y}}case Cr.Up:{const e=0===t.Region.lt.y?this.codeEditorService.Dimension.Rows-1:t.Region.lt.y-1;return{x:t.Region.lt.x,y:e}}case Cr.Right:{const e=t.Region.rb.x===this.codeEditorService.Dimension.Columns-1?0:t.Region.rb.x+1;return{x:e,y:t.Region.rb.y}}case Cr.Down:{const e=t.Region.rb.y===this.codeEditorService.Dimension.Rows-1?0:t.Region.rb.y+1;return{x:t.Region.rb.x,y:e}}}}};eh=Ql([(0,w.b)(),th(0,(0,S.f)(Ar)),Jl("design:paramtypes",["function"===typeof($l="undefined"!==typeof Ar&&Ar)?$l:Object])],eh),U.bind(eh).toSelf().inTransientScope(),U.bind(F.MoveNext).toAutoFactory(eh);var ih,oh=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},nh=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},rh=function(t,e){return function(i,o){e(i,o,t)}};let sh=class{constructor(t){(0,x.Z)(this,"codeEditorService",void 0),this.codeEditorService=t}Apply(t){this.codeEditorService.SetEditableCell(t.Region.lt)}};sh=oh([(0,w.b)(),rh(0,(0,S.f)(Ar)),nh("design:paramtypes",["function"===typeof(ih="undefined"!==typeof Ar&&Ar)?ih:Object])],sh),U.bind(sh).toSelf().inTransientScope(),U.bind(F.StayLeftTop).toAutoFactory(sh);var lh,hh,ch,ah,dh,uh,fh,ph,gh,yh,bh,vh,mh=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},xh=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Ch=function(t,e){return function(i,o){e(i,o,t)}};let Rh=class extends B{constructor(t,e,i,o,n,r,s,l,h,c,a,d){super(),(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"fileStorage",void 0),(0,x.Z)(this,"camera",void 0),(0,x.Z)(this,"settings",void 0),(0,x.Z)(this,"effectRunner",void 0),(0,x.Z)(this,"overlay",void 0),(0,x.Z)(this,"codeEditor",void 0),(0,x.Z)(this,"editorSourceCode",void 0),(0,x.Z)(this,"history",void 0),(0,x.Z)(this,"codeExecutionService",void 0),(0,x.Z)(this,"perspectiveLabelRenderer",void 0),(0,x.Z)(this,"codeEditorServiceInputReceiverFactory",void 0),(0,x.Z)(this,"isRunning",!0),(0,x.Z)(this,"touchZoomStartZ",0),(0,x.Z)(this,"inFocusOnVanishReleaser",void 0),(0,x.Z)(this,"inFocus",void 0),(0,x.Z)(this,"debugRenderer",void 0),(0,x.Z)(this,"debugPoints",[5,5,.2,0,0,0]),(0,x.Z)(this,"lastFrameTime",Date.now()),this.gl=t,this.fileStorage=e,this.camera=i,this.settings=o,this.effectRunner=n,this.overlay=r,this.codeEditor=s,this.editorSourceCode=l,this.history=h,this.codeExecutionService=c,this.perspectiveLabelRenderer=a,this.codeEditorServiceInputReceiverFactory=d,this.camera.MoveTo({x:0,y:0,z:this.settings.ZCameraBoundary.min+.75*(this.settings.ZCameraBoundary.max-this.settings.ZCameraBoundary.min)}),t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT),this.codeEditor.ViewProjection=this.camera.ViewProjection,this.FocusCameraAtEditor(),this.editorSourceCode.Initialize(Ol,this.settings.MemoryLimit),this.inFocus=this.codeEditorServiceInputReceiverFactory(),this.inFocus.Focus(),this.inFocusOnVanishReleaser=this.inFocus.OnVanish.Attach((()=>0)),this.debugRenderer=new Rl(t),this.debugRenderer.ViewProjection=this.camera.ViewProjection,this.debugRenderer.UploadAttributes(this.debugPoints);const u=this.perspectiveLabelRenderer.Create({x:0,y:0},499,"TESTING (d) \n 1234567890",8,null);u.Scale=.2}async AsyncConstructor(){this.overlay.EditDirectionControls.EditDirectionObservable.Attach((t=>this.codeEditor.EditableCellDirection=t)),this.codeEditor.EditDirectionObservable.Attach((t=>this.overlay.EditDirectionControls.ForceEditDirection(t))),this.codeEditor.EditableCellLostObservable.Attach((()=>this.FollowEditableCell())),this.overlay.FileControls.OpenFromDiskObservable.Attach((()=>this.OpenFileFromDisk())),this.overlay.FileControls.SaveToDiskObservable.Attach((()=>this.SaveSourceToDisk())),this.overlay.FileControls.ShareObservable.Attach((()=>this.ShareSourceCode())),this.overlay.FileControls.ShowHelpObservable.Attach((()=>this.overlay.LanguageSyntaxHelpControls.ToggleHelp())),this.overlay.HistoryControls.UndoObservable.Attach((()=>this.history.Undo())),this.overlay.HistoryControls.RedoObservable.Attach((()=>this.history.Redo())),this.overlay.DebugControls.Heatmap.Attach((t=>this.ControlsResponseToHeatmapActivation(t))),this.history.UpdateObservable.Attach((()=>this.OnSourceCodeChanged())),this.overlay.VirtualKeyboardControls.Observable.Attach((t=>this.inFocus.OnInput({key:t}))),this.Start()}Resize(){this.settings.ViewDimension={Width:this.gl.canvas.width,Height:this.gl.canvas.height},this.settings.AspectRatio=this.gl.canvas.width/this.gl.canvas.height,this.camera.Resize(),this.overlay.Resize(),this.codeEditor.ViewProjection=this.camera.ViewProjection,this.debugRenderer.ViewProjection=this.camera.ViewProjection,this.perspectiveLabelRenderer.ViewProjection=this.camera.ViewProjection}OnPan(t){if(!this.overlay.Scroll({startX:t.startX,startY:t.startY,scroll:-t.movementY/window.devicePixelRatio,units:"px"})){const e=Xt.UnprojectMovement({x:t.movementX,y:t.movementY},{a:0,b:0,c:1,d:0},this.camera.ViewProjection,this.gl.canvas);this.camera.Translate({x:e.x,y:e.y}),this.codeEditor.ViewProjection=this.camera.ViewProjection,this.debugRenderer.ViewProjection=this.camera.ViewProjection,this.perspectiveLabelRenderer.ViewProjection=this.camera.ViewProjection}}OnSelect(t){const e=this.overlay.Touch(t);if(!1===e){this.SwitchFocus(this.codeEditorServiceInputReceiverFactory());const e={...this.codeEditor.EditableCell};this.codeEditor.Touch(t),this.codeExecutionService.Debugging.OnSelect(e)}else _l(e)&&this.SwitchFocus(e);const i=Xt.Unproject({x:t.offsetX,y:t.offsetY,z:0},this.camera.ViewProjection,this.gl.canvas),o=Xt.Unproject({x:t.offsetX,y:t.offsetY,z:1},this.camera.ViewProjection,this.gl.canvas),n=Yt.PlaneLine({a:0,b:0,c:1,d:0},{a:[i[0],i[1],i[2]],b:[o[0],o[1],o[2]]});this.debugPoints.push(i[0],i[1],i[2],n[0],n[1],n[2]),this.debugRenderer.UploadAttributes(this.debugPoints)}OnWheel(t){if(!this.overlay.Scroll({startX:t.offsetX,startY:t.offsetY,scroll:Math.sign(t.deltaY),units:"row"})){const e=new Sl(t.deltaY<0?"in":"out",this.camera,this.settings.ZCameraBoundary);this.effectRunner.Register(e,{id:"camera_zoom",rule:Il.Replace})}}OnTouchZoomStart(){this.touchZoomStartZ=this.camera.Position.z}OnTouchZoom(t){this.camera.MoveTo({z:D.Clamp(this.touchZoomStartZ*t,this.settings.ZCameraBoundary.min,this.settings.ZCameraBoundary.max)}),this.codeEditor.ViewProjection=this.camera.ViewProjection,this.debugRenderer.ViewProjection=this.camera.ViewProjection,this.perspectiveLabelRenderer.ViewProjection=this.camera.ViewProjection}OnKeyDown(t){this.inFocus.OnInput(t)}Dispose(){this.isRunning=!1}Start(){requestAnimationFrame((()=>this.DrawFrame(Date.now()-this.lastFrameTime)))}DrawFrame(t){if(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT),this.effectRunner.Draw(t)&&(this.codeEditor.ViewProjection=this.camera.ViewProjection,this.debugRenderer.ViewProjection=this.camera.ViewProjection,this.perspectiveLabelRenderer.ViewProjection=this.camera.ViewProjection),this.codeEditor.Draw(),this.perspectiveLabelRenderer.Draw(),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),this.overlay.Draw(),this.isRunning){const t=Date.now(),e=t-this.lastFrameTime;requestAnimationFrame((()=>this.DrawFrame(e))),this.lastFrameTime=t}}async OpenFileFromDisk(){let t="";try{t=await this.fileStorage.Open()}catch(o){if(o instanceof El)return;return void(o instanceof Error&&this.overlay.Snackbar.ShowError(o.message))}const e=new Tl(t),i=e.NextIllegalInstruction();if(null!==i){let t=0;for(;e.NextIllegalInstruction();++t);let o=`File contains illegal symbol '${i.value}' at ${i.offset}`;return t>0&&(o+=` and ${t} more`),void this.overlay.Snackbar.ShowError(o)}this.LoadSourceCodeToEditor(t),this.history.Reset(),Gh.replace({name:"CodeEditor"}),this.FocusCameraAtEditor()}async SaveSourceToDisk(){try{await this.fileStorage.Save(this.SourceCodeString())}catch(t){if(t instanceof El)return;return void(t instanceof Error&&this.overlay.Snackbar.ShowError(t.message))}}SourceCodeString(){let t="";for(let e=0;e<this.settings.MemoryLimit.Height;++e){let i="";for(let t=0;t<this.settings.MemoryLimit.Width;++t)i+=String.fromCharCode(this.editorSourceCode.Read({x:t,y:e}));t+=i.trimEnd()+"\n"}return t}ShareSourceCode(){const t=Dl.Encode(this.SourceCodeString());Gh.replace({name:"Share",params:{encoded:t}})}LoadSourceCodeToEditor(t){this.ResetSourceCodeEditor();const e=t.split(/\r?\n/);for(let i=0;i<e.length;++i){const t=e[i];for(let e=0;e<t.length;++e)this.codeEditor.EditCell(t[e],e,i)}this.overlay.FileControls.ShareDisabled=this.editorSourceCode.Empty}OnSourceCodeChanged(){this.overlay.FileControls.ShareDisabled=this.editorSourceCode.Empty}get Snackbar(){return this.overlay.Snackbar}FollowEditableCell(){const t=this.codeEditor.EditableCellRect,e=C.fF(C.Ue(),t.lb,this.camera.ViewProjection),i=C.fF(C.Ue(),t.rt,this.camera.ViewProjection),o=C.lu(C.Ue(),i,e),n=Ht.MoveRectangleToPlaceInsideRectangle({lb:{x:e[0],y:e[1]},rt:{x:i[0],y:i[1]}},{lb:{x:-1,y:-1},rt:{x:1,y:1}}),r=R.al(n.x,n.y);if(n.x>0){const t=o[0]*this.codeEditor.EditableCell.x;r[0]+=Math.min(t,1)}else if(n.x<0){const t=o[0]*(this.settings.MemoryLimit.Width-this.codeEditor.EditableCell.x-1);r[0]-=Math.min(t,1)}if(n.y>0){const t=o[1]*(this.settings.MemoryLimit.Height-this.codeEditor.EditableCell.y-1);r[1]+=Math.min(t,1)}else if(n.y<0){const t=o[1]*this.codeEditor.EditableCell.y;r[1]-=Math.min(t,1)}const s=[r[0]*this.gl.canvas.width/2,r[1]*this.gl.canvas.height/2],l=new wl(this.camera,s,this.gl.canvas);this.effectRunner.Register(l,{id:"follow_editable_cell",rule:Il.Replace})}ResetSourceCodeEditor(){this.editorSourceCode.Initialize(Ol,this.settings.MemoryLimit),this.codeEditor.Clear()}SwitchFocus(t){this.inFocus.Blur(),this.inFocusOnVanishReleaser(),this.inFocus=t,this.inFocus.Focus(),this.inFocus.OnVanish.Attach((()=>this.SwitchFocus(this.codeEditorServiceInputReceiverFactory())))}ControlsResponseToHeatmapActivation(t){this.overlay.FileControls.OpenFromDiskDisabled=t.isShown,t.isShown?this.overlay.HistoryControls.Lock():this.overlay.HistoryControls.Unlock(),this.overlay.EditControls.Disable=t.isShown}FocusCameraAtEditor(){const t=this.overlay.EditDirectionControls.Boundaries.rt,e=10,i={x:t.x+e,y:this.settings.ViewDimension.Height-t.y},o=Xt.Unproject({...i,z:0},this.camera.ViewProjection,this.gl.canvas),n=Xt.Unproject({...i,z:1},this.camera.ViewProjection,this.gl.canvas),r=Yt.PlaneLine({a:0,b:0,c:1,d:0},{a:[o[0],o[1],o[2]],b:[n[0],n[1],n[2]]});r[1]-=this.settings.MemoryLimit.Height*this.codeEditor.CellSize,this.camera.Translate({x:-r[0],y:-r[1]}),this.codeEditor.ViewProjection=this.camera.ViewProjection,this.perspectiveLabelRenderer.ViewProjection=this.camera.ViewProjection}};Rh=mh([(0,w.b)(),Ch(0,(0,S.f)(L.WebGLRenderingContext)),Ch(1,(0,S.f)(L.FileStorage)),Ch(2,(0,S.f)(te)),Ch(3,(0,S.f)(V)),Ch(4,(0,S.f)(Zl)),Ch(5,(0,S.f)(Wn)),Ch(6,(0,S.f)(Ar)),Ch(7,(0,S.f)(Xn)),Ch(8,(0,S.f)(No)),Ch(9,(0,S.f)(ul)),Ch(10,(0,S.f)(ji)),Ch(10,(0,P.t)(Z.Perspective)),Ch(11,(0,S.f)(L.CodeEditorServiceInputReceiverFactory)),xh("design:paramtypes",["function"===typeof(lh="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?lh:Object,"function"===typeof(hh="undefined"!==typeof c.FileStorage&&c.FileStorage)?hh:Object,"function"===typeof(ch="undefined"!==typeof te&&te)?ch:Object,"function"===typeof(ah="undefined"!==typeof V&&V)?ah:Object,"function"===typeof(dh="undefined"!==typeof Zl&&Zl)?dh:Object,"function"===typeof(uh="undefined"!==typeof Wn&&Wn)?uh:Object,"function"===typeof(fh="undefined"!==typeof Ar&&Ar)?fh:Object,"function"===typeof(ph="undefined"!==typeof Xn&&Xn)?ph:Object,"function"===typeof(gh="undefined"!==typeof No&&No)?gh:Object,"function"===typeof(yh="undefined"!==typeof ul&&ul)?yh:Object,"function"===typeof(bh="undefined"!==typeof ji&&ji)?bh:Object,"function"===typeof(vh="undefined"!==typeof h.CodeEditorServiceInputReceiverFactory&&h.CodeEditorServiceInputReceiverFactory)?vh:Object])],Rh),U.bind(Rh).toSelf().inSingletonScope().onActivation(ye);i(2062);async function wh(t,e){return new Promise((i=>t.addEventListener(e,(t=>i(t)),{once:!0})))}var Sh=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Ph=class{constructor(){(0,x.Z)(this,"openedFilename","befunge.txt")}async Open(){const t=document.createElement("input");t.type="file";const e=wh(t,"change");t.click();const i=await e,o=i.target;if(0===(o?.files?.length??0))throw new Error("Failed to load file");return this.openedFilename=o.files[0].name,o.files[0].text()}async Save(t){const e=new Blob([t],{type:"text/plain"}),i=window.URL.createObjectURL(e),o=document.createElement("a");o.href=i,o.download=this.openedFilename,o.click(),window.URL.revokeObjectURL(i)}};Ph=Sh([(0,w.b)()],Ph);var Dh=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Ah=class{constructor(){(0,x.Z)(this,"openedFilename","befunge.txt")}async Open(){try{const[t]=await window.showOpenFilePicker({multiple:!1});if("file"!==t.kind)throw new El;this.openedFilename=t.name;const e=await t.getFile();return e.text()}catch(t){if(t instanceof DOMException)switch(t.name){case"AbortError":throw new El}throw t}}async Save(t){try{const e=await window.showSaveFilePicker({suggestedName:this.openedFilename}),i=await e.createWritable();await i.write(t),await i.close()}catch(e){if(e instanceof DOMException)switch(e.name){case"AbortError":throw new El}throw e}}};Ah=Dh([(0,w.b)()],Ah);var Oh,Th=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Eh=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},Ih=function(t,e){return function(i,o){e(i,o,t)}};let Bh=class{constructor(t){(0,x.Z)(this,"gl",void 0),this.gl=t}async AsyncConstructor(){U.get(V).ViewDimension={Width:this.gl.canvas.width,Height:this.gl.canvas.height},await this.SetupGlobalDependencies()}async SetupGlobalDependencies(){U.bind(L.FontAtlas).toConstantValue(tt.Build({ASCIIRange:{Start:" ",End:"~"},Font:{Name:"Roboto",Size:72}})),U.bind(L.FontAtlasTexture).toConstantValue(this.BuildTexture(U.get(L.FontAtlas).Image)),U.bind(L.IconAtlas).toConstantValue(await U.getAsync(Re)),U.bind(L.IconAtlasTexture).toConstantValue(this.BuildTexture(U.get(L.IconAtlas).Image)),U.bind(L.FileStorage).to(this.IsPickerApiAvailable?Ah:Ph).inSingletonScope()}get IsPickerApiAvailable(){return void 0!==window.showOpenFilePicker&&void 0!==window.showSaveFilePicker}BuildTexture(t){const e=this.gl.createTexture()??$("Failed to create texture");return this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),e}};Bh=Th([(0,w.b)(),Ih(0,(0,S.f)(L.WebGLRenderingContext)),Eh("design:paramtypes",["function"===typeof(Oh="undefined"!==typeof WebGL2RenderingContext&&WebGL2RenderingContext)?Oh:Object])],Bh),U.bind(Bh).toSelf().inSingletonScope().onActivation(ye);var Lh=i(7139),Zh=i(4870),_h=(0,d.aZ)({__name:"WebglCanvas",props:{width:{type:Number},height:{type:Number}},emits:["contextReady","resize"],setup(t,{emit:e}){const i=t,o=(0,Zh.iH)(0),n=(0,Zh.iH)(0),r=(0,Zh.iH)();let s=null;const l=(0,d.Fl)((()=>!(void 0===i.width&&void 0===i.height))),h=(0,d.Fl)((()=>i.width??o.value)),c=(0,d.Fl)((()=>i.height??n.value)),a=(0,d.Fl)((()=>l.value?y(h.value):"100%")),u=(0,d.Fl)((()=>l.value?y(c.value):"100%"));function f(){r.value&&(r.value.width=h.value,r.value.height=c.value,s?.viewport(0,0,h.value,c.value))}function p(){o.value=(r.value?.clientWidth??0)*window.devicePixelRatio,n.value=(r.value?.clientHeight??0)*window.devicePixelRatio,f(),e("resize")}function g(){void 0!==r.value?(s=r.value.getContext("webgl2",{stencil:!0}),null!==s?(s.enable(s.CULL_FACE),s.enable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),e("contextReady",s)):console.error("Can't initialize webgl2 context")):console.error("Canvas element not found")}function y(t){return`${t}px`}return(0,d.bv)((()=>{l.value?f():(p(),window.addEventListener("resize",p)),g()})),(0,d.Jd)((()=>{l.value||window.removeEventListener("resize",p)})),(t,e)=>((0,d.wg)(),(0,d.iD)("canvas",{ref_key:"canvas",ref:r,style:(0,Lh.j5)({width:a.value,height:u.value})},null,4))}});const jh=(0,f.Z)(_h,[["__scopeId","data-v-3248c29e"]]);var Fh=jh,kh=(0,d.aZ)({__name:"CodeEditor",props:{encoded:{required:!1,type:String,default:""}},setup(t){const e=t;let i;async function o(t){U.bind(L.WebGLRenderingContext).toConstantValue(t),await U.getAsync(Bh),i=await U.getAsync(Rh),i.Resize(),p()}function n(){i?.Resize()}function r(t){i?.OnMouseMove(t)}function s(t){i?.OnMouseDown(t)}function l(t){i?.OnMouseUp(t)}function h(t){i?.OnWheel(t)}function c(t){i?.OnKeyDown(t)}function a(t){i?.OnTouchMove(t)}function u(t){i?.OnTouchStart(t)}function f(t){i?.OnTouchEnd(t)}function p(){if(e.encoded.length>0)try{const t=Dl.Decode(e.encoded);i.LoadSourceCodeToEditor(t)}catch(t){t instanceof Error&&i.Snackbar.ShowError(t.message)}}return(0,d.Jd)((()=>i.Dispose())),(t,e)=>((0,d.wg)(),(0,d.j4)(Fh,{autofocus:"",tabindex:"0",onContextReady:o,onResize:n,onMousemove:r,onMousedown:s,onMouseup:l,onWheelPassive:h,onKeydown:c,onTouchmove:a,onTouchstart:u,onTouchend:f}))}});const Uh=kh;var Mh=Uh;const Nh=[{path:"/",name:"CodeEditor",props:!0,component:Mh},{path:"/share/:encoded",name:"Share",props:!0,component:Mh}],zh=(0,m.p7)({history:(0,m.PO)("/befunge_ide/"),routes:Nh});var Gh=zh,Vh=i(65),Hh=(0,Vh.MT)({state:{},getters:{},mutations:{},actions:{},modules:{}});async function Wh(){const t=new FontFace("Roboto","url(/befunge_ide/fonts/roboto-latin-500-normal.3170fd9a.woff2)");await t.load(),(0,a.ri)(y).use(Hh).use(Gh).mount("#app")}Wh()}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,i),r.exports}i.m=t,function(){var t=[];i.O=function(e,o,n,r){if(!o){var s=1/0;for(a=0;a<t.length;a++){o=t[a][0],n=t[a][1],r=t[a][2];for(var l=!0,h=0;h<o.length;h++)(!1&r||s>=r)&&Object.keys(i.O).every((function(t){return i.O[t](o[h])}))?o.splice(h--,1):(l=!1,r<s&&(s=r));if(l){t.splice(a--,1);var c=n();void 0!==c&&(e=c)}}return e}r=r||0;for(var a=t.length;a>0&&t[a-1][2]>r;a--)t[a]=t[a-1];t[a]=[o,n,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,o){var n,r,s=o[0],l=o[1],h=o[2],c=0;if(s.some((function(e){return 0!==t[e]}))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(h)var a=h(i)}for(e&&e(o);c<s.length;c++)r=s[c],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(a)},o=self["webpackChunkbefunge"]=self["webpackChunkbefunge"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=i.O(void 0,[998],(function(){return i(572)}));o=i.O(o)})();
//# sourceMappingURL=app.26e7a764.js.map